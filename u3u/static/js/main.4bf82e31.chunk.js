(this.webpackJsonpzd2=this.webpackJsonpzd2||[]).push([[0],{109:function(e,t,n){e.exports=n(256)},114:function(e,t,n){},115:function(e,t,n){},116:function(e,t,n){},123:function(e,t,n){},151:function(e,t){},154:function(e,t,n){},155:function(e,t,n){},156:function(e,t,n){},186:function(e,t,n){},187:function(e,t,n){},190:function(e,t,n){},191:function(e,t,n){},192:function(e,t,n){},193:function(e,t,n){},256:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(37),c=n.n(o),i=(n(114),n(115),n(100)),s=(n(116),n(2)),u=n(3),l=n(5),p=n(4),h=n(6),f=n(7),m=n(8),g=n.n(m),v=(n(123),function(e){var t=e.children,n=e.onClick,r=e.onMouseDown,o=e.onMouseUp,c=e.disabled,i=e.width,s=e.className,u=e.value,l=e.name;return a.createElement("button",{className:m("button",s),onClick:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return n&&n({e:e,value:u,name:l})})),onMouseUp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return o&&o({e:e,value:u,name:l})})),onMouseDown:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return r&&r({e:e,value:u,name:l})})),style:{width:i},disabled:c},t)}),d=n(38),O=function(e){return e.getContext("2d").getImageData(0,0,e.width,e.height)};function b(e){var t=document.createElement("canvas"),n=t.getContext("2d");return n?(t.width=e.width,t.height=e.height,n.putImageData(e,0,0),t):null}var y,j,P=function(e,t,n){var a=b(e),r=document.createElement("canvas");return r.width=t,r.height=n,r.getContext("2d").drawImage(a,0,0,t,n),O(r)},C=function(e){var t=document.createElement("canvas"),n=t.getContext("2d");return n?(t.width=e.width,t.height=e.height,n.putImageData(e,0,0),t.toDataURL()):null},E=function(e,t){var n=document.createElement("canvas"),a=n.getContext("2d");return a?(n.width=e.width,n.height=e.height,t&&(a.putImageData(t,0,0),a.globalCompositeOperation="source-in"),a.drawImage(b(e),0,0,e.width,e.height),n):null};!function(e){e.ADD_PATTERN="patterns/add",e.REMOVE_PATTERN="patterns/remove"}(y||(y={})),function(e){e.UPDATE_IMAGE="pattern/update-image",e.UPDATE_MASK="pattern/update-mask",e.UPDATE_SELECTION="pattern/update-selection",e.SET_MASK_PARAMS="pattern/set-mask-params",e.EDIT_CONFIG="pattern/edit-config",e.UNDO="pattern/undo",e.REDO="pattern/redo",e.STORE_IMAGE="pattern/store-image",e.UNSTORE_IMAGE="pattern/unstore-image",e.SET_WIDTH="pattern/set-width",e.SET_HEIGHT="pattern/set-height",e.SET_SELECTION_PARAMS="pattern/set-selection-params",e.SET_ROTATION="pattern/set-rotation",e.SET_REPEATING="pattern/set-repeating",e.CREATE_ROOM="pattern/create-room"}(j||(j={}));var S,w=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(a,r){var o=r().patterns[e].socket;return n&&o&&o.emit("image",C(t)),a({type:j.UPDATE_IMAGE,imageData:t,id:e})}},k=n(1),D=(n(154),function(e){var t=e.onUndo,n=e.onRedo,r=e.history;return a.createElement(a.Fragment,null,a.createElement(v,{onClick:t,disabled:!r.before.length,width:70},"undo",r.before.length?"(".concat(r.before.length,")"):""),a.createElement(v,{onClick:n,disabled:!r.after.length,width:70},"redo",r.after.length?"(".concat(r.after.length,")"):""))});!function(e){e.Brush="Brush",e.Select="Select",e.Line="Line"}(S||(S={}));var T,A,R,M=[S.Select],N=function(e,t,n,a){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-a,2))},I=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).elementRef=void 0,n.pre=void 0,n.mouseDownHandler=function(e){n.setState({dragging:!0});var t=n.props.onDown;t&&t(e)},n.mouseUpHandler=function(e){if(n.state.dragging){n.setState({dragging:!1}),n.pre=null;var t=n.props.onUp;t&&t(e)}},n.mouseMoveHandler=function(e){var t=n.props,a=t.onDrag,r=t.onMove;n.state.dragging&&a&&a(e,n.pre),r&&r(e,n.pre),n.pre=e},n.state={dragging:!1},n.elementRef=r.a.createRef(),n.pre=null,n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.elementRef.current.addEventListener("mousedown",this.mouseDownHandler),document.addEventListener("mouseup",this.mouseUpHandler),this.elementRef.current.addEventListener("mousemove",this.mouseMoveHandler)}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.width,a=e.height,o=e.className,c=e.style;return r.a.createElement("svg",{ref:this.elementRef,width:n,height:a,className:o,style:c},t)}}]),t}(r.a.PureComponent),V=n(61),x=n(9),L=n(26);!function(e){e.M="M",e.L="L",e.Z="Z"}(A||(A={})),function(e){e.M="M",e.L="L",e.Z="Z",e.Rect="Rect",e.Slice="Slice"}(R||(R={}));var _=(T={},Object(k.a)(T,R.M,(function(e,t){var n=Object(L.a)(t,2),a=n[0],r=n[1];return[].concat(Object(x.a)(e),[{type:A.M,values:[a,r]}])})),Object(k.a)(T,R.L,(function(e,t){var n=Object(L.a)(t,2),a=n[0],r=n[1];return[].concat(Object(x.a)(e),[{type:A.L,values:[a,r]}])})),Object(k.a)(T,R.Z,(function(e){return[].concat(Object(x.a)(e),[{type:A.Z}])})),Object(k.a)(T,R.Rect,(function(e,t){var n=Object(L.a)(t,4),a=n[0],r=n[1],o=n[2],c=n[3],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=F(e,i),u=s.sliceStart,l=s.sliceEnd;return[].concat(Object(x.a)(e.slice(0,u)),[{type:A.M,values:[a,r]},{type:A.L,values:[o,r]},{type:A.L,values:[o,c]},{type:A.L,values:[a,c]},{type:A.Z}],Object(x.a)(e.slice(l+1)))})),Object(k.a)(T,R.Slice,(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=F(e,n),r=a.sliceStart,o=a.sliceEnd;return[].concat(Object(x.a)(e.slice(0,r)),Object(x.a)(t),Object(x.a)(e.slice(o+1)))})),T),F=function(e,t){for(var n,a,r=0,o=0;o<e.length;o++)if(e[o].type===A.M){if(r===t){n=o;for(var c=o;c<e.length;c++)if(e[c].type===A.Z){a=c;break}break}r++}return{sliceStart:"undefined"===typeof n?e.length:n,sliceEnd:"undefined"===typeof a?e.length:a}},U=function(e){var t;for(t=e.length-1;t>=0&&e[t].type!==A.M;t--);return e.slice(t)},X=function(e,t,n){if(e&&e.length){var a,r,o=e.slice(1).reduce((function(e,a,r){if(r++,!a.values)return e;var o=N(t,n,a.values[0],a.values[1]);return o<e.distance?{distance:o,segment:a,index:r}:e}),{sliceStart:0,sliceEnd:0,startInSlice:0,index:0,segment:e[0],distance:N(t,n,e[0].values[0],e[0].values[1])});o.sliceN=-1;for(var c=0;c<e.length;c++)e[c].type===A.M&&c<=o.index&&(a=c,o.sliceN+=1),e[c].type===A.Z&&c>o.index&&!r&&(r=c);return o.sliceStart=a,o.sliceEnd=r,o.startInSlice=a?o.index%a:o.index,o.slice=e.slice(o.sliceStart,o.sliceEnd+1),o}},Y=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",e),t.getPathData()};var H,G,z=function(e,t){return t},B=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z,a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,o=Object.keys(e).map((function(a){return{value:t(e[a],a),text:n(e[a],a)}}));return a?[{value:null,text:r||"-"}].concat(Object(x.a)(o)):o},W=function(e){return e},Z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W;return e.map((function(e){return{value:t(e),text:n(e)}}))};!function(e){e.CurveBasis="curveBasis",e.CurveBundle="curveBundle",e.CurveCardinal="curveCardinal",e.CurveCatmullRom="curveCatmullRom",e.CurveLinear="curveLinear",e.CurveMonotoneX="curveMonotoneX",e.CurveMonotoneY="curveMonotoneY",e.CurveNatural="curveNatural",e.CurveStep="curveStep",e.CurveStepBefore="curveStepBefore",e.CurveStepAfter="curveStepAfter"}(G||(G={}));var q,K=(H={},Object(k.a)(H,G.CurveBundle,"beta"),Object(k.a)(H,G.CurveCardinal,"tension"),Object(k.a)(H,G.CurveCatmullRom,"alpha"),H);!function(e){e.Line="Line",e.Rect="Rect",e.SimplePoints="SimplePoints",e.Points="Points"}(q||(q={}));n(155);var J,$,Q=V.line().x((function(e){var t=e.values;return t?t[0]:0})).y((function(e){var t=e.values;return t?t[1]:0})).defined((function(e){return!!e.values})),ee=5,te=Z([q.Rect,q.Line,q.Points]),ne=Z(Object.values(G)),ae=function(e){function t(e){var n,r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(p.a)(t).call(this,e))).canvasRef=void 0,r.pathRef=void 0,r.pathPointsRef=void 0,r.maskPathRef=void 0,r.maskRef=void 0,r.commitChanges=function(){var e=r.props.onChange;e&&e(r.state.path)},r.selectToolHandlers=(n={},Object(k.a)(n,q.Rect,{down:function(e){var t=r.state.path;if(t.length){var n=X(t,e.offsetX,e.offsetY);if(n&&n.distance<2*ee){if(5!==n.slice.length)return r.setState((function(t){return{startX:e.offsetX,startY:e.offsetY,offsetX:0,offsetY:0,currentSliceN:n.sliceN,path:_[R.Rect](t.path,[e.offsetX,e.offsetY,e.offsetX,e.offsetY],n.sliceN)}}));var a=(n.startInSlice+2)%4,o=n.slice[a],c=n.segment.values[0]-e.offsetX,i=n.segment.values[1]-e.offsetY,s=o.values[0],u=o.values[1];return r.setState((function(t){return{startX:s,startY:u,offsetX:c,offsetY:i,currentSliceN:n.sliceN,path:_[R.Rect](t.path,[s,u,e.offsetX+c,e.offsetY+i],n.sliceN)}}))}}r.setState((function(t){var n=t.currentSliceN,a=t.path;return{offsetX:0,offsetY:0,startX:e.offsetX,startY:e.offsetY,path:_[R.Rect](a,[e.offsetX,e.offsetY,e.offsetX,e.offsetY],n)}}))},drag:function(e){r.setState((function(t){var n=t.path,a=t.startX,r=t.startY,o=(t.offsetX,t.offsetY,t.currentSliceN);return{path:_[R.Rect](n,[a,r,e.offsetX,e.offsetY],o)}}))},up:function(){r.setState((function(e){return{startX:0,startY:0,offsetX:0,offsetY:0,currentSliceN:e.path.filter((function(e){return e.type===A.M})).length}}),r.commitChanges)},exit:function(e){}}),Object(k.a)(n,q.SimplePoints,{down:function(e){var t=r.state,n=t.path,a=t.curvePath;if(n.length&&n[n.length-1].type!==A.Z){a.length&&r.setState((function(e){var t=e.path,n=e.currentSliceN;return{curvePath:[],path:_[R.Slice](t,a,n)}}));var o=n.filter((function(e){return e.type===A.M})).reverse()[0];N(e.offsetX,e.offsetY,o.values[0],o.values[1])<2*ee?r.setState((function(e){var t=e.path;return{path:_[R.Z](t),currentSliceN:t.filter((function(e){return e.type===A.M})).length}}),r.commitChanges):r.setState((function(t){var n=t.path;return{path:_[R.L](n,[e.offsetX,e.offsetY])}}))}else r.setState((function(t){var n=t.path;return{path:_[R.M](n,[e.offsetX,e.offsetY])}}))},drag:function(){},up:function(){},exit:function(e){var t=r.state.path;t&&t.length&&t[t.length-1].type!==A.Z&&e!==q.Points&&r.setState((function(e){var t=e.path;return{curvePath:[],path:_[R.Z](t),currentSliceN:t.filter((function(e){return e.type===A.M})).length}}),r.commitChanges)}}),Object(k.a)(n,q.Points,{down:function(e){var t=r.state,n=t.path,a=t.curvePath;if(n.length&&n[n.length-1].type!==A.Z){a.length||r.setState((function(e){var t=e.path;return{curvePath:U(t)}}));var o=n.filter((function(e){return e.type===A.M})).reverse()[0];N(e.offsetX,e.offsetY,o.values[0],o.values[1])<2*ee?r.setState((function(e){var t=e.path,n=e.curvePath,a=_[R.L](n,[o.values[0],o.values[1]]);return a=_[R.Z](a),{curvePath:[],path:_[R.Z](r.line(t,a)),currentSliceN:t.filter((function(e){return e.type===A.M})).length}}),r.commitChanges):r.setState((function(t){var n=t.path,a=t.curvePath,o=_[R.L](a,[e.offsetX,e.offsetY]);return{curvePath:o,path:r.line(n,o)}}))}else{var c=_[R.M](r.state.curvePath,[e.offsetX,e.offsetY]);r.setState((function(t){var n=t.path;return{curvePath:c,path:_[R.M](n,[e.offsetX,e.offsetY])}}))}},drag:function(){},up:function(){},exit:function(e){var t=r.state.path;t&&t.length&&t[t.length-1].type!==A.Z&&e!==q.Points&&r.setState((function(e){var t=e.path;return{curvePath:[],path:_[R.Z](t),currentSliceN:t.filter((function(e){return e.type===A.M})).length}}),r.commitChanges)}}),Object(k.a)(n,q.Line,{down:function(e){r.setState((function(t){var n=t.path;return{path:_[R.M](n,[e.offsetX,e.offsetY])}}))},drag:function(e){r.setState((function(t){var n=t.path;return{path:_[R.L](n,[e.offsetX,e.offsetY])}}))},up:function(e){r.setState((function(e){var t=e.path;return{path:_[R.Z](t),currentSliceN:t.filter((function(e){return e.type===A.M})).length}}),r.commitChanges)},exit:function(e){}}),n),r.line=function(e,t){var n=r.props.selectToolParams,a=n.curveType,o=n[K[a]],c=V[a||"curveLinear"];return-1!==Object.keys(K).indexOf(a)&&(c=c[K[a]](o)),_[R.Slice](e,Y(Q.curve(c)(U(t))),r.state.currentSliceN)},r.canvasRef=a.createRef(),r.pathRef=a.createRef(),r.pathPointsRef=a.createRef(),r.maskPathRef=a.createRef(),r.maskRef=a.createRef(),r.state={startX:null,startY:null,offsetX:null,offsetY:null,points:[],closed:!0,path:[],prevPath:null,curvePath:[],currentSliceN:0},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.value;Array.isArray(e)&&this.setState({path:e,currentSliceN:e.filter((function(e){return e.type===A.M})).length})}},{key:"componentDidUpdate",value:function(e){e.selectToolParams.mode!==this.props.selectToolParams.mode&&this.selectToolHandlers[e.selectToolParams.mode].exit(this.props.selectToolParams.mode)}},{key:"render",value:function(){console.log("selector render",this.state.path);var e=this.props,t=e.width,n=e.height,r=e.selectToolParams.mode,o=e.isActive,c=e.name,i=e.style;return this.pathRef.current&&this.pathRef.current.setPathData(this.state.path),this.maskPathRef.current&&this.maskPathRef.current.setPathData(this.state.path),a.createElement("div",{style:i,className:g()("selection",Object(k.a)({},"selectionActive",o))},a.createElement(I,{width:t,height:n,onDown:this.selectToolHandlers[r].down,onDrag:this.selectToolHandlers[r].drag,onUp:this.selectToolHandlers[r].up},this.state.path&&this.state.path.length&&a.createElement(a.Fragment,null,a.createElement("mask",{id:"selectionMask".concat(c),ref:this.maskRef},a.createElement("rect",{x:"0",y:"0",width:t,height:n,fill:"white"}),a.createElement("path",{ref:this.maskPathRef,fillOpacity:1,fill:"black"})),a.createElement("rect",{x:"0",y:"0",width:t,height:n,fill:"black",fillOpacity:.3,mask:"url(#selectionMask".concat(c,")")}),a.createElement("path",{ref:this.pathRef,fillOpacity:0,fill:"black",stroke:"red"}))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.value;return Array.isArray(n)&&n!==t.prevPath?{prevPath:n,path:n,currentSliceN:n.filter((function(e){return e.type===A.M})).length}:{}}}]),t}(a.PureComponent),re=Object(f.b)((function(e){return{selectToolParams:e.selectTool.params,currentTool:e.tool.current}}),{})(ae),oe=(n(156),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).canvasRef=void 0,n.ctx=void 0,n.pre=void 0,n.mouseDownHandler=function(e){console.log("canvas down"),document.addEventListener("mouseup",n.mouseUpHandler),n.setState({drawing:!0});var t={e:e,ctx:n.ctx,canvas:n.canvasRef.current,drawing:!0},a=n.props.onDown;a&&a(t);var r=n.props.clickProcess;r&&r(t)},n.mouseUpHandler=function(e){if(console.log("canvas up"),document.removeEventListener("mouseup",n.mouseUpHandler),n.state.drawing){n.setState({drawing:!1}),n.pre=null;var t=n.props.onChange;t&&t(O(n.canvasRef.current));var a={e:e,ctx:n.ctx,canvas:n.canvasRef.current,drawing:!1},r=n.props.onUp;r&&r(a);var o=n.props.releaseProcess;o&&o(a)}},n.mouseMoveHandler=function(e){var t=n.props,a=t.drawProcess,r=t.moveProcess;n.state.drawing&&a&&a({e:e,pre:n.pre,ctx:n.ctx,canvas:n.canvasRef.current,drawing:!0}),r&&r({e:e,pre:n.pre,ctx:n.ctx,canvas:n.canvasRef.current,drawing:n.state.drawing}),n.pre=e},n.state={drawing:!1},n.canvasRef=r.a.createRef(),n.ctx=null,n.pre=null,n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.ctx=this.canvasRef.current.getContext("2d"),this.canvasRef.current.addEventListener("mousedown",this.mouseDownHandler),this.canvasRef.current.addEventListener("mousemove",this.mouseMoveHandler),this.props.value instanceof ImageData&&this.ctx.putImageData(this.props.value,0,0)}},{key:"componentWillUnmount",value:function(){this.canvasRef.current.removeEventListener("mousedown",this.mouseDownHandler),this.canvasRef.current.removeEventListener("mousemove",this.mouseMoveHandler)}},{key:"componentDidUpdate",value:function(e){(e.value!==this.props.value||e.width!==this.props.width||e.height!==this.props.height)&&this.props.value instanceof ImageData&&(this.ctx=this.canvasRef.current.getContext("2d"),console.log(),this.ctx.putImageData(this.props.value,0,0))}},{key:"render",value:function(){var e=this.props,t=e.value,n=e.width,a=e.height,o=e.className,c=e.style,i=e.children;return console.log("canvas render",c),r.a.createElement("div",{style:c,className:m(o,"canvas")},r.a.createElement("canvas",{ref:this.canvasRef,width:n||(t?t.width:300),height:a||(t?t.height:300)}),i)}}]),t}(r.a.PureComponent));!function(e){e.Square="Square",e.Circle="Circle",e.Pattern="Pattern"}(J||(J={})),function(e){e.SourceOver="source-over",e.SourceAtop="source-atop",e.DestinationOver="destination-over",e.DestinationOut="destination-out",e.Lighter="lighter",e.Xor="xor"}($||($={}));var ce,ie,se,ue=n(25),le=n.n(ue);!function(e){e.Default="Default",e.Interrupted="Interrupted",e.InterruptedOneStroke="InterruptedOneStroke",e.Pattren="Pattren"}(ce||(ce={})),function(e){e.SourceOver="source-over",e.SourceAtop="source-atop",e.DestinationOver="destination-over",e.DestinationOut="destination-out",e.Lighter="lighter",e.Xor="xor"}(ie||(ie={})),function(e){e.CHANGE="change",e.TO_START_VALUE="change/to-start-value",e.ALL_TO_START_VALUE="change/all-to-start-value"}(se||(se={}));var pe,he,fe=function(e){return{type:se.TO_START_VALUE,path:e}},me=function(){return{type:se.ALL_TO_START_VALUE}};!function(e){e.OnDraw="onDraw",e.On="on",e.Off="off"}(pe||(pe={})),function(e){e.START="changing/start",e.STOP="changing/stop",e.SET_MODE="changing/set-mode"}(he||(he={}));var ge,ve,de=null,Oe=function(){return function(e,t){if(!de){de&&cancelAnimationFrame(de);var n=performance.now();return de=requestAnimationFrame((function t(a){e(function(e){return{type:se.CHANGE,time:e}}(a-n)),de=requestAnimationFrame(t)})),e({type:he.START})}}},be=function(){return function(e,t){return de&&cancelAnimationFrame(de),de=null,e({type:he.STOP})}},ye=function(){return function(e,t){if(t().changing.mode===pe.OnDraw)return e(Oe())}},je=function(){return function(e,t){if(t().changing.mode===pe.OnDraw)return e(me()),e(be())}};!function(e){e.Canvas="Canvas",e.Simple="Simple"}(ge||(ge={})),function(e){e.Grid="Grid",e.Center="Center",e.Dart="Dart"}(ve||(ve={}));var Pe,Ce=function(e,t,n){if(!n.repeating)return[{x:e,y:t}];var a=n.repeating.params;if(a.type===ve.Grid){var r=a.gridParams,o=r.x,c=r.y,i=n.current,s=i.width/o,u=i.height/c;e%=s,t%=u;for(var l=[],p=-1;p<o+1;p++)for(var h=-1;h<c+1;h++)l.push({x:e+s*p,y:t+u*h});return l}return[{x:e,y:t}]};function Ee(){for(var e="#",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}var Se,we=function(e){function t(){var e,n,a,r,o;Object(s.a)(this,t);for(var c=arguments.length,i=new Array(c),u=0;u<c;u++)i[u]=arguments[u];return(o=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).handlers=(r={},Object(k.a)(r,S.Brush,(n={},Object(k.a)(n,J.Square,function(){var e=function(e){var t=e.ctx,n=e.e,a=o.props,r=a.patterns[a.patternId],c=o.props.brush.params,i=c.size,s=c.opacity,u=c.compositeOperation;t.fillStyle=Ee(),t.globalAlpha=s,t.globalCompositeOperation=u,Ce(n.offsetX,n.offsetY,r).forEach((function(e){var n=e.x,a=e.y;return t.fillRect(n-i/2,a-i/2,i,i)})),t.globalCompositeOperation=$.SourceOver,t.globalAlpha=1};return{draw:e,click:e}}()),Object(k.a)(n,J.Circle,function(){var e=function(e){var t=e.ctx,n=e.e,a=o.props.brush.params,r=a.size,c=a.opacity,i=a.compositeOperation;t.fillStyle=Ee(),t.globalAlpha=c,t.globalCompositeOperation=i,t.beginPath(),t.arc(n.offsetX,n.offsetY,r/2,0,2*Math.PI),t.fill(),t.globalCompositeOperation=$.SourceOver,t.globalAlpha=1};return{draw:e,click:e}}()),Object(k.a)(n,J.Pattern,function(){var e=function(e){var t=e.ctx,n=e.e,a=o.props.patterns,r=o.props.brush.params,c=r.patternSize,i=r.opacity,s=r.compositeOperation,u=r.pattern;t.fillStyle=Ee(),t.globalAlpha=i,t.globalCompositeOperation=s;var l=a[u]&&a[u].rotation.value,p=a[u]&&a[u].resultImage;if(p){l&&(t.translate(n.offsetX+l.offset.x,n.offsetY+l.offset.y),t.rotate(Math.PI*l.angle/180));var h=c*p.width,f=c*p.height;t.drawImage(p,-h/2,-f/2,h,f),t.globalCompositeOperation=$.SourceOver,t.globalAlpha=1,l&&(t.rotate(-Math.PI*l.angle/180),t.translate(-n.offsetX-l.offset.x,-n.offsetY-l.offset.y))}};return{draw:e,click:e}}()),n)),Object(k.a)(r,S.Line,(a={},Object(k.a)(a,ce.Default,{click:function(e){var t=e.ctx,n=e.e,a=o.props.line.params,r=a.size,c=a.opacity,i=a.compositeOperation;t.beginPath(),t.globalCompositeOperation=i,t.globalAlpha=c,t.strokeStyle=Ee(),t.lineWidth=r,t.moveTo(n.offsetX,n.offsetY)},draw:function(e){var t=e.ctx,n=e.e,a=o.props.line.params,r=a.size,c=a.opacity;t.lineWidth=r,t.globalAlpha=c,t.lineTo(n.offsetX,n.offsetY),t.stroke()},release:function(e){e.ctx.globalCompositeOperation=ie.SourceOver,e.ctx.globalAlpha=1,e.ctx.closePath()}}),Object(k.a)(a,ce.Interrupted,{click:function(e){var t=e.ctx,n=(e.e,o.props.line.params),a=n.size,r=n.opacity,c=n.compositeOperation;t.globalCompositeOperation=c,t.globalAlpha=r,t.strokeStyle=Ee(),t.lineWidth=a,t.beginPath()},draw:function(e){var t=e.ctx,n=e.e,a=e.pre,r=o.props.line.params,c=r.size,i=r.opacity;a&&(t.lineWidth=c,t.globalAlpha=i,t.moveTo(a.offsetX,a.offsetY),t.lineTo(n.offsetX,n.offsetY),t.stroke())},release:function(e){e.ctx.globalCompositeOperation=ie.SourceOver,e.ctx.globalAlpha=1,e.ctx.closePath()}}),Object(k.a)(a,ce.InterruptedOneStroke,{click:function(e){var t=e.ctx,n=(e.e,o.props.line.params),a=n.size,r=n.opacity,c=n.compositeOperation;t.globalCompositeOperation=c,t.globalAlpha=r,t.strokeStyle=Ee(),t.lineWidth=a},draw:function(e){var t=e.ctx,n=e.e,a=e.pre,r=o.props.line.params,c=r.size,i=r.opacity;t.lineWidth=c,t.globalAlpha=i,a&&(t.beginPath(),t.moveTo(a.offsetX,a.offsetY),t.lineTo(n.offsetX,n.offsetY),t.stroke(),t.closePath())},release:function(e){e.ctx.globalCompositeOperation=ie.SourceOver,e.ctx.globalAlpha=1}}),a)),r),o}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.tool,n=e.startChanging,r=e.stopChanging,o=ke[t],c=o?o(this.props):0,i=this.handlers[t],s=i&&i[c];return console.log(s),a.createElement(oe,Object.assign({onDown:n,onUp:r,drawProcess:s&&s.draw,clickProcess:s&&s.click,releaseProcess:s&&s.release},this.props))}}]),t}(a.PureComponent),ke=(Pe={},Object(k.a)(Pe,S.Line,(function(e){return le()(e,"line.params.type")})),Object(k.a)(Pe,S.Brush,(function(e){return le()(e,"brush.params.type")})),Pe),De={startChanging:ye,stopChanging:je},Te=Object(f.b)((function(e){return{brush:e.brush,line:e.line,tool:e.tool.current,patterns:e.patterns}}),De)(we),Ae=(n(186),function(e){return{transform:"rotate(".concat(e.angle,"deg) translateY(").concat(-e.offset.y,"px) translateX(").concat(e.offset.x,"px)")}}),Re=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).state={style:Ae(e.rotation),rotation:e.rotation},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.currentTool,n=e.name,r=e.height,o=e.width,c=e.imageValue,i=e.selectionValue,s=e.selectionParams,u=e.onImageChange,l=e.onSelectionChange;e.rotation;return console.log("area",this.state),a.createElement("div",{className:"area"},a.createElement(Te,{patternId:n,style:this.state.style,value:c,width:o,height:r,onChange:u}),a.createElement(re,{style:this.state.style,isActive:-1!==M.indexOf(t),name:n,width:o,height:r,value:i,params:s,onChange:l}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return{rotation:e.rotation,style:Ae(e.rotation)}}}]),t}(a.PureComponent),Me=Object(f.b)((function(e){return{currentTool:e.tool.current}}),{})(Re),Ne=function(e){var t=e.value,n=e.onChange,r=e.min,o=void 0===r?0:r,c=e.max,i=void 0===c?1:c,s=e.step,u=void 0===s?.05:s,l=e.delay,p=e.notZero,h=a.useState(t),f=Object(L.a)(h,2),m=f[0],g=f[1];a.useEffect((function(){t!==m&&!Se&&g(t)}));return a.createElement("input",{type:"number",step:u,min:o,max:i,value:m,onChange:function(e){var a=+e.target.value;if(l)g(a),Se&&clearTimeout(Se),Se=setTimeout((function(){!p||a?(n(a),clearTimeout(Se),Se=null):g(t)}),l);else{if(p&&!a)return;g(a),n(a)}}})},Ie=function(e){var t=e.onChange,n=e.onFocus,r=e.onBlur,o=e.value,c=e.className;return a.createElement("input",{className:m(c,"input-text"),type:"text",value:o,onFocus:n,onBlur:r,onChange:function(e){t&&t(e.target.value)}})},Ve=(n(187),n(12));function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _e,Fe,Ue,Xe=function(e){var t=e.className,n=e.selected,r=e.onClick,o=e.onMouseDown,c=e.onMouseUp,i=Object(Ve.a)(e,["className","selected","onClick","onMouseDown","onMouseUp"]);return a.createElement(v,Object.assign({},i,{onClick:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return r&&r(Le({},e,{selected:n}))})),onMouseDown:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return o&&o(Le({},e,{selected:n}))})),onMouseUp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return c&&c(Le({},e,{selected:n}))})),className:m("button-select",t,Object(k.a)({},"button-select-selected",n))}))},Ye=n(17),He=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handlePress=function(e){e.preventRepeat();var t=n.props,a=t.onPress,r=t.keys;a&&a(e,r)},n.handleRelease=function(e){var t=n.props,a=t.onRelease,r=t.keys;a&&a(e,r)},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.keys;console.log(this.props),Ye.bind(e,this.handlePress,this.handleRelease)}},{key:"componentDidUpdate",value:function(e){e.keys!==this.props.keys&&(Ye.unbind(e.keys,this.handlePress,this.handleRelease),Ye.bind(this.props.keys,this.handlePress,this.handleRelease))}},{key:"componentWillUnmount",value:function(){Ye.unbind(this.props.keys,this.handlePress,this.handleRelease)}},{key:"render",value:function(){return console.log("keys render",this.props.keys),a.createElement(a.Fragment,null)}}]),t}(a.PureComponent);function Ge(e){var t=function(e){var t=0,n=0;if(!e)e=window.event;return e.pageX||e.pageY?(t=e.pageX,n=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:t,y:n}}(e),n=function(e){var t=_e=0;if(e.offsetParent)do{t+=e.offsetLeft,_e+=e.offsetTop}while(e=e.offsetParent);return{left:t,top:_e}}(function(e){var t;if(!e)e=window.event;return e.target?t=e.target:e.srcElement&&(t=e.srcElement),3==t.nodeType&&(t=t.parentNode),t}(e));return{x:t.x-n.left,y:t.y-n.top}}function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}!function(e){e.SIN="sin",e.LOOP="loop"}(Fe||(Fe={}));var Be,We=70,Ze=function(e){return e.toFixed(1)},qe={VerticalLinear:function(e){return function(t,n,a){return t-a/e}}},Ke=function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).handleDown=function(e){if(console.log("down"),!n.state.startValue){var t=e.e;t.persist();var a=n.props,r=a.onMouseDown,o=a.name,c=a.selected,i=n.state.value;r&&r({e:t,value:i,name:o,selected:c}),n.setState((function(e){return{startValue:e.value,startPoint:[t.clientX,t.clientY]}}),(function(){document.addEventListener("mousemove",n.handleMove),document.addEventListener("mouseup",n.handleUp)}))}},n.handleMove=function(e){var t=n.props,a=t.onChange,r=t.name,o=t.selected,c=n.calcValue(e);console.log("move",c),a&&a({e:e,value:c,name:r,selected:o}),n.setState({value:c})},n.handleUp=function(e){var t=n.props,a=(t.changingStartValue,t.onClick),r=t.onMouseUp,o=t.onChange,c=t.name,i=t.selected,s=t.width,u=void 0===s?We:s,l=t.precision,p=void 0===l?100:l,h=t.range,f=n.calcValue(e),m=(h[1]-h[0])/p;if(Math.abs(f-n.state.startValue)<m){var g=Ge(e).x;console.log("11111",g,u/2,n.state.startValue),f=Math.min(Math.max(n.state.startValue+(g>u/2?m:-m),h[0]),h[1]),console.log(f,"=",n.state.startValue,"+",g>u/2?1:-1),o&&o({e:e,value:f,name:c,selected:i})}else r&&r({e:e,value:f,name:c,selected:i}),a&&a({value:f,name:c,e:e,selected:i});n.setState({value:f,startValue:null,startPoint:null},(function(){document.removeEventListener("mousemove",n.handleMove),document.removeEventListener("mouseup",n.handleUp)}))},n.handlePress=function(e){if(!n.state.startValue){var t=n.props,a=t.onPress,r=t.name,o=t.selected,c=n.state.value;a&&a({e:e,value:c,name:r,selected:o}),n.setState((function(e){return{startValue:e.value,startPoint:null}}),(function(){document.addEventListener("mousemove",n.handlePressed)}))}},n.handlePressed=function(e){if(n.state.startPoint){var t=n.props,a=t.onChange,r=t.name,o=t.selected,c=n.calcValue(e);a&&a({e:e,value:c,name:r,selected:o}),n.setState({value:c})}else n.setState({startPoint:[e.clientX,e.clientY]})},n.handleRelease=function(e){var t=n.props,a=t.onRelease,r=t.name,o=t.selected,c=n.state.value;a&&a({value:c,name:r,e:e,selected:o}),n.setState({value:c,startValue:null,startPoint:null},(function(){document.removeEventListener("mousemove",n.handlePressed)}))},n.calcValue=function(e){console.log(n.state.startValue);var t=n.props,a=t.range,r=t.valueD,o=void 0===r?qe.VerticalLinear(5):r,c=t.integer,i=o(n.state.startValue,e.clientX-n.state.startPoint[0],e.clientY-n.state.startPoint[1]);return i=Math.min(Math.max(i,a[0]),a[1]),c&&(i=Math.round(i)),i};var a=e.range;return n.state={value:e.value||a[0],startPoint:null,startValue:null,changing:!1},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return t.value!==this.state.value||e.changingStartValue!==this.props.changingStartValue||e.changeFunctionParams!==this.props.changeFunctionParams||e.changeFunctionId!==this.props.changeFunctionId||e.shortcut!==this.props.shortcut||e.className!==this.props.className}},{key:"render",value:function(){var e=this.props,t=e.changingStartValue,n=e.changeFunctionId,r=e.changeFunctionType,o=e.changeFunctionParams,c=e.range,i=e.width,s=void 0===i?We:i,u=e.className,l=e.getText,p=void 0===l?Ze:l,h=e.text,f=e.shortcut,g=Object(Ve.a)(e,["changingStartValue","changeFunctionId","changeFunctionType","changeFunctionParams","range","width","className","getText","text","shortcut"]),v=this.state,d=v.value,O=void 0===d?0:d,b=v.startValue;console.log("number button render",p(O));var y=Je[r];return a.createElement(Xe,Object.assign({},g,{className:m("button-number",u,Object(k.a)({},"button-number-active",!!b)),width:s,onMouseDown:this.handleDown}),a.createElement("div",{className:"button-number-value",style:{width:(O-c[0])/(c[1]-c[0])*100+"%"}},p?p(O):h),n&&a.createElement(y,{range:c,params:o,changingStartValue:t,changeFunctionId:n}),f&&a.createElement(He,{keys:f,onPress:this.handlePress,onRelease:this.handleRelease}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t.startPoint||e.value===t.value?{}:{value:e.value})}}]),t}(a.Component),Je=(Ue={},Object(k.a)(Ue,Fe.SIN,(function(e){var t=e.range,n=e.params,r=e.changingStartValue,o=e.changeFunctionId,c=r/(t[1]-t[0]),i=Math.min(c,n.a)+Math.min(1-c,n.a);return a.createElement("div",{className:"button-number-amplitude",style:{width:100*i+"%",left:"calc(".concat(100*Math.max(c-n.a,0),"%)")}},a.createElement("span",null,o))})),Object(k.a)(Ue,Fe.LOOP,(function(e){e.range;var t=e.params,n=(e.changingStartValue,e.changeFunctionId);return a.createElement("div",{className:"button-number-amplitude",style:{width:100*(t.end-t.start)+"%",left:"".concat(100*t.start,"%")}},a.createElement("span",null,n))})),Ue),$e=function(e){return e.value},Qe=function(e){return e.text},et=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleClick=function(e){var t=e.value,a=(e.selected,e.e),r=n.props,o=r.name,c=r.items,i=r.onChange,s=r.getValue,u=void 0===s?$e:s,l=r.nullAble,p=r.value,h=u(t);l&&p===h&&(h=null),i&&i({value:h,e:a,item:t,items:c,name:o})},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.className,r=t.items,o=t.value,c=t.name,i=t.getValue,s=void 0===i?$e:i,u=t.getText,l=void 0===u?Qe:u,p=t.br;return console.log("select buttons render",c),a.createElement("span",{className:m(n,"select-buttons")},r.map((function(t,n){return a.createElement(a.Fragment,null,!!p&&!!n&&!(n%p)&&a.createElement("br",null),a.createElement(Xe,{value:t,key:s(t),selected:s(t)===o,onMouseUp:function(e){console.log(e)},onClick:e.handleClick},l(t)))})))}}]),t}(a.PureComponent),tt=(n(190),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.className,n=Object(Ve.a)(e,["className"]),r=n.value;n.getText;return console.log("select drop render",n.name,r),a.createElement("div",{className:m(t,"select-drop")},a.createElement(v,{className:"select-drop-value"},r||"null"),a.createElement(et,Object.assign({},n,{className:"select-drop-items"})))}}]),t}(a.PureComponent));!function(e){e.SET_VALUE_IN_CHANGING_LIST="changing-values/set-value",e.SET_START_VALUE="changing-values/set-start-value",e.ACTIVATE_VALUE_CHANGING="changing-values/activate",e.DEACTIVATE_VALUE_CHANGING="changing-values/deactivate"}(Be||(Be={}));n(191),n(192);var nt,at=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.button,r=e.className;return a.createElement("div",{className:m("hover-hideable",r)},n,a.createElement("div",{className:"hover-hideable-hidden-part"},t))}}]),t}(a.PureComponent),rt=(n(193),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleChange=function(e){n.props.onChange("Backspace"===e.key?null:e.key)},n.handleFocus=function(){Ye.bind("",n.handleChange)},n.handleBlur=function(){Ye.unbind("",n.handleChange)},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.value;return a.createElement(Ie,{className:"shortcut-input",value:e,onFocus:this.handleFocus,onBlur:this.handleBlur,onChange:function(){}})}}]),t}(a.PureComponent)),ot=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={changeFunctionsItems:[],changeFunctions:null,active:!1,shortcut:null},n.handleCFChange=function(e){var t=e.value,a=n.props;(0,a.setValueInChangingList)(a.path,t,a.range,a.value)},n.handleChange=function(e){n.props.onChange(e);var t=n.props;(0,t.setStartValue)(t.path,t.value)},n.handleStartManualChanging=function(){var e=n.props;(0,e.deactivateValueChanging)(e.path),n.setState({active:!0})},n.handleStopManualChanging=function(){var e=n.props;(0,e.activateValueChanging)(e.path),n.setState({active:!1})},n.handleShortcutChange=function(e){return n.setState({shortcut:e})},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.changeFunctions,n=e.changingValues,r=e.path,o=Object(Ve.a)(e,["changeFunctions","changingValues","path"]),c=(o.onChange,o.onMouseDown,o.onMouseUp,o.onPress,o.onRelease,Object(Ve.a)(o,["onChange","onMouseDown","onMouseUp","onPress","onRelease"]));console.log("render b cf");var i=n[r],s=i&&i.startValue,u=i&&n[r].changeFunctionId,l=i&&t[u].params,p=i&&t[u].type;return a.createElement(at,{className:"button-number-cf",button:a.createElement(Ke,Object.assign({},c,{shortcut:this.state.shortcut,className:m("button-number-cf-value",Object(k.a)({},"button-number-cf-value-active",this.state.active)),changeFunctionId:u,changeFunctionType:p,changingStartValue:s,changeFunctionParams:l,onChange:this.handleChange,onMouseDown:this.handleStartManualChanging,onPress:this.handleStartManualChanging,onMouseUp:this.handleStopManualChanging,onRelease:this.handleStopManualChanging}))},!this.state.active&&a.createElement(at,{className:"button-number-cf-settings",button:a.createElement("div",{className:"button-number-cf-settings-handler"},a.createElement("div",null))},a.createElement(rt,{value:this.state.shortcut,onChange:this.handleShortcutChange}),a.createElement(tt,{nullAble:!0,className:"button-number-cf-select",value:n[this.props.path]&&n[this.props.path].changeFunctionId,onChange:this.handleCFChange,items:this.state.changeFunctionsItems})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.changeFunctions!==t.changeFunctions?{changeFunctions:e.changeFunctions,changeFunctionsItems:B(e.changeFunctions,(function(e){return e.id}),(function(e){return e.id}))}:null}}]),t}(a.PureComponent),ct={setValueInChangingList:function(e,t,n,a){return function(r){r(fe(e)),r({type:Be.SET_VALUE_IN_CHANGING_LIST,path:e,changeFunctionId:t,range:n,startValue:a})}},deactivateValueChanging:function(e){return function(t,n){n().changingValues[e]&&(t(fe(e)),t({type:Be.DEACTIVATE_VALUE_CHANGING,path:e}))}},activateValueChanging:function(e){return function(t,n){n().changingValues[e]&&t({type:Be.ACTIVATE_VALUE_CHANGING,path:e})}},toStartValue:fe,setStartValue:function(e,t){return function(n){n({type:Be.SET_START_VALUE,path:e,startValue:t})}}},it=Object(f.b)((function(e){return{changeFunctions:e.changeFunctions,changingValues:e.changingValues}}),ct)(ot),st=[0,1];var ut,lt="black";!function(e){e.sourceOver="source-over",e.destinationOver="destination-over",e.destinationOut="destination-out"}(ut||(ut={}));var pt=function(e){return{transform:"rotate(".concat(e.angle,"deg) translateY(").concat(-e.offset.y,"px) translateX(").concat(e.offset.x,"px)")}},ht=function(e){function t(e){var n,a,r,o;return Object(s.a)(this,t),(o=Object(l.a)(this,Object(p.a)(t).call(this,e))).handlers=(r={},Object(k.a)(r,S.Brush,(n={},Object(k.a)(n,J.Square,{draw:function(e){var t=e.ctx,n=e.e,a=o.props.params,r=a.black,c=a.opacity,i=o.props.brush.params.size;t.fillStyle=lt,t.globalAlpha=c,t.globalCompositeOperation=r?ut.destinationOver:ut.destinationOut,t.fillRect(n.offsetX-i/2,n.offsetY-i/2,i,i),t.globalCompositeOperation=ut.sourceOver,t.globalAlpha=1},click:function(e){var t=e.ctx,n=e.e,a=o.props.params,r=a.black,c=a.opacity,i=o.props.brush.params.size;t.fillStyle=lt,t.globalAlpha=c,t.globalCompositeOperation=r?ut.destinationOver:ut.destinationOut,t.fillRect(n.offsetX-i/2,n.offsetY-i/2,i,i),t.globalCompositeOperation=ut.sourceOver,t.globalAlpha=1}}),Object(k.a)(n,J.Circle,{draw:function(e){var t=e.ctx,n=e.e,a=o.props.params,r=a.black,c=a.opacity,i=o.props.brush.params.size;t.fillStyle=lt,t.globalAlpha=c,t.globalCompositeOperation=r?ut.destinationOver:ut.destinationOut,t.beginPath(),t.arc(n.offsetX,n.offsetY,i/2,0,2*Math.PI),t.fill(),t.globalCompositeOperation=ut.sourceOver,t.globalAlpha=1},click:function(e){var t=e.ctx,n=e.e,a=o.props.brush.params.size,r=o.props.params,c=r.black,i=r.opacity;t.fillStyle=lt,t.globalAlpha=i,t.globalCompositeOperation=c?ut.destinationOver:ut.destinationOut,t.beginPath(),t.arc(n.offsetX,n.offsetY,a/2,0,2*Math.PI),t.fill(),t.globalCompositeOperation=ut.sourceOver,t.globalAlpha=1}}),n)),Object(k.a)(r,S.Line,(a={},Object(k.a)(a,ce.Default,{click:function(e){var t=e.ctx,n=e.e,a=o.props.line.params.size,r=o.props.params,c=r.black,i=r.opacity;t.globalAlpha=i,t.globalCompositeOperation=c?ut.destinationOver:ut.destinationOut,t.strokeStyle=lt,t.beginPath(),t.lineWidth=a,t.moveTo(n.offsetX,n.offsetY)},draw:function(e){var t=e.ctx,n=e.e,a=o.props.line.params;a.size,a.opacity;t.lineTo(n.offsetX,n.offsetY),t.stroke()},release:function(e){e.ctx.globalCompositeOperation=ie.SourceOver,e.ctx.globalAlpha=1,e.ctx.closePath()}}),Object(k.a)(a,ce.Interrupted,{click:function(e){var t=e.ctx,n=(e.e,o.props.line.params.size),a=o.props.params,r=a.black,c=a.opacity;t.strokeStyle=lt,t.globalAlpha=c,t.globalCompositeOperation=r?ut.destinationOver:ut.destinationOut,t.lineWidth=n,t.beginPath()},draw:function(e){var t=e.ctx,n=e.e,a=e.pre,r=o.props.line.params;r.size,r.opacity;a&&(t.moveTo(a.offsetX,a.offsetY),t.lineTo(n.offsetX,n.offsetY),t.stroke())},release:function(e){e.ctx.globalCompositeOperation=ie.SourceOver,e.ctx.globalAlpha=1,e.ctx.closePath()}}),Object(k.a)(a,ce.InterruptedOneStroke,{click:function(e){var t=e.ctx,n=(e.e,o.props.line.params.size),a=o.props.params,r=a.black,c=a.opacity;t.strokeStyle=lt,t.globalAlpha=c,t.globalCompositeOperation=r?ut.destinationOver:ut.destinationOut,t.lineWidth=n},draw:function(e){var t=e.ctx,n=e.e,a=e.pre,r=o.props.line.params;r.size,r.opacity;a&&(t.beginPath(),t.moveTo(a.offsetX,a.offsetY),t.lineTo(n.offsetX,n.offsetY),t.stroke(),t.closePath())},release:function(e){e.ctx.globalCompositeOperation=ie.SourceOver,e.ctx.globalAlpha=1}}),a)),r),o.handleOpacityChange=function(e){var t=e.value;return o.props.onParamsChange(Object(k.a)({},"opacity",t))},o.handleBlackChange=function(e){return o.props.onParamsChange(Object(k.a)({},"black",!e.selected))},o.state={style:pt(e.rotation),rotation:e.rotation},o}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.tool,n=e.startChanging,r=e.stopChanging,o=e.params,c=e.name,i=ft[t],s=i?i(this.props):0,u=this.handlers[t],l=u&&u[s];return a.createElement(a.Fragment,null,a.createElement("div",null,a.createElement(it,{path:"patterns.".concat(c,".mask.params.opacity"),name:"opacity",range:st,value:o.opacity,onChange:this.handleOpacityChange}),a.createElement("div",null,a.createElement(Xe,{name:"black",selected:o.black,onClick:this.handleBlackChange}))),a.createElement(oe,Object.assign({style:this.state.style,className:"maskCanvas",onDown:n,onUp:r,drawProcess:l&&l.draw,clickProcess:l&&l.click,releaseProcess:l&&l.release},this.props)))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return{rotation:e.rotation,style:pt(e.rotation)}}}]),t}(a.PureComponent),ft=(nt={},Object(k.a)(nt,S.Line,(function(e){return le()(e,"line.params.type")})),Object(k.a)(nt,S.Brush,(function(e){return le()(e,"brush.params.type")})),nt),mt={startChanging:ye,stopChanging:je},gt=Object(f.b)((function(e){return{brush:e.brush,line:e.line,tool:e.tool.current}}),mt)(ht);function vt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vt(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ot=[0,360],bt=qe.VerticalLinear(.4),yt=[-200,200],jt=qe.VerticalLinear(.6),Pt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleAngleChange=function(e){var t=e.value,a=n.props;(0,a.onChange)(dt({},a.rotation,{angle:t}))},n.handleOffsetChange=function(e){var t=e.value,a=e.name,r=n.props,o=r.onChange,c=r.rotation;o(dt({},c,{offset:dt({},c.offset,Object(k.a)({},a,t))}))},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.rotation,t=e.angle,n=e.offset;return a.createElement("div",null,a.createElement(it,{path:"patterns.".concat(this.props.patternId,".rotation.value.angle"),name:"angle",value:t,range:Ot,valueD:bt,onChange:this.handleAngleChange}),a.createElement(it,{path:"patterns.".concat(this.props.patternId,".rotation.value.offset.x"),name:"x",value:n.x,range:yt,valueD:jt,onChange:this.handleOffsetChange}),a.createElement(it,{path:"patterns.".concat(this.props.patternId,".rotation.value.offset.y"),name:"y",value:n.y,range:yt,valueD:jt,onChange:this.handleOffsetChange}))}}]),t}(a.PureComponent);function Ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ct(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ct(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var St=[1,10],wt=qe.VerticalLinear(9),kt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleGridParamsChange=function(e){var t=e.value,a=e.name,r=n.props,o=r.onChange,c=r.repeating;o(Et({},c,{gridParams:Et({},c.gridParams,Object(k.a)({},a,t))}))},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.repeating,t=e.type,n=e.gridParams;return a.createElement("div",null,t===ve.Grid&&a.createElement(a.Fragment,null,a.createElement(it,{path:"patterns.".concat(this.props.patternId,".repeating.params.gridParams.x"),name:"x",value:n.x,range:St,valueD:wt,onChange:this.handleGridParamsChange}),a.createElement(it,{path:"patterns.".concat(this.props.patternId,".repeating.params.gridParams.y"),name:"y",value:n.y,range:St,valueD:wt,onChange:this.handleGridParamsChange})))}}]),t}(a.PureComponent);function Dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Tt,At={min:0,max:500,step:1,delay:1e3,notZero:!0},Rt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={roomName:"222"},n.handleImageChange=function(e){return n.props.onImageChange(n.props.id,e)},n.handleMaskChange=function(e){return n.props.onMaskChange(n.props.id,e)},n.handleSelectionChange=function(e){return n.props.onSelectionChange(n.props.id,e)},n.handleClearSelection=function(){return n.props.onSelectionChange(n.props.id,[])},n.handleRemove=function(){return n.props.onRemove(n.props.id)},n.handleUndo=function(){return n.props.onUndo(n.props.id)},n.handleRedo=function(){return n.props.onRedo(n.props.id)},n.handleSetWidth=function(e){return n.props.onSetWidth(n.props.id,e)},n.handleSetHeight=function(e){return n.props.onSetHeight(n.props.id,e)},n.handleMaskParamsChange=function(e){return n.props.onMaskParamsChange(n.props.id,e)},n.handleCreateRoom=function(){n.props.onCreateRoom(n.props.id,n.state.roomName)},n.handleConfigToggle=function(e){n.props.onConfigChange(n.props.id,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dt(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.props.config,Object(k.a)({},e.name,!e.selected)))},n.handleRotationChange=function(e){n.props.onRotationChange(n.props.id,e)},n.handleRepeatingChange=function(e){n.props.onRepeatingChange(n.props.id,e)},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.connected,r=(t.resultImage,t.imageValue),o=t.maskValue,c=t.maskParams,i=t.height,s=t.width,u=t.id,l=t.config,p=t.history,h=(t.store,t.selection),f=t.rotation,m=t.repeating;return console.log("pattern render ",u,f),a.createElement("div",{className:"pattern"},a.createElement("div",{className:"areas"},a.createElement(Me,{name:u,width:s,height:i,rotation:f,imageValue:r,selectionValue:h.value,selectionParams:h.params,onImageChange:this.handleImageChange,onSelectionChange:this.handleSelectionChange}),l.mask&&a.createElement(gt,{rotation:f,params:c,value:o,name:u,width:s,height:i,onParamsChange:this.handleMaskParamsChange,onChange:this.handleMaskChange})),a.createElement("div",{className:"pattern-controls"},a.createElement(v,{onClick:this.handleRemove},"del")," ",u,n,a.createElement(Ie,{value:this.state.roomName,onChange:function(t){return e.setState({roomName:t})}}),a.createElement(v,{onClick:this.handleCreateRoom}),a.createElement(Ne,Object.assign({onChange:this.handleSetWidth,value:s},At)),a.createElement(Ne,Object.assign({onChange:this.handleSetHeight,value:i},At)),l.history&&a.createElement(D,{history:p.value,onUndo:this.handleUndo,onRedo:this.handleRedo}),h.value&&h.value.length&&a.createElement(v,{onClick:this.handleClearSelection},"clear"),l.rotation&&a.createElement(Pt,{patternId:u,rotation:f,onChange:this.handleRotationChange}),l.repeating&&a.createElement(kt,{patternId:u,repeating:m,onChange:this.handleRepeatingChange}),a.createElement("div",null,a.createElement(Xe,{name:"mask",selected:l.mask,onClick:this.handleConfigToggle},"mask"),a.createElement(Xe,{name:"repeating",selected:l.repeating,onClick:this.handleConfigToggle},"repeating"))))}}]),t}(a.PureComponent),Mt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleAddClick=function(){return n.props.addPattern({history:!0,selection:!0,rotation:!0,repeating:!0})},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.createRoom,n=e.removePattern,r=e.patterns,o=e.updateImage,c=e.updateMask,i=e.setMaskParams,s=e.updateSelection,u=e.undo,l=e.redo,p=e.setWidth,h=e.setHeight,f=e.editConfig,m=e.setRotation,g=e.setRepeating;return a.createElement(a.Fragment,null,r.map((function(e){var r=e.id,v=e.current,d=e.mask,O=e.config,b=e.history,y=e.store,j=e.selection,P=e.connected,C=e.resultImage,E=e.rotation,S=e.repeating;return a.createElement(Rt,{key:r,id:r,config:O,connected:P,history:b,store:y,selection:j,imageValue:v?v.imageData:null,maskValue:d?d.value.imageData:null,resultImage:C,maskParams:d?d.params:null,rotation:E?E.value:null,repeating:S?S.params:null,width:v?v.width:null,height:v?v.height:null,onUndo:u,onRedo:l,onImageChange:o,onMaskChange:c,onMaskParamsChange:i,onSelectionChange:s,onRemove:n,onSetWidth:p,onSetHeight:h,onCreateRoom:t,onConfigChange:f,onRotationChange:m,onRepeatingChange:g})})),a.createElement(v,{onClick:this.handleAddClick},"add"))}}]),t}(a.PureComponent),Nt={setMaskParams:function(e,t){return{type:j.SET_MASK_PARAMS,id:e,params:t}},createRoom:function(e,t){return function(n){var a=d("http://localhost:3002",{path:"/room",query:{name:t}});return a.on("image",(function(t){(function(e){return new Promise((function(t){var n=new Image;n.src=e,n.onload=function(){var e=document.createElement("canvas"),a=e.getContext("2d");if(!a)return null;e.width=n.width,e.height=n.height,a.drawImage(n,0,0),t(a.getImageData(0,0,e.width,e.height))}}))})(t).then((function(t){n(w(e,t,!1))}))})),n({type:j.CREATE_ROOM,id:e,roomName:t,socket:a})}},addPattern:function(e){return{type:y.ADD_PATTERN,config:e}},removePattern:function(e){return{type:y.REMOVE_PATTERN,id:e}},updateImage:w,updateSelection:function(e,t){return{type:j.UPDATE_SELECTION,value:t,id:e}},redo:function(e){return{type:j.REDO,id:e}},undo:function(e){return{type:j.UNDO,id:e}},setWidth:function(e,t){return{type:j.SET_WIDTH,id:e,width:t}},setHeight:function(e,t){return{type:j.SET_HEIGHT,id:e,height:t}},editConfig:function(e,t){return{type:j.EDIT_CONFIG,id:e,config:t}},updateMask:function(e,t){return{type:j.UPDATE_MASK,imageData:t,id:e}},setRotation:function(e,t){return{type:j.SET_ROTATION,id:e,rotation:t}},setRepeating:function(e,t){return{type:j.SET_REPEATING,id:e,repeating:t}}},It=Object(f.b)((function(e){return{patterns:Object.values(e.patterns)}}),Nt)(Mt);!function(e){e.SET_CURRENT="tools/set-current"}(Tt||(Tt={}));var Vt;!function(e){e.SET_PARAMS="brush/set-params"}(Vt||(Vt={}));var xt=n(15),Lt=Object(xt.a)([function(e){return e.patterns}],(function(e){return B(e,(function(e,t){return+t}))}));function _t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_t(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_t(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ut,Xt=[1,200],Yt=qe.VerticalLinear(.2),Ht=[0,5],Gt=qe.VerticalLinear(200),zt=[0,1],Bt=qe.VerticalLinear(100),Wt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleSizeChange=function(e){var t=e.value;console.log(t),n.props.setBrushParams(Ft({},n.props.paramsValue,{size:t}))},n.handlePatternChange=function(e){var t=e.value;n.props.setBrushParams(Ft({},n.props.paramsValue,{pattern:+t}))},n.handleCompositeChange=function(e){var t=e.value;n.props.setBrushParams(Ft({},n.props.paramsValue,{compositeOperation:t}))},n.handleOpacityChange=function(e){var t=e.value;n.props.setBrushParams(Ft({},n.props.paramsValue,{opacity:t}))},n.handleTypeChange=function(e){var t=e.value;n.props.setBrushParams(Ft({},n.props.paramsValue,{type:t}))},n.handleParamChange=function(e){var t=e.value,a=e.name;n.props.setBrushParams(Ft({},n.props.paramsValue,Object(k.a)({},a,t)))},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.paramsConfig,e.paramsConfigMap),n=e.paramsValue,r=(e.setBrushParams,e.patternsSelectItems);return a.createElement(a.Fragment,null,a.createElement(et,{value:n.type,items:t.type.props.items,onChange:this.handleTypeChange}),a.createElement("br",null),n.type===J.Pattern?a.createElement(it,{path:"brush.params.patternSize",value:n.patternSize,name:"patternSize",onChange:this.handleParamChange,range:Ht,valueD:Gt}):a.createElement(it,{path:"brush.params.size",value:n.size,name:"size",onChange:this.handleSizeChange,range:Xt,valueD:Yt}),a.createElement(it,{path:"brush.params.opacity",value:n.opacity,name:"opacity",onChange:this.handleOpacityChange,range:zt,valueD:Bt}),a.createElement(tt,{value:n.compositeOperation,items:t.compositeOperation.props.items,onChange:this.handleCompositeChange}),a.createElement("br",null),n.type===J.Pattern&&a.createElement(et,{value:n.pattern,onChange:this.handlePatternChange,items:r}))}}]),t}(a.PureComponent),Zt=Object(xt.a)([function(e){return e.brush.paramsConfig}],(function(e){return e.reduce((function(e,t){return e[t.name]=t,e}),{})})),qt={setBrushParams:function(e){return{type:Vt.SET_PARAMS,params:e}}},Kt=Object(f.b)((function(e){return{paramsConfig:e.brush.paramsConfig,paramsConfigMap:Zt(e),paramsValue:e.brush.params,patternsSelectItems:Lt(e)}}),qt)(Wt);!function(e){e.SET_PARAMS="line/set-params"}(Ut||(Ut={}));function Jt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var $t,Qt=[1,200],en=qe.VerticalLinear(.2),tn=[0,1],nn=qe.VerticalLinear(100),an=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleParamChange=function(e){var t=e.value,a=e.name,r=n.props;(0,r.setLineParams)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jt(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r.paramsValue,Object(k.a)({},a,t)))},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.paramsConfigMap,n=(e.paramsConfig,e.paramsValue),r=e.patternsSelectItems;return a.createElement(a.Fragment,null,a.createElement(et,{br:3,value:n.type,name:"type",items:t.type.props.items,onChange:this.handleParamChange}),a.createElement("br",null),a.createElement(it,{path:"line.params.size",value:n.size,name:"size",onChange:this.handleParamChange,range:Qt,valueD:en}),a.createElement(it,{path:"line.params.opacity",value:n.opacity,name:"opacity",onChange:this.handleParamChange,range:tn,valueD:nn}),a.createElement(tt,{name:"compositeOperation",value:n.compositeOperation,items:t.compositeOperation.props.items,onChange:this.handleParamChange}),a.createElement("br",null),n.type===ce.Pattren&&a.createElement(et,{name:"pattern",value:n.pattern,onChange:this.handleParamChange,items:r}))}}]),t}(a.PureComponent),rn=Object(xt.a)([function(e){return e.line.paramsConfig}],(function(e){return e.reduce((function(e,t){return e[t.name]=t,e}),{})})),on={setLineParams:function(e){return{type:Ut.SET_PARAMS,params:e}}},cn=Object(f.b)((function(e){return{paramsConfig:e.line.paramsConfig,paramsConfigMap:rn(e),paramsValue:e.line.params,patternsSelectItems:Lt(e)}}),on)(an);!function(e){e.SET_PARAMS="select/set-params"}($t||($t={}));function sn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var un,ln,pn=qe.VerticalLinear(100),hn=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleParamChange=function(e){var t=e.value,a=e.name,r=n.props;(0,r.setSelectToolParams)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sn(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r.paramsValue,Object(k.a)({},a,t)))},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.paramsValue,r=t.paramsConfigMap,o=(t.paramsConfig,t.setSelectToolParams,r.mode),c=r.curveType,i=Object(Ve.a)(r,["mode","curveType"]);return a.createElement(a.Fragment,null,a.createElement(tt,{name:"mode",value:n.mode,items:o.props.items,onChange:this.handleParamChange}),n.mode===q.Points&&a.createElement(tt,{name:"curveType",value:n.curveType,items:c.props.items,onChange:this.handleParamChange}),Object.values(i).map((function(t){var r=t.name,o=t.props;return a.createElement(it,{value:n[r],name:r,path:"selectTool.params.".concat(r),range:o.range,onChange:e.handleParamChange,valueD:pn})})))}}]),t}(a.PureComponent),fn=Object(xt.a)([function(e){return e.selectTool.paramsConfig}],(function(e){return e.reduce((function(e,t){return e[t.name]=t,e}),{})})),mn={setSelectToolParams:function(e){return{type:$t.SET_PARAMS,params:e}}},gn=Object(f.b)((function(e){return{paramsConfig:e.selectTool.paramsConfig,paramsValue:e.selectTool.params,paramsConfigMap:fn(e)}}),mn)(hn),vn=n(257);!function(e){e.ON="fullscreen/on",e.OFF="fullscreen/off",e.SET="fullscreen/set",e.REVERSE="fullscreen/reverse"}(ln||(ln={}));var dn,On,bn=Object(vn.a)((un={},Object(k.a)(un,ln.ON,(function(){return!0})),Object(k.a)(un,ln.OFF,(function(){return!1})),Object(k.a)(un,ln.SET,(function(e,t){return t.value})),Object(k.a)(un,ln.REVERSE,(function(e){return!e})),un),!1),yn=(dn={},Object(k.a)(dn,S.Brush,{component:Kt,type:S.Brush}),Object(k.a)(dn,S.Line,{component:cn,type:S.Line}),Object(k.a)(dn,S.Select,{component:gn,type:S.Select}),dn),jn={setCurrentTool:function(e){return{type:Tt.SET_CURRENT,tool:e}},reverseFullScreen:function(){return{type:ln.REVERSE}}},Pn=Object(f.b)((function(e){return{currentTool:e.tool.current}}),jn)((function(e){var t=e.currentTool,n=e.setCurrentTool,r=e.reverseFullScreen,o=yn[t].component;return a.createElement("div",{className:"tools"},a.createElement(v,{onClick:r},"full"),a.createElement("div",null,Object.keys(yn).map((function(e){return a.createElement(Xe,{key:e,selected:e===t,onClick:function(){return n(yn[e].type)}},e)}))),a.createElement(o,null))}));!function(e){e.UPDATE_ROOMS="rooms/update",e.CONNECT_ROOMS="rooms/connect"}(On||(On={}));var Cn,En=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleRoomConnect=function(e){console.log(e)},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.roomsConnect()}},{key:"render",value:function(){var e=this,t=this.props.rooms;return a.createElement(a.Fragment,null,t.map((function(t){return a.createElement(v,{onClick:e.handleRoomConnect,value:t},t.name)})))}}]),t}(a.PureComponent),Sn={roomsConnect:function(){return function(e){return d("http://localhost:3002",{path:"/rooms"}).on("updateRooms",(function(t){e(function(e){return{type:On.UPDATE_ROOMS,rooms:e}}(Object.values(t)))})),e({type:On.CONNECT_ROOMS})}}},wn=Object(f.b)((function(e){return{rooms:e.rooms.rooms}}),Sn)(En);!function(e){e.ADD_CF="change-functions/add",e.CHANGE_PARAMS="change-functions/change-params"}(Cn||(Cn={}));n(85);function kn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Dn=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleParamChange=function(e){var t=e.value,a=e.name;n.props.onChange(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kn(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.props.params,Object(k.a)({},a,t)),n.props.name)},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.params,n=(e.paramsConfig,e.onChange,e.name);return a.createElement("div",{className:"sin-change-function"},a.createElement(it,{path:"changeFunctions.".concat(n,".params.a"),value:t.a,name:"a",range:[0,1],valueD:qe.VerticalLinear(100),onChange:this.handleParamChange}),a.createElement(it,{path:"changeFunctions.".concat(n,".params.t"),value:t.t,name:"t",range:[0,1e3],valueD:qe.VerticalLinear(.05),onChange:this.handleParamChange}))}}]),t}(a.PureComponent);function Tn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var An,Rn=[0,3e3],Mn=qe.VerticalLinear(.05),Nn=[0,1],In=qe.VerticalLinear(100),Vn=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleParamChange=function(e){var t=e.value,a=e.name;n.props.onChange(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tn(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.props.params,Object(k.a)({},a,t)),n.props.name)},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.params,n=(e.paramsConfig,e.onChange,e.name);return a.createElement("div",{className:"sin-change-function"},a.createElement(it,{path:"changeFunctions.".concat(n,".params.start"),value:t.start,name:"start",valueD:In,range:Nn,onChange:this.handleParamChange}),a.createElement(it,{path:"changeFunctions.".concat(n,".params.end"),value:t.end,name:"end",valueD:In,range:Nn,onChange:this.handleParamChange}),a.createElement(it,{path:"changeFunctions.".concat(n,".params.t"),value:t.t,name:"t",valueD:Mn,range:Rn,onChange:this.handleParamChange}))}}]),t}(a.PureComponent),xn=(An={},Object(k.a)(An,Fe.SIN,Dn),Object(k.a)(An,Fe.LOOP,Vn),An),Ln=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e};return Object.keys(e).map((function(a){return{value:t(e[a],a),text:n(e[a],a)}}))}(pe);console.log(Ln);var _n=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleChange=function(e,t){n.props.changeCFParams(t,e)},n.handleAddSin=function(){n.props.addCF(Fe.SIN)},n.handleAddLoop=function(){n.props.addCF(Fe.LOOP)},n.handleModeChange=function(e){var t=e.value;n.props.setChangingMode(t)},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.cfs,r=t.changingMode;return a.createElement("div",null,Object.values(n).map((function(t){var n=t.type,r=t.id,o=t.params,c=t.paramsConfig,i=xn[n];return a.createElement(i,{key:r,name:r,params:o,paramsConfig:c,onChange:e.handleChange})})),a.createElement(v,{onClick:this.handleAddSin},"sin"),a.createElement(v,{onClick:this.handleAddLoop},"loop"),a.createElement(et,{items:Ln,value:r,onChange:this.handleModeChange}))}}]),t}(a.PureComponent),Fn={changeCFParams:function(e,t){return{type:Cn.CHANGE_PARAMS,params:t,id:e}},addCF:function(e){return{type:Cn.ADD_CF,cfType:e}},startChanging:Oe,stopChanging:be,setChangingMode:function(e){return function(t,n){var a=n().changing.mode;if(a!==e)return e===pe.OnDraw?a===pe.On&&(t(me()),t(be())):e===pe.On?t(Oe()):e===pe.Off&&a===pe.On&&(t(me()),t(be())),t({type:he.SET_MODE,mode:e})}}},Un=Object(f.b)((function(e){return{cfs:e.changeFunctions,changingMode:e.changing.mode}}),Fn)(_n),Xn=n(103),Yn=n.n(Xn),Hn=Object(f.b)((function(e){return{full:e.fullScreen}}),{setFullScreen:function(e){return{type:ln.SET,value:e}}})((function(e){var t=e.full,n=e.setFullScreen;return a.createElement(Yn.a,{enabled:t,onChange:n},a.createElement("div",{className:"layout-container"},a.createElement("div",{className:"layout"},a.createElement("div",{className:"tools-panel"},a.createElement(Pn,null)),a.createElement("div",{className:"windows"},a.createElement(It,null),a.createElement(wn,null),a.createElement(Un,null)))))})),Gn=function(e){return Object(i.a)(e),a.createElement(Hn,null)},zn=n(24),Bn=n(104),Wn=n.n(Bn),Zn=n(105),qn=n(106);function Kn(e,t){return{imageData:document.createElement("canvas").getContext("2d").createImageData(e,t),width:e,height:t}}var Jn=n(107);function $n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Qn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$n(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$n(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ea,ta=function(e,t){return function(n,a,r){if(n)return{value:a?a.value:e,params:r?Qn({},a?a.params:t,{},r):a?a.params:t}}},na=ta({before:[],after:[]},{length:4}),aa=ta(null,{}),ra=ta(null,{}),oa=function(e,t){return ta(Kn(e,t),{opacity:1,black:!0})},ca=ta({angle:0,offset:{x:0,y:0}},{}),ia=ta({},{type:ve.Grid,gridParams:{x:2,y:2}}),sa=function(e){return function(t,n){return Qn({},t,Object(k.a)({},n.id,e(t[n.id],n,t)))}},ua=function(e,t){var n=e.value.before,a=e.params.length,r=[].concat(Object(x.a)(n),[t]);return r.length>a&&r.shift(),Qn({},e,{value:{before:r,after:[]}})};function la(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function pa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?la(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):la(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ha=Object(vn.a)((ea={},Object(k.a)(ea,y.ADD_PATTERN,(function(e,t){var n=function(e){return(Object.keys(e).length?Math.max.apply(Math,Object(x.a)(Object.keys(e).map((function(e){return+e}))))+1:1).toString()}(e);return pa({},e,Object(k.a)({},n,function(e,t,n){var a=t||{},r=a.width,o=void 0===r?300:r,c=a.height,i=void 0===c?300:c,s=a.history,u=a.store,l=a.selection,p=a.mask,h=a.rotation,f=a.repeating;return{id:e,config:t,resultImage:null,current:Kn(o,i),history:na(s,void 0,(n||{}).history),store:aa(u,void 0,(n||{}).store),selection:ra(l,void 0,(n||{}).selection),mask:oa(o,i)(p,void 0,(n||{}).mask),rotation:ca(h,void 0,(n||{}).rotation),repeating:ia(f,void 0,(n||{}).repeating)}}(n,t.config)))})),Object(k.a)(ea,y.REMOVE_PATTERN,(function(e,t){return function(e,t){return Object(Jn.omit)(e,t)}(e,t.id)})),Object(k.a)(ea,j.EDIT_CONFIG,sa((function(e,t){return function(e,t,n){var a=t||{},r=a.history,o=a.store,c=a.selection,i=a.mask,s=a.rotation,u=a.repeating;return n=n||{},{config:t,id:e.id,current:e.current,resultImage:e.resultImage,history:na(r,e.history,n.history),store:aa(o,e.store,n.store),selection:ra(c,e.selection,n.selection),mask:oa(e.current.width,e.current.height)(i,e.mask,n.mask),rotation:ca(s,e.rotation,n.rotation),repeating:ia(u,e.repeating,n.repeating)}}(e,t.config)}))),Object(k.a)(ea,j.SET_WIDTH,sa((function(e,t){return pa({},e,{current:pa({},e.current,{width:t.width,imageData:P(e.current.imageData,t.width,e.current.height)}),mask:e.mask&&pa({},e.mask,{value:pa({},e.mask.value,{width:t.width,imageData:P(e.mask.value.imageData,t.width,e.mask.value.height)})}),history:e.history&&ua(e.history,{current:e.current,maskValue:e.mask&&e.mask.value})})}))),Object(k.a)(ea,j.SET_HEIGHT,sa((function(e,t){return pa({},e,{current:pa({},e.current,{height:t.height,imageData:P(e.current.imageData,e.current.width,t.height)}),mask:e.mask&&pa({},e.mask,{value:pa({},e.mask.value,{height:t.height,imageData:P(e.mask.value.imageData,e.mask.value.width,t.height)})}),history:e.history&&ua(e.history,{current:e.current,maskValue:e.mask&&e.mask.value})})}))),Object(k.a)(ea,j.SET_MASK_PARAMS,sa((function(e,t){return pa({},e,{mask:e.mask&&pa({},e.mask,{params:pa({},e.mask.params,{},t.params)})})}))),Object(k.a)(ea,j.UPDATE_IMAGE,sa((function(e,t){return pa({},e,{current:pa({},e.current,{imageData:t.imageData}),resultImage:E(t.imageData,e.mask&&e.mask.value.imageData),history:e.history&&ua(e.history,{current:e.current})})}))),Object(k.a)(ea,j.UPDATE_SELECTION,sa((function(e,t){return pa({},e,{selection:pa({},e.selection,{value:t.value})})}))),Object(k.a)(ea,j.UPDATE_MASK,sa((function(e,t){return pa({},e,{mask:pa({},e.mask,{value:pa({},e.mask.value,{imageData:t.imageData})}),resultImage:E(e.current.imageData,t.imageData),history:e.history&&ua(e.history,{maskValue:e.mask.value})})}))),Object(k.a)(ea,j.UNDO,sa((function(e){var t=function(e,t){var n=e.value,a=n.before,r=n.after;if(0===a.length)return null;var o=a[a.length-1];return{history:Qn({},e,{value:{before:a.slice(0,a.length-1),after:[t].concat(Object(x.a)(r))}}),prev:o}}(e.history,{current:e.current,maskValue:e.mask&&e.mask.value});return t?pa({},e,{history:t.history,current:t.prev.current||e.current,mask:e.mask&&pa({},e.mask,{value:t.prev.maskValue||e.mask.value})}):e}))),Object(k.a)(ea,j.REDO,sa((function(e){var t=function(e,t){var n=e.value,a=n.before,r=n.after;if(0===r.length)return null;var o=r[0];return{history:Qn({},e,{value:{before:[].concat(Object(x.a)(a),[t]),after:r.slice(1,r.length)}}),next:o}}(e.history,{current:e.current,maskValue:e.mask&&e.mask.value});return t?pa({},e,{history:t.history,current:t.next.current||e.current,mask:e.mask&&pa({},e.mask,{value:t.next.maskValue||e.mask.value})}):e}))),Object(k.a)(ea,j.SET_ROTATION,sa((function(e,t){return pa({},e,{rotation:e.rotation&&pa({},e.rotation,{value:t.rotation})})}))),Object(k.a)(ea,j.SET_REPEATING,sa((function(e,t){return pa({},e,{repeating:e.repeating&&pa({},e.repeating,{params:t.repeating})})}))),Object(k.a)(ea,j.CREATE_ROOM,sa((function(e,t){return pa({},e,{connected:t.roomName,socket:t.socket})}))),ea),{});function fa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var ma,ga,va=Object(vn.a)(Object(k.a)({},Tt.SET_CURRENT,(function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fa(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fa(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{current:t.tool})})),{current:S.Brush});function da(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}!function(e){e.Boolean="boolean",e.Number="number",e.Select="select"}(ga||(ga={}));var Oa=(ma={},Object(k.a)(ma,ga.Boolean,Xe),Object(k.a)(ma,ga.Select,et),Object(k.a)(ma,ga.Number,Ke),ma),ba=(a.PureComponent,Z(Object.values(J))),ya=Z(Object.values($)),ja=[1,200],Pa=qe.VerticalLinear(.5),Ca=[0,1],Ea=[0,5],Sa=qe.VerticalLinear(200),wa=function(e){return[{name:"size",type:ga.Number,props:{range:ja,valueD:Pa}},{name:"opacity",type:ga.Number,props:{range:Ca}},{name:"type",type:ga.Select,props:{items:ba}},{name:"compositeOperation",type:ga.Select,props:{items:ya}},{name:"patternSize",type:ga.Number,props:{range:Ea,valueD:Sa}}]};function ka(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Da=Object(vn.a)(Object(k.a)({},Vt.SET_PARAMS,(function(e,t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ka(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ka(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.params,{},t.params);return{paramsConfig:wa(),params:n}})),{params:{patternSize:1,size:5,opacity:1,type:J.Square},paramsConfig:wa()}),Ta=Z(Object.values(ce)),Aa=Z(Object.values(ie)),Ra=[1,200],Ma=qe.VerticalLinear(.5),Na=[0,1],Ia=function(e){return[{name:"size",type:ga.Number,props:{range:Ra,valueD:Ma}},{name:"opacity",type:ga.Number,props:{range:Na}},{name:"type",type:ga.Select,props:{items:Ta}},{name:"compositeOperation",type:ga.Select,props:{items:Aa}}]};function Va(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var xa,La=Object(vn.a)(Object(k.a)({},Ut.SET_PARAMS,(function(e,t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Va(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Va(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.params,{},t.params);return{paramsConfig:Ia(),params:n}})),{params:{size:5,opacity:1,type:ce.Default},paramsConfig:Ia()}),_a=function(e){var t=[{name:"mode",type:ga.Select,props:{items:te}}];return e&&e.mode===q.Points&&(t.push({name:"curveType",type:ga.Select,props:{items:ne}}),-1!==Object.keys(K).indexOf(e.curveType)&&(t=[].concat(Object(x.a)(t),[{name:K[e.curveType],type:ga.Number,props:{range:[0,1],text:1}}]))),t};function Fa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Ua,Xa,Ya,Ha,Ga=Object(vn.a)(Object(k.a)({},$t.SET_PARAMS,(function(e,t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fa(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fa(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.params,{},t.params);return{paramsConfig:_a(n),params:n}})),{params:(xa={mode:q.Rect,curveType:G.CurveLinear},Object(k.a)(xa,K[G.CurveBundle],0),Object(k.a)(xa,K[G.CurveCardinal],1),Object(k.a)(xa,K[G.CurveCatmullRom],1),xa),paramsConfig:_a()}),za=Object(vn.a)(Object(k.a)({},On.UPDATE_ROOMS,(function(e,t){return{rooms:t.rooms}})),{rooms:[]}),Ba=(Ua={},Object(k.a)(Ua,Fe.SIN,{a:.3,t:300,p:0}),Object(k.a)(Ua,Fe.LOOP,{start:0,end:1,t:3e3,p:0}),Ua),Wa=(Xa={},Object(k.a)(Xa,Fe.SIN,[{name:"a",type:ga.Number,props:{valueD:qe.VerticalLinear(100),range:[0,1]}},{name:"t",type:ga.Number,props:{valueD:qe.VerticalLinear(.1),range:[1,1e3]}},{name:"p",type:ga.Number,props:{valueD:qe.VerticalLinear(.5),range:[1,1500]}}]),Object(k.a)(Xa,Fe.LOOP,[{name:"start",type:ga.Number,props:{valueD:qe.VerticalLinear(100),range:[0,1]}},{name:"end",type:ga.Number,props:{valueD:qe.VerticalLinear(100),range:[0,1]}},{name:"t",type:ga.Number,props:{valueD:qe.VerticalLinear(.1),range:[1,3e3]}}]),Xa),Za=(Ya={},Object(k.a)(Ya,Fe.SIN,(function(e,t){return function(n,a){return n+e.a*(t[1]-t[0])*Math.sin(a/e.t)}})),Object(k.a)(Ya,Fe.LOOP,(function(e,t){return function(n,a){return a%e.t/e.t*(e.end*(t[1]-t[0])-e.start*(t[1]-t[0]))+e.start*(t[1]-t[0])}})),Ya);function qa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ka(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qa(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qa(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ja,$a=Object(vn.a)((Ha={},Object(k.a)(Ha,Cn.ADD_CF,(function(e,t){var n=function(e,t){return console.log(Object.keys(t).filter((function(n){return t[n].type===e}))),e.toString()+(Object.keys(t).length?Math.max.apply(Math,[0].concat(Object(x.a)(Object.keys(t).filter((function(n){return t[n].type===e})).map((function(e){return function(e,t){return+e.slice(t.toString().length)}(e,t[e].type)})))))+1:1)}(t.cfType,e);return console.log(n,t.cfType,e),Ka({},e,Object(k.a)({},n,function(e,t){return{id:e,type:t,params:Ba[t],paramsConfig:Wa[t]}}(n,t.cfType)))})),Object(k.a)(Ha,Cn.CHANGE_PARAMS,(function(e,t){return Ka({},e,Object(k.a)({},t.id,Ka({},e[t.id],{params:t.params})))})),Ha),{}),Qa=n(108),er=n.n(Qa);function tr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function nr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tr(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tr(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ar,rr=Object(vn.a)((Ja={},Object(k.a)(Ja,Be.SET_VALUE_IN_CHANGING_LIST,(function(e,t){return e[t.path]?t.changeFunctionId?nr({},e,Object(k.a)({},t.path,nr({},e[t.path],{path:t.path,changeFunctionId:t.changeFunctionId,range:t.range}))):er()(e,t.path):t.changeFunctionId?nr({},e,Object(k.a)({},t.path,{active:!0,path:t.path,changeFunctionId:t.changeFunctionId,range:t.range,startValue:t.startValue})):e})),Object(k.a)(Ja,Be.SET_START_VALUE,(function(e,t){return e[t.path]?nr({},e,Object(k.a)({},t.path,nr({},e[t.path],{startValue:t.startValue}))):e})),Object(k.a)(Ja,Be.ACTIVATE_VALUE_CHANGING,(function(e,t){return nr({},e,Object(k.a)({},t.path,nr({},e[t.path],{active:!0})))})),Object(k.a)(Ja,Be.DEACTIVATE_VALUE_CHANGING,(function(e,t){return nr({},e,Object(k.a)({},t.path,nr({},e[t.path],{active:!1})))})),Ja),{});function or(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function cr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?or(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):or(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ir,sr=Object(vn.a)((ar={},Object(k.a)(ar,he.START,(function(e){return cr({},e,{isChanging:!0})})),Object(k.a)(ar,he.STOP,(function(e){return cr({},e,{isChanging:!1})})),Object(k.a)(ar,he.SET_MODE,(function(e,t){return cr({},e,{mode:t.mode})})),ar),{isChanging:!1,mode:pe.OnDraw});!function(e){e.CHANGE="color/change"}(ir||(ir={}));function ur(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var lr,pr=Object(vn.a)(Object(k.a)({},ir.CHANGE,(function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ur(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ur(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{value:t.color})})),{value:"#000000"}),hr=n(39),fr=Object(vn.a)((lr={},Object(k.a)(lr,se.CHANGE,(function(e,t){console.log(e,t.time);var n=e.changeFunctions,a=e.changingValues;return Object.values(a).reduce((function(e,a){var r=a.active,o=a.path,c=a.range,i=a.changeFunctionId,s=a.startValue;if(console.log(o,r),!r)return e;var u=n[i],l=(0,Za[u.type])(u.params,c)(s,t.time);return l=Math.min(Math.max(l,c[0]),c[1]),e.set(o,l)}),hr.a(e)).value()})),Object(k.a)(lr,se.TO_START_VALUE,(function(e,t){var n=t.path,a=e.changingValues;return a[n]?hr.a(e).set(n,a[n].startValue).value():e})),Object(k.a)(lr,se.ALL_TO_START_VALUE,(function(e){var t=e.changingValues;return Object.values(t).reduce((function(e,t){t.active;var n=t.path,a=(t.range,t.changeFunctionId,t.startValue);return e.set(n,a)}),hr.a(e)).value()})),lr),{}),mr=Object(qn.a)(Object(zn.c)({fullScreen:bn,patterns:ha,color:pr,tool:va,brush:Da,line:La,selectTool:Ga,rooms:za,changeFunctions:$a,changingValues:rr,changing:sr}),fr),gr=Object(zn.d)(mr,Object(zn.a)(Zn.a,Wn.a)),vr=function(){return r.a.createElement(f.a,{store:gr},r.a.createElement(Gn,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(255);c.a.render(r.a.createElement(vr,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},85:function(e,t,n){}},[[109,1,2]]]);
//# sourceMappingURL=main.4bf82e31.chunk.js.map