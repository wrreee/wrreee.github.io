(this.webpackJsonpzd2=this.webpackJsonpzd2||[]).push([[0],{106:function(e,t,n){},127:function(e){e.exports=JSON.parse('{"tools":{"brush":"brush","line":"line","select":"select"},"brushTypes":{"circle":"circle","square":"square","pattern":"pattern"},"lineTypes":{"default":"default","interrupted":"interrupted","interruptedonestroke":"interruptedOneStroke","pattern":"pattern"},"selectTypes":{"rect":"rect","line":"line","points":"points"},"add":"add","plugins":{"repeating":"repeating","rotating":"rotating","video":"video","mask":"mask","room":"room"},"patternControls":{"delete":"delete","double":"double","save":"save","load":"load...","stretch":"stretch","undo":"undo","redo":"redo"}}')},128:function(e){e.exports=JSON.parse('{"tools":{"brush":"\u043a\u0438\u0441\u0442\u044c","line":"\u043b\u0438\u043d\u0438\u044f","select":"\u0432\u044b\u0434\u0435\u043b-\u0435"},"brushTypes":{"circle":"\u043a\u0440\u0443\u0433","square":"\u043a\u0432\u0430\u0434\u0440\u0430\u0442","pattern":"\u043f\u0430\u0442\u0442\u0435\u0440\u043d"},"lineTypes":{"default":"\u0442\u0438\u043f1","interrupted":"\u0442\u0438\u043f2","interruptedonestroke":"\u0442\u0438\u043f3","pattern":"\u043f\u0430\u0442\u0442\u0435\u0440\u043d"},"selectTypes":{"rect":"\u043f\u0440\u044f\u043c\u043e-\u043a","line":"\u043b\u0438\u043d\u0438\u044f","points":"\u0442\u043e\u0447\u043a\u0438"},"add":"\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c","plugins":{"repeating":"\u043f\u043e\u0432\u0442\u043e\u0440\u044b","rotating":"\u043f\u043e\u0432\u043e\u0440\u043e\u0442","video":"\u0432\u0438\u0434\u0435\u043e","mask":"\u043c\u0430\u0441\u043a\u0430","room":"\u043a\u043e\u043c\u043d\u0430\u0442\u044b"},"patternControls":{"delete":"\u0443\u0434\u0430\u043b\u0438\u0442\u044c","double":"\u0434\u0443\u0431\u043b\u0438\u0440-\u0442\u044c","save":"\u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c","load":"\u043e\u0442\u043a\u0440\u044b\u0442\u044c...","stretch":"\u0440\u0430\u0441\u0442\u044f\u0433-\u0442\u044c","undo":"\u043d\u0430\u0437\u0430\u0434","redo":"\u0432\u043f\u0435\u0440\u0435\u0434"}}')},133:function(e,t,n){e.exports=n(312)},138:function(e,t,n){},139:function(e,t,n){},140:function(e,t,n){},146:function(e,t,n){},157:function(e,t,n){},158:function(e,t,n){},191:function(e,t,n){},192:function(e,t,n){},200:function(e,t,n){},201:function(e,t,n){},202:function(e,t,n){},203:function(e,t,n){},204:function(e,t,n){},205:function(e,t,n){},206:function(e,t,n){},207:function(e,t,n){},208:function(e,t,n){},209:function(e,t,n){},211:function(e,t,n){},240:function(e,t){},243:function(e,t,n){},244:function(e,t,n){},245:function(e,t,n){},246:function(e,t,n){},247:function(e,t,n){},248:function(e,t,n){},249:function(e,t,n){},312:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),i=n(43),c=n.n(i),s=(n(138),n(139),n(121)),u=(n(140),n(3)),l=n(4),p=n(5),h=n(6),m=n(7),f=(n(145),n(78));!function(e){e.ADD_PATTERN="patterns/add",e.REMOVE_PATTERN="patterns/remove"}(a||(a={}));var d,v=function(e,t){return{type:a.ADD_PATTERN,config:e,params:t}},g=n(1),b=n(2),y=(n(146),n(10));!function(e){e.UNDO="pattern/undo",e.REDO="pattern/redo"}(d||(d={}));var O,C={redo:function(e){return{type:d.REDO,id:e}},undo:function(e){return{type:d.UNDO,id:e}}},j=Object(m.b)((function(e,t){var n,a=t.patternId;return{history:null===(n=e.patterns[a])||void 0===n?void 0:n.history.value}}),C)((function(e){var t=e.undo,n=e.redo,a=e.history,o=e.patternId,i=r.useCallback((function(){t(o)}),[o]),c=r.useCallback((function(){n(o)}),[o]),s=Object(y.b)("common").t;return r.createElement("div",{className:"flex-row history-controls"},r.createElement(f.a,{onClick:i,disabled:!a.before.length,width:70},s("patternControls.undo"),a.before.length?"(".concat(a.before.length,")"):""),r.createElement(f.a,{onClick:c,disabled:!a.after.length,width:70},s("patternControls.redo"),a.after.length?"(".concat(a.after.length,")"):""))}));!function(e){e.Brush="Brush",e.Select="Select",e.Line="Line"}(O||(O={}));var E,x,k,S=[O.Select],P=function(e,t,n,a){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-a,2))},w=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).elementRef=void 0,a.pre=void 0,a.mouseDownHandler=function(e){a.setState({dragging:!0});var t=a.props.onDown;t&&t(e)},a.mouseUpHandler=function(e){if(a.state.dragging){a.setState({dragging:!1}),a.pre=null;var t=a.props.onUp;t&&t(e)}},a.mouseMoveHandler=function(e){var t=a.props,n=t.onDrag,r=t.onMove;a.state.dragging&&n&&n(e,a.pre),r&&r(e,a.pre),a.pre=e},a.state={dragging:!1},a.elementRef=o.a.createRef(),a.pre=null,a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.elementRef.current.addEventListener("mousedown",this.mouseDownHandler),document.addEventListener("mouseup",this.mouseUpHandler),this.elementRef.current.addEventListener("mousemove",this.mouseMoveHandler)}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.width,a=e.height,r=e.className,i=e.style;return o.a.createElement("svg",{ref:this.elementRef,width:n,height:a,className:r,style:i},t)}}]),n}(o.a.PureComponent),T=n(75),D=n(9),A=n(30);!function(e){e.M="M",e.L="L",e.Z="Z"}(x||(x={})),function(e){e.M="M",e.L="L",e.Z="Z",e.Rect="Rect",e.Slice="Slice"}(k||(k={}));var I=(E={},Object(g.a)(E,k.M,(function(e,t){var n=Object(A.a)(t,2),a=n[0],r=n[1];return[].concat(Object(D.a)(e),[{type:x.M,values:[a,r]}])})),Object(g.a)(E,k.L,(function(e,t){var n=Object(A.a)(t,2),a=n[0],r=n[1];return[].concat(Object(D.a)(e),[{type:x.L,values:[a,r]}])})),Object(g.a)(E,k.Z,(function(e){return[].concat(Object(D.a)(e),[{type:x.Z}])})),Object(g.a)(E,k.Rect,(function(e,t){var n=Object(A.a)(t,4),a=n[0],r=n[1],o=n[2],i=n[3],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=R(e,c),u=s.sliceStart,l=s.sliceEnd;return[].concat(Object(D.a)(e.slice(0,u)),[{type:x.M,values:[a,r]},{type:x.L,values:[o,r]},{type:x.L,values:[o,i]},{type:x.L,values:[a,i]},{type:x.Z}],Object(D.a)(e.slice(l+1)))})),Object(g.a)(E,k.Slice,(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=R(e,n),r=a.sliceStart,o=a.sliceEnd;return[].concat(Object(D.a)(e.slice(0,r)),Object(D.a)(t),Object(D.a)(e.slice(o+1)))})),E),R=function(e,t){for(var n,a,r=0,o=0;o<e.length;o++)if(e[o].type===x.M){if(r===t){n=o;for(var i=o;i<e.length;i++)if(e[i].type===x.Z){a=i;break}break}r++}return{sliceStart:"undefined"===typeof n?e.length:n,sliceEnd:"undefined"===typeof a?e.length:a}},N=function(e){var t;for(t=e.length-1;t>=0&&e[t].type!==x.M;t--);return e.slice(t)},M=function(e){return e},L=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M;return(null===e||void 0===e?void 0:e.map((function(e){return{value:t(e),text:n(e)}})))||[]};var F,V,_=function(e,t){return e.split(((0+t)%4).toString()).join("z").split(((1+t)%4).toString()).join("s").split(((2+t)%4).toString()).join("k").split(((3+t)%4).toString()).join("i")},X=function(e,t){return e.split(((0+t)%4).toString()).join("s").split(((1+t)%4).toString()).join("z").split(((2+t)%4).toString()).join("S").split(((3+t)%4).toString()).join("z")},H=0,Y=n(8),U=n.n(Y);!function(e){e.CurveBasis="curveBasis",e.CurveBundle="curveBundle",e.CurveCardinal="curveCardinal",e.CurveCatmullRom="curveCatmullRom",e.CurveLinear="curveLinear",e.CurveMonotoneX="curveMonotoneX",e.CurveMonotoneY="curveMonotoneY",e.CurveNatural="curveNatural",e.CurveStep="curveStep",e.CurveStepBefore="curveStepBefore",e.CurveStepAfter="curveStepAfter"}(V||(V={}));var B,z=(F={},Object(g.a)(F,V.CurveBundle,"beta"),Object(g.a)(F,V.CurveCardinal,"tension"),Object(g.a)(F,V.CurveCatmullRom,"alpha"),F);!function(e){e.Line="Line",e.Rect="Rect",e.SimplePoints="SimplePoints",e.Points="Points"}(B||(B={}));n(157);var G=T.line().x((function(e){var t=e.values;return t?t[0]:0})).y((function(e){var t=e.values;return t?t[1]:0})).defined((function(e){return!!e.values})),W=L([B.Rect,B.Line,B.Points]),q=L(Object.values(V),void 0,(function(e){return e[5].toLowerCase()+e.slice(6)})),Z=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var a,o;return Object(u.a)(this,n),(o=t.call(this,e)).canvasRef=void 0,o.pathRef=void 0,o.pathPointsRef=void 0,o.maskPathRef=void 0,o.maskRef=void 0,o.commitChanges=function(){var e=o.props.onChange;e&&e(o.state.path,o.maskPathRef.current&&o.maskPathRef.current.getBBox())},o.selectToolHandlers=(a={},Object(g.a)(a,B.Rect,{down:function(e){var t=o.state.path;if(t.length){var n=function(e,t,n){if(e&&e.length){var a,r,o=e.slice(1).reduce((function(e,a,r){if(r++,!a.values)return e;var o=P(t,n,a.values[0],a.values[1]);return o<e.distance?{distance:o,segment:a,index:r}:e}),{sliceStart:0,sliceEnd:0,startInSlice:0,index:0,segment:e[0],distance:P(t,n,e[0].values[0],e[0].values[1])});o.sliceN=-1;for(var i=0;i<e.length;i++)e[i].type===x.M&&i<=o.index&&(a=i,o.sliceN+=1),e[i].type===x.Z&&i>o.index&&!r&&(r=i);return o.sliceStart=a,o.sliceEnd=r,o.startInSlice=a?o.index%a:o.index,o.slice=e.slice(o.sliceStart,o.sliceEnd+1),o}}(t,e.offsetX,e.offsetY);if(n&&n.distance<10){if(5!==n.slice.length)return o.setState((function(t){return{startX:e.offsetX,startY:e.offsetY,offsetX:0,offsetY:0,currentSliceN:n.sliceN,path:I[k.Rect](t.path,[e.offsetX,e.offsetY,e.offsetX,e.offsetY],n.sliceN)}}));var a=(n.startInSlice+2)%4,r=n.slice[a],i=n.segment.values[0]-e.offsetX,c=n.segment.values[1]-e.offsetY,s=r.values[0],u=r.values[1];return o.setState((function(t){return{startX:s,startY:u,offsetX:i,offsetY:c,currentSliceN:n.sliceN,path:I[k.Rect](t.path,[s,u,e.offsetX+i,e.offsetY+c],n.sliceN)}}))}}o.setState((function(t){var n=t.currentSliceN,a=t.path;return{offsetX:0,offsetY:0,startX:e.offsetX,startY:e.offsetY,path:I[k.Rect](a,[e.offsetX,e.offsetY,e.offsetX,e.offsetY],n)}}))},drag:function(e){o.setState((function(t){var n=t.path,a=t.startX,r=t.startY,o=(t.offsetX,t.offsetY,t.currentSliceN);return{path:I[k.Rect](n,[a,r,e.offsetX,e.offsetY],o)}}))},up:function(){o.setState((function(e){return{startX:0,startY:0,offsetX:0,offsetY:0,currentSliceN:e.path.filter((function(e){return e.type===x.M})).length}}),o.commitChanges)},exit:function(e){}}),Object(g.a)(a,B.SimplePoints,{down:function(e){var t=o.state,n=t.path,a=t.curvePath;if(n.length&&n[n.length-1].type!==x.Z){a.length&&o.setState((function(e){var t=e.path,n=e.currentSliceN;return{curvePath:[],path:I[k.Slice](t,a,n)}}));var r=n.filter((function(e){return e.type===x.M})).reverse()[0];P(e.offsetX,e.offsetY,r.values[0],r.values[1])<10?o.setState((function(e){var t=e.path;return{path:I[k.Z](t),currentSliceN:t.filter((function(e){return e.type===x.M})).length}}),o.commitChanges):o.setState((function(t){var n=t.path;return{path:I[k.L](n,[e.offsetX,e.offsetY])}}))}else o.setState((function(t){var n=t.path;return{path:I[k.M](n,[e.offsetX,e.offsetY])}}))},drag:function(){},up:function(){},exit:function(e){var t=o.state.path;t&&t.length&&t[t.length-1].type!==x.Z&&e!==B.Points&&o.setState((function(e){var t=e.path;return{curvePath:[],path:I[k.Z](t),currentSliceN:t.filter((function(e){return e.type===x.M})).length}}),o.commitChanges)}}),Object(g.a)(a,B.Points,{down:function(e){var t=o.state,n=t.path,a=t.curvePath;if(n.length&&n[n.length-1].type!==x.Z){a.length||o.setState((function(e){var t=e.path;return{curvePath:N(t)}}));var r=n.filter((function(e){return e.type===x.M})).reverse()[0];P(e.offsetX,e.offsetY,r.values[0],r.values[1])<10?o.setState((function(e){var t=e.path,n=e.curvePath,a=I[k.L](n,[r.values[0],r.values[1]]);return a=I[k.Z](a),{curvePath:[],path:I[k.Z](o.line(t,a)),currentSliceN:t.filter((function(e){return e.type===x.M})).length}}),o.commitChanges):o.setState((function(t){var n=t.path,a=t.curvePath,r=I[k.L](a,[e.offsetX,e.offsetY]);return{curvePath:r,path:o.line(n,r)}}))}else{var i=I[k.M](o.state.curvePath,[e.offsetX,e.offsetY]);o.setState((function(t){var n=t.path;return{curvePath:i,path:I[k.M](n,[e.offsetX,e.offsetY])}}))}},drag:function(){},up:function(){},exit:function(e){var t=o.state.path;t&&t.length&&t[t.length-1].type!==x.Z&&e!==B.Points&&o.setState((function(e){var t=e.path;return{curvePath:[],path:I[k.Z](t),currentSliceN:t.filter((function(e){return e.type===x.M})).length}}),o.commitChanges)}}),Object(g.a)(a,B.Line,{down:function(e){o.setState((function(t){var n=t.path;return{path:I[k.M](n,[e.offsetX,e.offsetY])}}))},drag:function(e){o.setState((function(t){var n=t.path;return{path:I[k.L](n,[e.offsetX,e.offsetY])}}))},up:function(e){o.setState((function(e){var t=e.path;return{path:I[k.Z](t),currentSliceN:t.filter((function(e){return e.type===x.M})).length}}),o.commitChanges)},exit:function(e){}}),a),o.line=function(e,t){var n=o.props.selectToolParams,a=n.curveType,r=n[z[a]],i=T[a||"curveLinear"];return-1!==Object.keys(z).indexOf(a)&&(i=i[z[a]](r)),I[k.Slice](e,function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",e),t.getPathData()}(G.curve(i)(N(t))),o.state.currentSliceN)},o.canvasRef=r.createRef(),o.pathRef=r.createRef(),o.pathPointsRef=r.createRef(),o.maskPathRef=r.createRef(),o.maskRef=r.createRef(),o.state={startX:null,startY:null,offsetX:null,offsetY:null,points:[],closed:!0,path:[],prevPath:null,curvePath:[],currentSliceN:0},o}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.value;Array.isArray(e)&&this.setState({path:e,currentSliceN:e.filter((function(e){return e.type===x.M})).length})}},{key:"componentDidUpdate",value:function(e){e.selectToolParams.mode!==this.props.selectToolParams.mode&&this.selectToolHandlers[e.selectToolParams.mode].exit(this.props.selectToolParams.mode)}},{key:"render",value:function(){console.log("selector render",this.state.path);var e=this.props,t=e.width,n=e.height,a=e.selectToolParams.mode,o=e.isActive,i=e.name,c=e.style;return this.pathRef.current&&this.pathRef.current.setPathData(this.state.path),this.maskPathRef.current&&this.maskPathRef.current.setPathData(this.state.path),console.log(this.maskPathRef.current&&this.maskPathRef.current.getBBox()),r.createElement("div",{style:c,className:U()("selection",Object(g.a)({},"selectionActive",o))},r.createElement(w,{width:t,height:n,onDown:this.selectToolHandlers[a].down,onDrag:this.selectToolHandlers[a].drag,onUp:this.selectToolHandlers[a].up},this.state.path&&this.state.path.length&&r.createElement(r.Fragment,null,r.createElement("mask",{id:"selectionMask".concat(i),ref:this.maskRef},r.createElement("rect",{x:"0",y:"0",width:t,height:n,fill:"white"}),r.createElement("path",{ref:this.maskPathRef,fillOpacity:1,fill:"black"})),r.createElement("rect",{x:"0",y:"0",width:t,height:n,fill:"black",fillOpacity:.3,mask:"url(#selectionMask".concat(i,")")}),r.createElement("path",{ref:this.pathRef,fillOpacity:0,fill:"black",stroke:o?"greenyellow":"red"}))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.value;return Array.isArray(n)&&n!==t.prevPath?{prevPath:n,path:n,currentSliceN:n.filter((function(e){return e.type===x.M})).length}:{}}}]),n}(r.PureComponent),K=Object(m.b)((function(e){return{selectToolParams:e.selectTool.params,currentTool:e.tool.current}}),{})(Z),J=function(e,t){var n=document.createElement("canvas"),a=n.getContext("2d");return n.width=e,n.height=t,{canvas:n,context:a}},$=function(e){return e.getContext("2d").getImageData(0,0,e.width,e.height)};function Q(e){var t=J(e.width,e.height),n=t.canvas;return t.context.putImageData(e,0,0),n}var ee=function(e,t,n,a){var r=Q(e),o=document.createElement("canvas");o.width=t,o.height=n;var i=o.getContext("2d");return i.imageSmoothingEnabled=!1,a?i.drawImage(r,0,n-r.height,r.width,r.height):i.drawImage(r,0,0,t,n),$(o)},te=function(e){var t=J(e.width,e.height),n=t.canvas;return t.context.putImageData(e,0,0),n.toDataURL()},ne=function(e,t){var n=J(e.width,e.height),a=n.canvas,r=n.context;return t&&(r.putImageData(t,0,0),r.globalCompositeOperation="source-in"),r.drawImage(Q(e),0,0,e.width,e.height),a};n(158);function ae(e){if(e)return e.getBoundingClientRect?function(e){var t=e.getBoundingClientRect(),n=document.body,a=document.documentElement,r=window.pageYOffset||a.scrollTop||n.scrollTop,o=window.pageXOffset||a.scrollLeft||n.scrollLeft,i=a.clientTop||n.clientTop||0,c=a.clientLeft||n.clientLeft||0,s=t.top+r-i,u=t.left+o-c;return{top:Math.round(s),left:Math.round(u),box:t}}(e):function(e){var t=0,n=0;for(;e;)t+=parseInt(e.offsetTop),n+=parseInt(e.offsetLeft),e=e.offsetParent;return{top:t,left:n,box:null}}(e)}var re,oe=n(45);!function(e){e.Grid="Grid",e.Center="Center",e.Dart="Dart"}(re||(re={}));var ie=function(e,t,n){if(!n.repeating)return[{x:e,y:t}];var a=n.repeating.params;if(a.type===re.Grid){var r=a.gridParams,o=r.x,i=r.y,c=r.bezierPoints,s=r.xOut,u=r.yOut,l=n.current,p=l.width,h=l.height,m=(n.rotation,p/o),f=h/i;(e%=m)<0&&(e+=m),(t%=f)<0&&(t+=f);for(var d=[],v=new oe(c),g=-s;g<o+s;g++)for(var b=(e+m*g)/p,y=v.get(b),O=-u;O<i+u;O++){var C=(t+f*O)/h,j=v.get(C),E=p*y.x/100,x=h*j.y/100;d.push({x:E,y:x,outer:g<0||g>=o||O<0||O>=i})}return d}return[{x:e,y:t}]};var ce,se,ue=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).canvasRef=void 0,a.ctx=void 0,a.e=void 0,a.pre=void 0,a.requestID=void 0,a.mouseDownHandler=function(e){a.props.pointerLock&&a.canvasRef.current.requestPointerLock(),document.addEventListener("mouseup",a.mouseUpHandler),document.addEventListener("mousemove",a.mouseDragHandler),a.e=e,a.setState({drawing:!0,startEvent:e});var t={e:e,ctx:a.ctx,canvas:a.canvasRef.current,drawing:!0,rotation:a.props.rotation},n=a.props.onDown;n&&n(t),a.start(),setTimeout((function(){var e=a.props.onClick;e&&e(t)}),10)},a.start=function(){var e=a.props,t=e.onDraw,n=e.onMove;if(!a.requestID){a.requestID=requestAnimationFrame((function e(r){var o=a.e,i=ae(a.canvasRef.current),c=i.top,s=i.left,u=i.box,l={x:s+u.width/2,y:c+u.height/2},p=function(e,t,n,a,r){var o=Math.PI/180*r,i=Math.cos(o),c=Math.sin(o);return{x:i*(n-e)+c*(a-t)+e,y:i*(a-t)-c*(n-e)+t}}(l.x,l.y,o.pageX,o.pageY,a.props.rotation?a.props.rotation.angle:0);a.state.drawing&&n&&n({e:Object(b.a)({},o,{offsetX:p.x-l.x+a.props.width/2,offsetY:p.y-l.y+a.props.height/2}),pre:a.pre,ctx:a.ctx,canvas:a.canvasRef.current,drawing:a.state.drawing}),a.state.drawing&&t&&t({e:Object(b.a)({},o,{offsetX:p.x-l.x+a.props.width/2,offsetY:p.y-l.y+a.props.height/2}),pre:a.pre,ctx:a.ctx,canvas:a.canvasRef.current,drawing:!0,rotation:a.props.rotation}),a.requestID=requestAnimationFrame(e)}))}},a.stop=function(){a.requestID&&cancelAnimationFrame(a.requestID),a.requestID=null},a.mouseMoveHandler=function(e){var t=a.props.onMove;a.state.drawing||(a.pre=a.e,a.e=e,t&&t({e:a.e,pre:a.pre,ctx:a.ctx,canvas:a.canvasRef.current,drawing:a.state.drawing}))},a.mouseDragHandler=function(e){a.state.drawing&&(a.pre=a.e,a.e=a.props.pointerLock?Object(b.a)({},e,{pageX:a.pre.pageX+e.movementX,pageY:a.pre.pageY+e.movementY}):e)},a.mouseUpHandler=function(e){if(console.log("canvas up"),document.removeEventListener("mouseup",a.mouseUpHandler),document.removeEventListener("mousemove",a.mouseDragHandler),a.props.pointerLock&&document.exitPointerLock(),a.stop(),a.state.drawing){a.setState({drawing:!1,startEvent:e}),a.pre=null;var t=a.props.onChange;t&&t($(a.canvasRef.current));var n={e:e,ctx:a.ctx,canvas:a.canvasRef.current,drawing:!1},r=a.props.onUp;r&&r(n);var o=a.props.releaseProcess;o&&o(n)}},a.mouseEnterHandler=function(e){a.state.drawing},a.mouseLeaveHandler=function(e){a.state.drawing;var t=a.props.onLeave;t&&t(e)},a.state={drawing:!1,startEvent:null},a.canvasRef=o.a.createRef(),a.ctx=null,a.pre=null,a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.ctx=this.canvasRef.current.getContext("2d"),this.canvasRef.current.addEventListener("mousedown",this.mouseDownHandler),this.canvasRef.current.addEventListener("mousemove",this.mouseMoveHandler),this.canvasRef.current.addEventListener("mouseenter",this.mouseEnterHandler),this.canvasRef.current.addEventListener("mouseleave",this.mouseLeaveHandler),this.props.value instanceof ImageData&&this.ctx.putImageData(this.props.value,0,0)}},{key:"componentWillUnmount",value:function(){this.canvasRef.current.removeEventListener("mousedown",this.mouseDownHandler),this.canvasRef.current.removeEventListener("mousemove",this.mouseMoveHandler),this.canvasRef.current.removeEventListener("mouseenter",this.mouseEnterHandler),this.canvasRef.current.removeEventListener("mouseleave",this.mouseLeaveHandler)}},{key:"componentDidUpdate",value:function(e){(e.value!==this.props.value||e.width!==this.props.width||e.height!==this.props.height)&&this.props.value instanceof ImageData&&(this.ctx=this.canvasRef.current.getContext("2d"),this.ctx.putImageData(this.props.value,0,0))}},{key:"render",value:function(){var e=this.props,t=e.value,n=e.width,a=e.height,r=e.className,i=e.style,c=e.children;return o.a.createElement("div",{style:i,className:Y(r,"canvas")},o.a.createElement("canvas",{ref:this.canvasRef,width:n||(t?t.width:300),height:a||(t?t.height:300)}),c)}}]),n}(o.a.PureComponent);!function(e){e.Square="Square",e.Circle="Circle",e.Pattern="Pattern"}(ce||(ce={})),function(e){e.SourceOver="source-over",e.SourceAtop="source-atop",e.DestinationOver="destination-over",e.DestinationOut="destination-out",e.Lighter="lighter",e.Xor="xor",e.multiply="multiply",e.screen="screen",e.overlay="overlay",e.darken="darken",e.lighten="lighten",e.colorDodge="color-dodge",e.colorBurn="color-burn",e.hardLight="hard-light",e.softLight="soft-light",e.difference="difference",e.exclusion="exclusion",e.hue="hue",e.saturation="saturation",e.color="color",e.luminosity="luminosity"}(se||(se={}));var le,pe,he,me=n(73),fe=n.n(me);!function(e){e.Default="Default",e.Interrupted="Interrupted",e.InterruptedOneStroke="InterruptedOneStroke",e.Pattern="Pattern"}(le||(le={})),function(e){e.SourceOver="source-over",e.SourceAtop="source-atop",e.DestinationOver="destination-over",e.DestinationOut="destination-out",e.Lighter="lighter",e.Xor="xor",e.multiply="multiply",e.screen="screen",e.overlay="overlay",e.darken="darken",e.lighten="lighten",e.colorDodge="color-dodge",e.colorBurn="color-burn",e.hardLight="hard-light",e.softLight="soft-light",e.difference="difference",e.exclusion="exclusion",e.hue="hue",e.saturation="saturation",e.color="color",e.luminosity="luminosity"}(pe||(pe={})),function(e){e.CHANGE="change",e.TO_START_VALUE="change/to-start-value",e.ALL_TO_START_VALUE="change/all-to-start-value"}(he||(he={}));var de,ve=function(e){return{type:he.TO_START_VALUE,path:e}},ge=function(){return{type:he.ALL_TO_START_VALUE}};!function(e){e.OnDraw="onDraw",e.On="on",e.Off="off"}(de||(de={}));var be,ye={x:0,y:0,patternId:null},Oe=function(e,t,n){ye.x=e,ye.y=t,ye.patternId=n},Ce=function e(t,n){Object(u.a)(this,e),this.setPos=void 0;var a=document.createElement("div");document.body.appendChild(a),this.setPos=function(e,r){a.style.cssText="position:absolute;top:".concat(r-n/2,"px;left:").concat(e-n/2,"px;width:").concat(n,"px;height:").concat(n,"px;opacity:1;z-index:100;background: ").concat(t,"; pointer-events: none;}")}},je=function e(t,n){Object(u.a)(this,e),this.setText=void 0;var a=document.createElement("div");document.body.appendChild(a),a.style.cssText="position:absolute;bottom:".concat(n,"px;left:").concat(t,"px;opacity:1;z-index:100;font-family: monospace;}"),this.setText=function(e){a.innerText=e}};new Ce("#f00",10),new Ce("#00f",10),new Ce("#0f0",10),new je(10,30),new je(10,50),new je(10,70);!function(e){e.START="changing/start",e.STOP="changing/stop",e.SET_MODE="changing/set-mode"}(be||(be={}));var Ee,xe=null,ke=function(){return function(e,t){if(!xe){xe&&cancelAnimationFrame(xe);var n=performance.now();return xe=requestAnimationFrame((function t(a){e(function(e,t){return{type:he.CHANGE,time:e,position:t}}(a-n,ye)),xe=requestAnimationFrame(t)})),e({type:be.START})}}},Se=function(){return function(e,t){return xe&&cancelAnimationFrame(xe),xe=null,e({type:be.STOP})}},Pe=(n(191),function(e,t){var n=J(e.width,e.height),a=n.canvas,r=n.context;return e&&(r.putImageData(e,0,0),r.globalCompositeOperation="source-in"),t({context:r,canvas:a}),{canvas:a,context:r}}),we=function(e,t,n,a){return function(r){var o=r.context,i=r.canvas;return o.translate(t,n),o.rotate(Math.PI*e/180),a({canvas:i,context:o}),o.rotate(-Math.PI*e/180),o.translate(-t,-n),{canvas:i,context:o}}},Te=function(e,t,n,a,r){var o=Pe(e,we(t,n,a,r));return{canvas:o.canvas,context:o.context}},De=function(e,t,n,a){e.beginPath(),e.arc(t,n,a,0,2*Math.PI),e.fill()};function Ae(){for(var e="#",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}var Ie,Re,Ne=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e,a,o,i;Object(u.a)(this,n);for(var c=arguments.length,s=new Array(c),l=0;l<c;l++)s[l]=arguments[l];return(i=t.call.apply(t,[this].concat(s))).state={coords:[]},i.handlers=(o={},Object(g.a)(o,O.Brush,(e={},Object(g.a)(e,ce.Square,function(){var e=function(e){var t=e.ctx,n=e.e,a=e.canvas,r=e.rotation;console.log(e);var o=i.props,c=o.patterns[o.patternId],s=i.props.brush.params,u=s.size,l=s.opacity,p=s.compositeOperation;t.fillStyle=Ae(),t.globalAlpha=l,t.globalCompositeOperation=p;var h=r?r.angle:0,m=c.selection&&c.selection.value.mask;m?ie(n.offsetX,n.offsetY,c).forEach((function(e){var n=e.x,a=e.y,r=Te(m,-h,n,a,(function(e){var n=e.context;n.fillStyle=t.fillStyle,n.fillRect(-u/2,-u/2,u,u)})).canvas;t.globalCompositeOperation=p,t.drawImage(r,0,0)})):ie(n.offsetX,n.offsetY,c).forEach((function(e){var n=e.x,r=e.y;we(-h,n,r,(function(e){e.context.fillRect(-u/2,-u/2,u,u)}))({context:t,canvas:a})})),t.globalCompositeOperation=se.SourceOver,t.globalAlpha=1};return{draw:e,click:e,cursors:function(e){var t=e.x,n=e.y,a=e.outer,o=i.props.brush.params.size,c=i.props.brush.params.size,s=i.props.rotation;return t-o/2?r.createElement("rect",{transform:"rotate(".concat(-(s?s.angle:0)," ").concat(t," ").concat(n,")"),x:t-o/2,y:n-c/2,width:o,height:c,stroke:"black",fill:"purple",fillOpacity:"0",strokeOpacity:a?"0.3":"0.7"}):null}}}()),Object(g.a)(e,ce.Circle,function(){var e=function(e){var t=e.ctx,n=e.e,a=e.canvas,r=e.rotation,o=i.props,c=o.patterns[o.patternId],s=i.props.brush.params,u=s.size,l=s.opacity,p=s.compositeOperation;t.fillStyle=Ae(),t.globalAlpha=l,t.globalCompositeOperation=p;var h=r?r.angle:0,m=c.selection&&c.selection.value.mask;m?ie(n.offsetX,n.offsetY,c).forEach((function(e){var n=e.x,a=e.y,r=Te(m,-h,n,a,(function(e){var n=e.context;n.fillStyle=t.fillStyle,De(n,0,0,u/2)})).canvas;t.globalCompositeOperation=p,t.drawImage(r,0,0)})):ie(n.offsetX,n.offsetY,c).forEach((function(e){var n=e.x,r=e.y;we(-h,n,r,(function(e){var t=e.context;De(t,0,0,u/2)}))({context:t,canvas:a})})),t.globalCompositeOperation=se.SourceOver,t.globalAlpha=1};return{draw:e,click:e,cursors:function(e){var t=e.x,n=e.y,a=e.outer;return r.createElement("circle",{cx:t,cy:n,r:i.props.brush.params.size/2,stroke:"black",fill:"purple",fillOpacity:"0",strokeOpacity:a?"0.3":"0.7"})}}}()),Object(g.a)(e,ce.Pattern,function(){var e=function(e){var t=e.ctx,n=e.e,a=e.canvas,r=i.props,o=r.patterns,c=r.patternId,s=i.props.brush.params,u=s.patternSize,l=s.opacity,p=s.compositeOperation,h=s.pattern;t.fillStyle=Ae(),t.globalAlpha=l,t.globalCompositeOperation=p,t.imageSmoothingEnabled=!0;var m=o[c],f=o[h],d=f&&f.rotation&&f.rotation.value,v=m&&m.rotation&&m.rotation.value,g=f&&f.resultImage;if(g){ie(n.offsetX,n.offsetY,m).forEach((function(e){var n=e.x,r=e.y,o=u*g.width,i=u*g.height,c=m.selection&&m.selection.value.mask;if(c){var s=Te(c,-v.angle+d.angle,n+d.offset.x,r+d.offset.y,(function(e){e.context.drawImage(g,-o/2,-i/2,o,i)})).canvas;t.globalCompositeOperation=p,t.drawImage(s,0,0)}else{var l=v?v.angle:0,h=d?d.angle:0,f=d?{x:d.offset.x,y:d.offset.y}:{x:0,y:0};we(-l+h,n+f.x,r+f.y,(function(e){e.context.drawImage(g,-o/2,-i/2,o,i)}))({context:t,canvas:a})}}))}t.globalCompositeOperation=se.SourceOver,t.globalAlpha=1};return{draw:e,click:e,cursors:function(e){var t=e.x,n=e.y,a=e.outer,o=i.props.patterns,c=i.props.brush.params,s=c.pattern,u=c.patternSize,l=o[s],p=l&&l.rotation&&l.rotation.value,h=l&&l.resultImage,m=u*(h&&h.width),f=u*(h&&h.height),d=i.props.rotation;return t-m/2?r.createElement("rect",{transform:d&&p?"rotate(".concat(-d.angle+p.angle," ").concat(t," ").concat(n,")"):"",x:t-m/2,y:n-f/2,width:m,height:f,stroke:"black",fill:"purple",fillOpacity:"0",strokeOpacity:a?"0.3":"0.7"}):null}}}()),e)),Object(g.a)(o,O.Line,(a={},Object(g.a)(a,le.Default,{click:function(e){var t=e.ctx,n=e.e,a=i.props.line.params,r=a.size,o=a.opacity,c=a.compositeOperation;t.beginPath(),t.globalCompositeOperation=c,t.globalAlpha=o,t.strokeStyle=Ae(),t.lineWidth=r,t.moveTo(n.offsetX,n.offsetY)},draw:function(e){var t=e.ctx,n=e.e,a=i.props.line.params,r=a.size,o=a.opacity;t.lineWidth=r,t.globalAlpha=o,t.lineTo(n.offsetX,n.offsetY),t.stroke()},release:function(e){e.ctx.globalCompositeOperation=pe.SourceOver,e.ctx.globalAlpha=1,e.ctx.closePath()}}),Object(g.a)(a,le.Interrupted,{click:function(e){var t=e.ctx,n=(e.e,i.props.line.params),a=n.size,r=n.opacity,o=n.compositeOperation;t.beginPath(),t.globalCompositeOperation=o,t.globalAlpha=r,t.strokeStyle=Ae(),t.lineWidth=a},draw:function(e){var t=e.ctx,n=e.e,a=e.pre,r=i.props.line.params,o=r.size,c=r.opacity;a&&(t.lineWidth=o,t.globalAlpha=c,console.log(a===n,e),t.moveTo(a.offsetX,a.offsetY),t.lineTo(n.offsetX,n.offsetY),t.stroke())},release:function(e){e.ctx.globalCompositeOperation=pe.SourceOver,e.ctx.globalAlpha=1,e.ctx.closePath()}}),Object(g.a)(a,le.InterruptedOneStroke,{click:function(e){var t=e.ctx,n=(e.e,i.props.line.params),a=n.size,r=n.opacity,o=n.compositeOperation;t.globalCompositeOperation=o,t.globalAlpha=r,t.strokeStyle=Ae(),t.lineWidth=a},draw:function(e){var t=e.ctx,n=e.e,a=e.pre,r=i.props.line.params,o=r.size,c=r.opacity;t.lineWidth=o,t.globalAlpha=c,a&&(t.beginPath(),t.moveTo(a.offsetX,a.offsetY),t.lineTo(n.offsetX,n.offsetY),t.stroke(),t.closePath())},release:function(e){e.ctx.globalCompositeOperation=pe.SourceOver,e.ctx.globalAlpha=1}}),a)),o),i.downHandler=function(e){(0,i.props.startChanging)(),i.setState({coords:[]})},i.clickHandler=function(){},i.moveHandler=function(e){var t=e.e;e.drawing||i.setState({coords:ie(t.offsetX,t.offsetY,i.props.patterns[i.props.patternId])}),Oe(t.offsetX,t.offsetY,i.props.patternId)},i.leaveHandler=function(){i.props.onLeave&&i.props.onLeave(),i.setState({coords:[]})},i.upHandler=function(e){var t=e.e;(0,i.props.stopChanging)(),i.setState({coords:ie(t.offsetX,t.offsetY,i.props.patterns[i.props.patternId])})},i.getHandlers=function(){var e=i.props.tool,t=Me[e],n=t&&t(i.props);return i.handlers&&i.handlers[e]&&i.handlers[e][n]},i.handleChange=function(e){if(i.props.mask)for(var t=0;t<e.data.length;t+=4)e.data[t]=0,e.data[t+1]=0,e.data[t+2]=0;i.props.onChange(e)},i}return Object(l.a)(n,[{key:"componentDidUpdate",value:function(e){var t=this.props.patternId;e.patterns[t].selection.params.mask}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.width,a=e.height,o=e.className,i=e.mask,c=this.getHandlers();return r.createElement(ue,Object.assign({className:U()("draw",{mask:i},o),onDown:this.downHandler,onClick:c&&c.click,onMove:this.moveHandler,onDraw:c&&c.draw,onLeave:this.leaveHandler,onUp:this.upHandler,releaseProcess:c&&c.release,width:n,height:a},this.props,{onChange:this.handleChange}),c&&c.cursors&&r.createElement(w,{className:"draw-cursors",width:n,height:a},this.state.coords.map(c.cursors)),t)}}]),n}(r.PureComponent),Me=(Ee={},Object(g.a)(Ee,O.Line,(function(e){return fe()(e,"line.params.type")})),Object(g.a)(Ee,O.Brush,(function(e){return fe()(e,"brush.params.type")})),Ee),Le={startChanging:function(){return function(e,t){if(t().changing.mode===de.OnDraw)return e(ke())}},stopChanging:function(){return function(e,t){if(t().changing.mode===de.OnDraw)return e(ge()),e(Se())}}},Fe=Object(m.b)((function(e){return{brush:e.brush,line:e.line,tool:e.tool.current,patterns:e.patterns}}),Le)(Ne),Ve=(n(192),function(e){return e?{transform:"rotate(".concat(e.angle,"deg) translateY(").concat(-e.offset.y,"px) translateX(").concat(e.offset.x,"px)")}:null}),_e=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={style:Ve(e.rotation),rotation:e.rotation},a}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.mask,n=e.currentTool,a=e.name,o=e.height,i=e.width,c=e.imageValue,s=e.selectionValue,u=e.selectionParams,l=e.onImageChange,p=e.onSelectionChange,h=e.rotation;return console.log("area",this.state),r.createElement("div",{className:"area"},r.createElement(Fe,{mask:t,patternId:a,style:this.state.style,rotation:h,value:c,width:i,height:o,onChange:l}),r.createElement(K,{style:this.state.style,isActive:-1!==S.indexOf(n),name:a,width:i,height:o,value:s,params:u,onChange:p}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return{rotation:e.rotation,style:Ve(e.rotation)}}}]),n}(r.PureComponent),Xe=Object(m.b)((function(e){return{currentTool:e.tool.current}}),{})(_e),He=function(e){var t=e.className,n=e.value,a=e.onChange,o=e.min,i=void 0===o?0:o,c=e.max,s=void 0===c?1:c,u=e.step,l=void 0===u?.05:u,p=e.delay,h=e.notZero,m=r.useState(n),f=Object(A.a)(m,2),d=f[0],v=f[1];r.useEffect((function(){n!==d&&!Ie&&v(n)}));return r.createElement("input",{className:Y("input-number",t),type:"number",step:l,min:i,max:s,value:d,onChange:function(e){var t=+e.target.value;if(p)v(t),Ie&&clearTimeout(Ie),Ie=setTimeout((function(){!h||t?(a(t),clearTimeout(Ie),Ie=null):v(n)}),p);else{if(h&&!t)return;v(t),a(t)}}})},Ye=n(12),Ue=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.selected,a=e.onClick,o=e.onMouseDown,i=e.onMouseUp,c=Object(Ye.a)(e,["className","selected","onClick","onMouseDown","onMouseUp"]);return r.createElement(f.a,Object.assign({},c,{onClick:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return a&&a(Object(b.a)({},e,{selected:n}))})),onMouseDown:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return o&&o(Object(b.a)({},e,{selected:n}))})),onMouseUp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return i&&i(Object(b.a)({},e,{selected:n}))})),className:Y("button-select",t,Object(g.a)({},"button-select-selected",n))}))}}]),n}(r.PureComponent),Be=n(21),ze=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handlePress=function(t){t.preventRepeat();var n=e.props,a=n.onPress,r=n.keys;a&&a(t,r)},e.handleRelease=function(t){var n=e.props,a=n.onRelease,r=n.keys;a&&a(t,r)},e}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.keys;console.log(this.props),Be.bind(e,this.handlePress,this.handleRelease)}},{key:"componentDidUpdate",value:function(e){e.keys!==this.props.keys&&(Be.unbind(e.keys,this.handlePress,this.handleRelease),Be.bind(this.props.keys,this.handlePress,this.handleRelease))}},{key:"componentWillUnmount",value:function(){Be.unbind(this.props.keys,this.handlePress,this.handleRelease)}},{key:"render",value:function(){return console.log("keys render",this.props.keys),r.createElement(r.Fragment,null)}}]),n}(r.PureComponent);!function(e){e.SIN="sin",e.LOOP="loop",e.XY_PARABOLOID="parab"}(Re||(Re={}));var Ge,We,qe=n(46),Ze=(n(200),function(e){return e.toFixed(1)}),Ke=function(e){return function(t,n,a){return t-a/e}},Je=(Ge={},Object(g.a)(Ge,Re.SIN,(function(e){var t=e.range,n=e.params,a=e.changingStartValue,o=e.changeFunctionId,i=(e.changing,e.buttonWidth,(a-t[0])/(t[1]-t[0])),c=Math.min(i,n.a)+Math.min(1-i,n.a);return r.createElement("div",{className:"button-number-amplitude",style:{width:100*c+"%",left:"calc(".concat(100*Math.max(i-n.a,0),"%)")}},r.createElement("span",null,o))})),Object(g.a)(Ge,Re.LOOP,(function(e){e.range;var t=e.params,n=(e.changingStartValue,e.changeFunctionId);e.changing,e.buttonWidth;return r.createElement("div",{className:"button-number-amplitude",style:{width:100*(t.end-t.start)+"%",left:"".concat(100*t.start,"%")}},r.createElement("span",null,n))})),Object(g.a)(Ge,Re.XY_PARABOLOID,(function(e){var t=e.range,n=e.params,a=e.changingStartValue,o=e.changeFunctionId,i=e.changing,c=e.buttonWidth,s=n.end*(1-(a-t[0])/(t[1]-t[0])),u=(a-t[0])/(t[1]-t[0]),l=Math.round(c*s);if(l<=1)return r.createElement("div",{style:{width:100*s+"%",left:"".concat(100*u,"%")},className:Y("button-number-xy-amplitude",Object(g.a)({},"button-number-xy-amplitude-changing",i))},r.createElement("span",null,o));for(var p=J(l,6),h=(p.canvas,p.context.getImageData(0,0,l,6)),m=0;m<h.data.length;m+=4){var f=m/4%l,d=(Math.floor(m/4/l),qe.hsl(Math.max(Math.min(350-f/l*100,350),250),50,50).rgb().array());h.data[m]=d[0],h.data[m+1]=d[1],h.data[m+2]=d[2],h.data[m+3]=200}return r.createElement(ue,{style:{width:100*s+"%",left:"".concat(100*u,"%")},className:Y("button-number-xy-amplitude",Object(g.a)({},"button-number-xy-amplitude-changing",i)),width:l,height:6,value:h},r.createElement("span",null,o))})),Ge),$e=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var a;Object(u.a)(this,n),(a=t.call(this,e)).buttonRef=void 0,a.handleDown=function(e){if(!a.state.startValue){var t=e.e;t.persist();var n=a.props,r=n.onMouseDown,o=n.name,i=n.selected,c=a.state.value;r&&r({e:t,value:c,name:o,selected:i}),a.setState((function(e){return{startValue:e.value,startPoint:[t.clientX,t.clientY]}}),(function(){document.addEventListener("mousemove",a.handleMove),document.addEventListener("mouseup",a.handleUp)}))}},a.handleMove=function(e){var t=a.props,n=t.onChange,r=t.name,o=t.selected,i=a.calcValue(e);n&&n({e:e,value:i,name:r,selected:o}),a.setState({value:i})},a.calculateOneStep=function(e){var t=a.props,n=t.precision,r=void 0===n?100:n,o=t.range;return"function"===typeof r?(o[1]-o[0])/r(e):(o[1]-o[0])/r},a.handleUp=function(e){var t=a.props,n=(t.changingStartValue,t.onClick),r=t.onMouseUp,o=t.onChange,i=t.name,c=t.selected,s=t.width,u=void 0===s?70:s,l=(t.precision,t.range),p=a.calcValue(e),h=a.calculateOneStep(p);if(Math.abs(p-a.state.startValue)<h){var m=ae(e.target).left;p=Math.min(Math.max(a.state.startValue+(m+u/2<e.pageX?h:-h),l[0]),l[1]),o&&o({e:e,value:p,name:i,selected:c})}else r&&r({e:e,value:p,name:i,selected:c}),n&&n({value:p,name:i,e:e,selected:c});a.setState({value:p,startValue:null,startPoint:null},(function(){document.removeEventListener("mousemove",a.handleMove),document.removeEventListener("mouseup",a.handleUp)}))},a.handlePress=function(e){if(!a.state.startValue){var t=a.props,n=t.onPress,r=t.name,o=t.selected,i=a.state.value;n&&n({e:e,value:i,name:r,selected:o}),a.setState((function(e){return{startValue:e.value,startPoint:null}}),(function(){document.addEventListener("mousemove",a.handlePressed)}))}},a.handlePressed=function(e){if(a.state.startPoint){var t=a.props,n=t.onChange,r=t.name,o=t.selected,i=a.calcValue(e);n&&n({e:e,value:i,name:r,selected:o}),a.setState({value:i})}else a.setState({startPoint:[e.clientX,e.clientY]})},a.handleRelease=function(e){var t=a.props,n=t.onRelease,r=t.name,o=t.selected,i=a.state.value;n&&n({value:i,name:r,e:e,selected:o}),a.setState({value:i,startValue:null,startPoint:null},(function(){document.removeEventListener("mousemove",a.handlePressed)}))},a.calcValue=function(e){var t=a.props,n=t.range,r=t.valueD,o=void 0===r?Ke(5):r,i=t.integer,c=o(a.state.startValue,e.clientX-a.state.startPoint[0],e.clientY-a.state.startPoint[1]);return c=Math.min(Math.max(c,n[0]),n[1]),i&&(c=Math.round(c)),c};var o=e.range;return a.state={value:e.value||o[0],startPoint:null,startValue:null},a.buttonRef=r.createRef(),a}return Object(l.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return t.value!==this.state.value||!!t.startPoint||!!this.state.startPoint||e.changingStartValue!==this.props.changingStartValue||e.changeFunctionParams!==this.props.changeFunctionParams||e.changeFunctionId!==this.props.changeFunctionId||e.shortcut!==this.props.shortcut||e.className!==this.props.className}},{key:"render",value:function(){var e=this.props,t=e.changingStartValue,n=e.changeFunctionId,a=e.changeFunctionType,o=e.changeFunctionParams,i=e.range,c=e.width,s=void 0===c?70:c,u=e.className,l=e.getText,p=void 0===l?Ze:l,h=e.text,m=e.shortcut,f=Object(Ye.a)(e,["changingStartValue","changeFunctionId","changeFunctionType","changeFunctionParams","range","width","className","getText","text","shortcut"]),d=this.state,v=d.value,b=void 0===v?0:v,y=d.startValue,O=d.startPoint;console.log("number button ",p(b));var C=Je[a];return r.createElement(Ue,Object.assign({},f,{className:Y("button-number",u,Object(g.a)({},"button-number-active",!!y)),width:s,ref:this.buttonRef,onMouseDown:this.handleDown}),r.createElement("div",{className:"button-number-value",style:{width:(b-i[0])/(i[1]-i[0])*100+"%"}},p?p(b):h),n&&r.createElement(C,{changing:!!O,range:i,buttonWidth:s,params:o,changingStartValue:t,changeFunctionId:n}),m&&r.createElement(ze,{keys:m,onPress:this.handlePress,onRelease:this.handleRelease}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return Object(b.a)({},t.startPoint||e.value===t.value?{}:{value:e.value})}}]),n}(r.Component),Qe=(n(201),function(e){return e.value}),et=function(e){return e.text},tt=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleClick=function(t){var n=t.value,a=(t.selected,t.e),r=e.props,o=r.name,i=r.items,c=r.onChange,s=r.getValue,u=void 0===s?Qe:s,l=r.nullAble,p=r.value,h=u(n);l&&p===h&&(h=null),c&&c({value:h,e:a,item:n,items:i,name:o})},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.className,a=t.items,o=t.value,i=(t.name,t.getValue),c=void 0===i?Qe:i,s=t.getText,u=void 0===s?et:s,l=t.br,p=t.width;return console.log("select buttons render",a),r.createElement("div",{className:Y(n,"select-buttons"),style:{width:l?l*(+p||70):"auto"}},r.createElement("div",{className:"select-buttons-items"},a.map((function(t,n){return r.createElement(Ue,{width:p,value:t,key:n,selected:c(t)===o,onClick:e.handleClick},u(t))}))))}}]),n}(r.PureComponent),nt=(n(202),function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.nullText,a=Object(Ye.a)(e,["className","nullText"]),o=a.value,i=a.getValue,c=void 0===i?Qe:i,s=a.getText,u=void 0===s?et:s,l=a.items;console.log("select drop render",a.name,o);var p=l.find((function(e){return c(e)===o}));return r.createElement("div",{className:Y(t,"select-drop")},r.createElement(f.a,{className:"select-drop-value"},p?u(p):n||"null"),r.createElement(tt,Object.assign({},a,{className:"select-drop-items"})))}}]),n}(r.PureComponent));!function(e){e.SET_VALUE_IN_CHANGING_LIST="changing-values/set-value",e.SET_START_VALUE="changing-values/set-start-value",e.ACTIVATE_VALUE_CHANGING="changing-values/activate",e.DEACTIVATE_VALUE_CHANGING="changing-values/deactivate"}(We||(We={}));n(203),n(204);var at,rt=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.button,a=e.className;return r.createElement("div",{className:Y("hover-hideable",a)},n,r.createElement("div",{className:"hover-hideable-hidden-part"},t))}}]),n}(r.PureComponent),ot=function(e){var t=e.onChange,n=e.onFocus,a=e.onBlur,o=e.value,i=e.placeholder,c=e.className;return r.createElement("input",{className:Y(c,"input-text"),type:"text",value:o||"",onFocus:n,onBlur:a,placeholder:i,onChange:function(e){t&&t(e.target.value)}})},it=(n(205),function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleChange=function(t){e.props.onChange("Backspace"===t.key?null:t.key)},e.handleFocus=function(){Be.bind("",e.handleChange)},e.handleBlur=function(){Be.unbind("",e.handleChange)},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.value,n=e.placeholder;return r.createElement(ot,{className:"shortcut-input",value:t,placeholder:n,onFocus:this.handleFocus,onBlur:this.handleBlur,onChange:function(){}})}}]),n}(r.PureComponent)),ct=n(16),st=function(e){return e.changeFunctions.functions||{}},ut=Object(ct.a)([function(e){return e.changeFunctions.namesList||[]}],(function(e){return L(e)})),lt=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={active:!1,shortcut:null},e.handleCFChange=function(t){var n=t.value,a=e.props;(0,a.setValueInChangingList)(a.path,n,a.range,a.value)},e.handleChange=function(t){e.props.onChange(t);var n=e.props;(0,n.setStartValue)(n.path,n.value)},e.handleStartManualChanging=function(){var t=e.props;(0,t.deactivateValueChanging)(t.path),e.setState({active:!0})},e.handleStopManualChanging=function(){var t=e.props;(0,t.activateValueChanging)(t.path),e.setState({active:!1})},e.handleShortcutChange=function(t){return e.setState({shortcut:t})},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.changeFunction,n=e.changeFunctionsSelectItems,a=e.changingValues,o=e.path,i=e.className,c=Object(Ye.a)(e,["changeFunction","changeFunctionsSelectItems","changingValues","path","className"]),s=(c.onChange,c.onMouseDown,c.onMouseUp,c.onPress,c.onRelease,Object(Ye.a)(c,["onChange","onMouseDown","onMouseUp","onPress","onRelease"]));console.log("render b cf",c.name,n);var u=a[o],l=u&&u.startValue,p=u&&a[o].changeFunctionId,h=u&&t.params,m=u&&t.type;return r.createElement(rt,{className:Y("button-number-cf",i),button:r.createElement($e,Object.assign({},s,{shortcut:this.state.shortcut,className:Y("button-number-cf-value",Object(g.a)({},"button-number-cf-value-active",this.state.active)),changeFunctionId:p,changeFunctionType:m,changingStartValue:l,changeFunctionParams:h,onChange:this.handleChange,onMouseDown:this.handleStartManualChanging,onPress:this.handleStartManualChanging,onMouseUp:this.handleStopManualChanging,onRelease:this.handleStopManualChanging}))},!this.state.active&&r.createElement(rt,{className:"button-number-cf-settings",button:r.createElement("div",{className:"button-number-cf-settings-handler"},r.createElement("div",null))},r.createElement(it,{placeholder:"hotkey",value:this.state.shortcut,onChange:this.handleShortcutChange}),r.createElement(nt,{name:c.name+"-select-cf",nullAble:!0,className:"button-number-cf-select",value:a[this.props.path]&&a[this.props.path].changeFunctionId,onChange:this.handleCFChange,items:n})))}}]),n}(r.PureComponent),pt={setValueInChangingList:function(e,t,n,a){return function(r){r(ve(e)),r({type:We.SET_VALUE_IN_CHANGING_LIST,path:e,changeFunctionId:t,range:n,startValue:a})}},deactivateValueChanging:function(e){return function(t,n){n().changingValues[e]&&(t(ve(e)),t({type:We.DEACTIVATE_VALUE_CHANGING,path:e}))}},activateValueChanging:function(e){return function(t,n){n().changingValues[e]&&t({type:We.ACTIVATE_VALUE_CHANGING,path:e})}},toStartValue:ve,setStartValue:function(e,t){return function(n){n({type:We.SET_START_VALUE,path:e,startValue:t})}}},ht=Object(m.b)((function(e,t){var n,a=t.path;return{changeFunctionsSelectItems:ut(e),changeFunction:e.changeFunctions.functions[null===(n=e.changingValues[a])||void 0===n?void 0:n.changeFunctionId],changingValues:e.changingValues}}),pt)(lt);n(206);!function(e){e.SET_ROTATION="pattern/set-rotation"}(at||(at={}));var mt=[0,360],ft=Ke(.4),dt=[-800,800],vt=Ke(.6),gt=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleAngleChange=function(t){var n=t.value,a=e.props,r=a.setRotation,o=a.rotation;r(a.patternId,Object(b.a)({},o,{angle:n}))},e.handleOffsetChange=function(t){var n=t.value,a=t.name,r=e.props,o=r.setRotation,i=r.rotation;o(r.patternId,Object(b.a)({},i,{offset:Object(b.a)({},i.offset,Object(g.a)({},a,n))}))},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props.rotation,t=e.angle,n=e.offset;return r.createElement("div",{className:"rotating-controls"},r.createElement(ht,{path:"patterns.".concat(this.props.patternId,".rotation.value.angle"),name:"angle",value:t,range:mt,valueD:ft,onChange:this.handleAngleChange}),r.createElement(ht,{path:"patterns.".concat(this.props.patternId,".rotation.value.offset.x"),name:"x",value:n.x,range:dt,valueD:vt,onChange:this.handleOffsetChange}),r.createElement(ht,{path:"patterns.".concat(this.props.patternId,".rotation.value.offset.y"),name:"y",value:n.y,range:dt,valueD:vt,onChange:this.handleOffsetChange}))}}]),n}(r.PureComponent),bt={setRotation:function(e,t){return{type:at.SET_ROTATION,id:e,rotation:t}}},yt=Object(m.b)((function(e,t){var n,a,r=t.patternId;return{rotation:null===(n=e.patterns[r])||void 0===n||null===(a=n.rotation)||void 0===a?void 0:a.value}}),bt)(Object(y.c)("common")(gt));function Ot(e){for(var t,n=e.getContext("2d"),a=[],r=0;r<360;r++)t=47*r%360,a.push("hsl("+t+",50%,50%)");var o=0,i=function(e,t,a){var r=(a=a||{x:0,y:0}).x,o=a.y;n.beginPath(),n.arc(e.x+r,e.y+o,t,0,2*Math.PI),n.fill(),n.stroke()};return{getCanvas:function(){return e},reset:function(t,a){e.width=e.width,n.strokeStyle="black",n.fillStyle="none",a&&t&&(t.mouse={x:a.offsetX,y:a.offsetY}),o=0},setColor:function(e){n.strokeStyle=e},noColor:function(e){n.strokeStyle="transparent"},setRandomColor:function(){o=(o+1)%a.length;var e=a[o];n.strokeStyle=e},setRandomFill:function(e){o=(o+1)%a.length,e="undefined"===typeof e?1:e;var t=a[o];t=t.replace("hsl(","hsla(").replace(")",","+e+")"),n.fillStyle=t},setFill:function(e){n.fillStyle=e},noFill:function(){n.fillStyle="transparent"},drawSkeleton:function(e,t,a,r){t=t||{line:"rgba(255, 255, 255, .5)",points:"black"},a=a||{x:0,y:0};var o=e.points;n.strokeStyle=t.line,this.drawLine(o[0],o[1],a),3===o.length?(n.strokeStyle=t.line,this.drawLine(o[1],o[2],a)):(n.strokeStyle=t.line,this.drawLine(o[2],o[3],a)),n.strokeStyle=t.points,r||this.drawPoints(o,a)},drawCurve:function(e,t,a){t=t||{line:"lightgrey"},n.strokeStyle=t.line;var r=(a=a||{x:0,y:0}).x,o=a.y;n.beginPath();var i=e.points;n.moveTo(i[0].x+r,i[0].y+o),3===i.length&&n.quadraticCurveTo(i[1].x+r,i[1].y+o,i[2].x+r,i[2].y+o),4===i.length&&n.bezierCurveTo(i[1].x+r,i[1].y+o,i[2].x+r,i[2].y+o,i[3].x+r,i[3].y+o),n.lineWidth=1.2,n.stroke(),n.closePath(),n.lineWidth=1},drawLine:function(e,t,a){var r=(a=a||{x:0,y:0}).x,o=a.y;n.closePath(),n.beginPath(),n.moveTo(e.x+r,e.y+o),n.lineTo(t.x+r,t.y+o),n.stroke(),n.closePath()},drawPoint:function(e,t){var a=(t=t||{x:0,y:0}).x,r=t.y;n.beginPath(),n.arc(e.x+a,e.y+r,5,0,2*Math.PI),n.stroke()},drawPoints:function(e,t){t=t||{x:0,y:0},e.forEach(function(e,a){if(2===a||1===a)i(e,3,t);else{n.rect(t.x+e.x-2.5,t.y+e.y-2.5,5,5),n.stroke()}}.bind(this))},drawArc:function(e,t){var a=(t=t||{x:0,y:0}).x,r=t.y;n.beginPath(),n.moveTo(e.x+a,e.y+r),n.arc(e.x+a,e.y+r,e.r,e.s,e.e),n.lineTo(e.x+a,e.y+r),n.fill(),n.stroke()},drawCircle:i,drawbbox:function(e,t){var a=(t=t||{x:0,y:0}).x,r=t.y;n.beginPath(),n.moveTo(e.x.min+a,e.y.min+r),n.lineTo(e.x.min+a,e.y.max+r),n.lineTo(e.x.max+a,e.y.max+r),n.lineTo(e.x.max+a,e.y.min+r),n.closePath(),n.stroke()},drawRect:function(e,t,a,r){var o=(r=r||{x:0,y:0}).x,i=r.y;n.beginPath(),n.moveTo(e.x-t/2+o,e.y-a/2+i),n.lineTo(e.x-t/2+t+o,e.y-a/2+i),n.lineTo(e.x-t/2+t+o,e.y-a/2+a+i),n.lineTo(e.x-t/2+o,e.y-a/2+a+i),n.closePath(),n.fill(),n.stroke()},drawHull:function(e,t){n.beginPath(),6===e.length?(n.moveTo(e[0].x,e[0].y),n.lineTo(e[1].x,e[1].y),n.lineTo(e[2].x,e[2].y),n.moveTo(e[3].x,e[3].y),n.lineTo(e[4].x,e[4].y)):(n.moveTo(e[0].x,e[0].y),n.lineTo(e[1].x,e[1].y),n.lineTo(e[2].x,e[2].y),n.lineTo(e[3].x,e[3].y),n.moveTo(e[4].x,e[4].y),n.lineTo(e[5].x,e[5].y),n.lineTo(e[6].x,e[6].y),n.moveTo(e[7].x,e[7].y),n.lineTo(e[8].x,e[8].y)),n.stroke()},drawShape:function(e,t){t=t||{x:0,y:0};var a=e.forward.points.length-1;n.beginPath(),n.moveTo(t.x+e.startcap.points[0].x,t.y+e.startcap.points[0].y),n.lineTo(t.x+e.startcap.points[3].x,t.y+e.startcap.points[3].y),3===a?n.bezierCurveTo(t.x+e.forward.points[1].x,t.y+e.forward.points[1].y,t.x+e.forward.points[2].x,t.y+e.forward.points[2].y,t.x+e.forward.points[3].x,t.y+e.forward.points[3].y):n.quadraticCurveTo(t.x+e.forward.points[1].x,t.y+e.forward.points[1].y,t.x+e.forward.points[2].x,t.y+e.forward.points[2].y),n.lineTo(t.x+e.endcap.points[3].x,t.y+e.endcap.points[3].y),3===a?n.bezierCurveTo(t.x+e.back.points[1].x,t.y+e.back.points[1].y,t.x+e.back.points[2].x,t.y+e.back.points[2].y,t.x+e.back.points[3].x,t.y+e.back.points[3].y):n.quadraticCurveTo(t.x+e.back.points[1].x,t.y+e.back.points[1].y,t.x+e.back.points[2].x,t.y+e.back.points[2].y),n.closePath(),n.fill(),n.stroke()},drawText:function(e,t){t=t||{x:0,y:0},n.fillText(e,t.x,t.y)}}}n(207);var Ct,jt={x:55,y:17},Et=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).canvasRef=void 0,a.drawFunctions=void 0,a.curve=void 0,a.draw=function(){var e=a.canvasRef.current.getContext("2d");a.props.xn,a.props.yn;e.lineWidth=1,e.strokeStyle="#595959",e.stroke(),e.font="8px arial",e.textBaseline="hanging",e.textAlign="center",e.fillStyle="white"},a.handleUpdate=function(){a.forceUpdate(),a.drawFunctions.reset(),a.draw(),a.props.onChange(a.curve.points)},a.canvasRef=r.createRef(),a.curve=new oe(e.value),a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.canvasRef.current&&(this.drawFunctions=Ot(this.canvasRef.current),this.draw(),(function(e,t,n){var a=(n=n||{x:0,y:0}).x,r=n.y;t.mouse=!1;var o,i,c=t.points,s=!1,u=0,l=0,p=0,h=0,m=null,f={onupdate:function(e){}};e.addEventListener("mousedown",(function(e){document.addEventListener("mouseup",d),u=e.offsetX-a,l=e.offsetY-r,c.forEach((function(e){Math.abs(u-e.x)<10&&Math.abs(l-e.y)<10&&(s=!0,m=e,o=e.x,i=e.y)}))})),e.addEventListener("mousemove",(function(n){var d=!1;c&&(c.forEach((function(e){var t=n.offsetX-a,o=n.offsetY-r;Math.abs(t-e.x)<10&&Math.abs(o-e.y)<10&&(d=d||!0)})),e.style.cursor=d?"pointer":"default",s&&(p=n.offsetX-u-a,h=n.offsetY-l-r,m.x=o+p,m.y=i+h,t.update(),f.onupdate()))}));var d=function e(t){document.removeEventListener("mouseup",e),s&&(s=!1,m=!1)};return e.addEventListener("click",(function(e){e.offsetX,e.offsetY})),f}(this.canvasRef.current,this.curve,jt)).onupdate=this.handleUpdate)}},{key:"componentDidUpdate",value:function(e,t,n){e.value===this.props.value&&e.xn===this.props.xn&&e.yn===this.props.yn||(this.curve.points[0]=this.props.value[0],this.curve.points[1]=this.props.value[1],this.curve.points[2]=this.props.value[2],this.curve.points[3]=this.props.value[3],this.curve.update(),this.drawFunctions.reset(),this.draw(),this.forceUpdate())}},{key:"render",value:function(){var e=this,t=this.curve.points;return r.createElement("div",{className:"grid-bezier-curve"},r.createElement("canvas",{className:"grid-bezier-curve-canvas",width:210,height:140,ref:this.canvasRef}),r.createElement(w,{className:"grid-bezier-curve-markers",width:210,height:140},r.createElement("rect",{strokeWidth:"0.3",stroke:"white",fill:"transparent",x:jt.x,y:jt.y,width:100,height:100}),function(){for(var e=[],t=[],n=0;n<=4;n++)e.push({y:100+jt.y,x:n/4*100+jt.x,text:Math.round(n/4*100)});for(var a=0;a<=4;a++)t.push({y:a/4*100+jt.y,x:jt.x,text:Math.round(100-a/4*100)});return r.createElement(r.Fragment,null,e.map((function(e){var t=e.text,n=e.x,a=e.y;return r.createElement("text",{textAnchor:"middle",className:"grid-bezier-curve-canvas-numbers",x:n,y:a+12},t)})),t.map((function(e){var t=e.text,n=e.x,a=e.y;return r.createElement("text",{textAnchor:"end",className:"grid-bezier-curve-canvas-numbers",x:n-6,y:a+2},t)})),e.map((function(e){var t=e.x,n=e.y;return r.createElement("path",{d:"M".concat(t," ").concat(n," L").concat(t," ").concat(n+3," "),strokeWidth:"0.3",stroke:"white",fill:"transparent"})})),t.map((function(e){var t=e.x,n=e.y;return r.createElement("path",{d:"M".concat(t," ").concat(n," L").concat(t-4," ").concat(n," "),strokeWidth:"0.3",stroke:"white",fill:"transparent"})})))}(),function(){for(var t=[],n=0;n<=e.props.xn;n++)for(var a=e.curve.get(n/e.props.xn),o=0;o<=e.props.yn;o++){var i=e.curve.get(o/e.props.yn);t.push({x:jt.x+a.x,y:jt.y+i.y})}return t.map((function(e){var t=e.x,n=e.y;return r.createElement("rect",{fill:"white",x:t-.5,y:n-.5,width:1,height:1})}))}(),r.createElement("path",{d:"M".concat(t[0].x+jt.x," ").concat(t[0].y+jt.y," L").concat(t[1].x+jt.x," ").concat(t[1].y+jt.y," "),stroke:"white",strokeWidth:"0.3",fill:"transparent"}),r.createElement("path",{d:"M".concat(t[2].x+jt.x," ").concat(t[2].y+jt.y," L").concat(t[3].x+jt.x," ").concat(t[3].y+jt.y," "),stroke:"white",strokeWidth:"0.4",fill:"transparent"}),r.createElement("path",{d:"M".concat(t[0].x+jt.x," ").concat(t[0].y+jt.y," C ").concat(t[1].x+jt.x," ").concat(t[1].y+jt.y,", ").concat(t[2].x+jt.x," ").concat(t[2].y+jt.y,", ").concat(t[3].x+jt.x," ").concat(t[3].y+jt.y),stroke:"#ffcd00",fill:"transparent"}),t.map((function(e){var t=e.x,n=e.y;return r.createElement("rect",{stroke:"white",fill:"black",x:t-2.5+jt.x,y:n-2.5+jt.y,width:5,height:5})}))))}}]),n}(r.PureComponent);n(208);!function(e){e.SET_REPEATING="pattern/set-repeating"}(Ct||(Ct={}));var xt,kt=[1,10],St=[0,3],Pt=Ke(9),wt=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleGridParamsChange=function(t){var n=t.value,a=t.name,r=e.props,o=r.setRepeating,i=r.repeating;o(r.patternId,Object(b.a)({},i,{gridParams:Object(b.a)({},i.gridParams,Object(g.a)({},a,n))}))},e.handleIntegerChange=function(t){var n=t.selected,a=t.name,r=e.props,o=r.setRepeating,i=r.repeating;o(r.patternId,Object(b.a)({},i,{gridParams:Object(b.a)({},i.gridParams,Object(g.a)({},a,n))}))},e.handleBezierChange=function(t){var n=e.props,a=n.setRepeating,r=n.repeating;a(n.patternId,Object(b.a)({},r,{gridParams:Object(b.a)({},r.gridParams,{bezierPoints:t})}))},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props.repeating,t=e.type,n=e.gridParams;return r.createElement("div",{className:"repeating-controls"},t===re.Grid&&r.createElement("div",{className:"repeating-controls-grid"},r.createElement("div",{className:"repeating-controls-grid-buttons"},r.createElement("div",{className:"repeating-controls-grid-buttons-row"},r.createElement(Ue,{className:"repeating-button",name:"integer",onClick:this.handleIntegerChange,selected:!n.integer},n.integer?"int":"float"),r.createElement(ht,{className:"repeating-button-number",integer:n.integer,path:"patterns.".concat(this.props.patternId,".repeating.params.gridParams.x"),name:"x",value:n.x,range:kt,valueD:Pt,onChange:this.handleGridParamsChange}),r.createElement(ht,{className:"repeating-button-number",integer:n.integer,path:"patterns.".concat(this.props.patternId,".repeating.params.gridParams.y"),name:"y",value:n.y,range:kt,valueD:Pt,onChange:this.handleGridParamsChange})),r.createElement("div",{className:"repeating-controls-grid-buttons-row"},r.createElement(ht,{className:"repeating-button-number",integer:n.integer,path:"patterns.".concat(this.props.patternId,".repeating.params.gridParams.xOut"),name:"xOut",value:n.xOut,range:St,valueD:Pt,onChange:this.handleGridParamsChange}),r.createElement(ht,{className:"repeating-button-number",integer:n.integer,path:"patterns.".concat(this.props.patternId,".repeating.params.gridParams.yOut"),name:"yOut",value:n.yOut,range:St,valueD:Pt,onChange:this.handleGridParamsChange}))),r.createElement(Et,{xn:n.x,yn:n.y,value:n.bezierPoints,onChange:this.handleBezierChange})))}}]),n}(r.PureComponent),Tt={setRepeating:function(e,t){return{type:Ct.SET_REPEATING,id:e,repeating:t}}},Dt=Object(m.b)((function(e,t){var n,a,r=t.patternId;return{repeating:(null===(n=e.patterns[r])||void 0===n||null===(a=n.repeating)||void 0===a?void 0:a.params)||null}}),Tt)(Object(y.c)("common")(wt)),At=(n(209),function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.onClear,n=e.onCreatePattern,a=e.onCut,o=e.selectionValue;return o.segments&&o.segments.length?r.createElement("div",{className:"selection-controls"},r.createElement(f.a,{onClick:t},"clear"),r.createElement(f.a,{onClick:n},"pattern"),r.createElement(f.a,{onClick:a},"cut")):null}}]),n}(r.PureComponent)),It=(n(210),function(e){return function(t,n){return Object(b.a)({},t,Object(g.a)({},n.id,e(t[n.id],n,t)))}}),Rt=function(e){return{startImage:e.current.imageData,startMask:e.mask?e.mask.value.imageData:null,width:e.current.width,height:e.current.height,history:!!e.history,store:!!e.store,selection:!!e.selection,mask:!!e.mask,rotation:!!e.rotation,repeating:!!e.repeating,room:!!e.room}},Nt=function(e){return{history:e.history&&e.history.params,store:e.store&&e.store.params,rotation:e.rotation&&e.rotation.params,repeating:e.repeating&&e.repeating.params,selection:e.selection&&e.selection.params,mask:e.mask&&e.mask.params,import:e.import&&e.import.params,room:e.room&&e.room.params}};!function(e){e.UPDATE_IMAGE="pattern/update-image",e.EDIT_CONFIG="pattern/edit-config",e.SET_WIDTH="pattern/set-width",e.SET_HEIGHT="pattern/set-height"}(xt||(xt={}));var Mt,Lt,Ft=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(a,r){var o,i=null===(o=r().patterns[e].room)||void 0===o?void 0:o.value.socket;return n&&i&&i.emit("image",te(t)),a({type:xt.UPDATE_IMAGE,imageData:t,id:e})}},Vt=n(132),_t="right",Xt="left",Ht="fromcenter",Yt="tocenter",Ut=function(){function e(t,n){var a=this;Object(u.a)(this,e),this.array=void 0,this.type=void 0,this.setType=function(e){return a.type=e},this.array=new Array(t),this.type=n||_t}return Object(l.a)(e,[{key:"push",value:function(e){switch(this.type){case _t:this.array.shift(),this.array.push(e);break;case Xt:this.array.pop(),this.array.unshift(e);break;case Ht:this.array.pop(),this.array.shift(),this.array=[].concat(Object(D.a)(this.array.slice(0,this.array.length/2)),[e,e],Object(D.a)(this.array.slice(this.array.length/2,this.array.length)));break;case Yt:this.array.push(e),this.array.unshift(e),this.array=[].concat(Object(D.a)(this.array.slice(0,this.array.length/2-1)),Object(D.a)(this.array.slice(this.array.length/2+1,this.array.length)));break;default:this.array.shift(),this.array.push(e)}}}]),e}(),Bt=function(e,t,n,a,r,o){return e[(a+r*t)*n]=o[0],e[(a+r*t)*n+1]=o[1],e[(a+r*t)*n+2]=o[2],e[(a+r*t)*n+3]=o[3],e},zt=n(70),Gt=new(function(){function e(){var t=this;Object(u.a)(this,e),this.captures={},this.pause=function(e){t.captures[e].sketch.noLoop()},this.play=function(e){t.captures[e].sketch.loop()},this.start=function(e,n,a){return t.captures[e]&&t.stop(e),t.captures[e]=t.createCapture(e,n,a),t.captures[e]},this.stop=function(e){var n=t.captures,a=n[e],r=Object(Ye.a)(n,[e].map(Vt.a));a&&(a.sketch.noLoop(),a.sketch.remove(),a.stream.getTracks()[0].stop(),t.captures=r)}}return Object(l.a)(e,[{key:"createCapture",value:function(e,t,n){var a,r,o=this,i=320,c=240,s=new Ut(i),u=(Array.from(Array(i)).map((function(e,t){return t*c/i})),function(e,t,a){var r=Math.round(n(e,t,a));return r>=a&&(r=a-1),r}),l=function(e,t,n,a){return function(e,t,n,a,r){return e?[e[(a+r*t)*n],e[(a+r*t)*n+1],e[(a+r*t)*n+2],e[(a+r*t)*n+3]]:[0,0,0,255]}(e[t],i,4,a,n)},p=new zt((function(n){n.setup=function(){n.pixelDensity(1),(a=n.createCanvas(i,c)).parent("v1"),(r=n.createCapture({video:{mandatory:{minWidth:i,minHeight:c},optional:[{maxFrameRate:30}]},audio:!1},(function(t,n){o.captures[e].stream=t,console.log(t,n)}))).parent("v2"),r.size(i,c),n.frameRate(30)},n.draw=function(){n.loadPixels(),r.loadPixels(),s.push(r.pixels);for(var e=s.array,a=0;a<i;a++)for(var o=0;o<c;o++){var p=u(a,o,e.length);Bt(n.pixels,i,4,a,o,l(e,a,o,p))}n.updatePixels(),t(n.pixels)}}));return this.captures[e]={sketch:p,canvas:a,capture:r},this.captures[e]}}]),e}());!function(e){e.Boolean="boolean",e.Number="number",e.Select="select"}(Lt||(Lt={}));var Wt,qt,Zt,Kt,Jt=(Mt={},Object(g.a)(Mt,Lt.Boolean,Ue),Object(g.a)(Mt,Lt.Select,tt),Object(g.a)(Mt,Lt.Number,$e),Mt),$t=(r.PureComponent,[{name:"a",type:Lt.Number,props:{valueD:Ke(100),range:[0,1]}},{name:"t",type:Lt.Number,props:{valueD:Ke(.1),range:[1,5e3]}},{name:"o",type:Lt.Number,props:{valueD:Ke(4),range:[0,1]}}]),Qt=[{name:"start",type:Lt.Number,props:{valueD:Ke(100),range:[0,1]}},{name:"end",type:Lt.Number,props:{valueD:Ke(100),range:[0,1]}},{name:"t",type:Lt.Number,props:{valueD:Ke(.1),range:[-3e3,3e3]}}],en=function(e,t,n,a){return function(r,o){return Math.pow(r-e,2)*n+Math.pow(o-t,2)*a}},tn=[{name:"zd",type:Lt.Number,props:{valueD:Ke(100),range:[0,1]}},{name:"end",type:Lt.Number,props:{valueD:Ke(100),range:[0,1]}},{name:"x",type:Lt.Number,props:{valueD:Ke(.1),range:[-500,500]}},{name:"y",type:Lt.Number,props:{valueD:Ke(.1),range:[-500,500]}},{name:"xa",type:Lt.Number,props:{valueD:Ke(10),range:[-10,10]}},{name:"ya",type:Lt.Number,props:{valueD:Ke(10),range:[-10,10]}}],nn=(Wt={},Object(g.a)(Wt,Re.SIN,{a:.3,t:3e3,o:0}),Object(g.a)(Wt,Re.LOOP,{start:0,end:1,t:3e3,p:0}),Object(g.a)(Wt,Re.XY_PARABOLOID,{zd:0,end:1,x:1.5,y:1.5}),Wt),an=(qt={},Object(g.a)(qt,Re.SIN,$t),Object(g.a)(qt,Re.LOOP,Qt),Object(g.a)(qt,Re.XY_PARABOLOID,tn),qt),rn=function(e,t){return{id:e,type:t,params:nn[t],paramsConfig:an[t]}},on=(Zt={},Object(g.a)(Zt,Re.SIN,(function(e){var t=e.params,n=e.range;e.pattern;return function(e){var a=e.startValue,r=e.time;e.position;return a+t.a*(n[1]-n[0])*Math.sin(r/t.t*2*Math.PI+2*t.o*Math.PI)}})),Object(g.a)(Zt,Re.LOOP,(function(e){var t=e.params,n=e.range;e.pattern;return function(e){var a=e.startValue,r=e.time,o=(e.position,r%t.t/t.t),i=t.start*(n[1]-n[0]),c=t.end*(n[1]-n[0])-i;return(a-i+c*o)%c+i}})),Object(g.a)(Zt,Re.XY_PARABOLOID,(function(e){var t=e.params,n=e.range,a=e.pattern;return function(e){var r=e.startValue,o=(e.time,e.position),i=t.x,c=t.y,s=t.end,u=t.zd,l=en(.5,.5,i,c),p=a.current.width,h=a.current.height,m=l(o.x/p,o.y/h)+u;return Math.max(Math.min(m*s*(n[1]-n[0])+r,r+(n[1]-r)*s),r)}})),Zt),cn=Object(g.a)({},Re.XY_PARABOLOID,(function(e,t,n,a,r){var o=r.x,i=r.y,c=r.end,s=r.zd;return(en(.5,.5,o,i)(e/n,t/a)*c+s)*n}));!function(e){e.SET_VIDEO_PARAMS="pattern/video/set-video-param"}(Kt||(Kt={}));var sn,un=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).capture=void 0,e.sketch=void 0,e.stream=void 0,e.state={pause:!1},e.handleChangeOnParam=function(t){var n=e.props,a=n.setVideoParams,r=n.videoParams,o=n.patternId,i=t.selected;a(o,Object(b.a)({},r,{on:!i})),e.setState({pause:i})},e.handleChangeParam=function(t){var n=e.props,a=n.setVideoParams,r=n.videoParams,o=n.patternId,i=t.value,c=t.name;a(o,Object(b.a)({},r,Object(g.a)({},c,i)))},e.handlePause=function(){e.state.pause?(e.props.play(e.props.patternId),e.setState({pause:!1})):(e.props.pause(e.props.patternId),e.setState({pause:!0}))},e.availableChangeTypes=[Re.XY_PARABOLOID],e}return Object(l.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){!e.videoParams.on&&this.props.videoParams.on&&this.props.start(this.props.patternId),e.videoParams.on&&!this.props.videoParams.on&&this.props.stop(this.props.patternId)}},{key:"componentWillUnmount",value:function(){this.props.stop(this.props.patternId)}},{key:"render",value:function(){var e=this,t=this.props,n=t.changeFunctions,a=t.videoParams,o=a.on;return r.createElement("div",{className:"video-controls"},r.createElement(Ue,{selected:o,name:"on",onClick:this.handleChangeOnParam},o?"off":"on"),r.createElement(Ue,{disabled:!o,selected:this.state.pause&&o,name:"pause",onClick:this.handlePause},this.state.pause?"play":"pause"),r.createElement(nt,{nullAble:!0,getValue:function(e){return e.id},getText:function(e){return e.id},name:"changeFunctionId",value:a.changeFunctionId,items:Object.values(n).filter((function(t){return-1!==e.availableChangeTypes.indexOf(t.type)})),onChange:this.handleChangeParam}))}}]),n}(r.PureComponent),ln={start:function(e){return function(t,n){Gt.start(e,(function(n){return t(Ft(e,new ImageData(n,320),!1))}),(function(t,a,r){var o=n(),i=o.patterns[e].video.params.changeFunctionId;if(i){var c=o.patterns[e].current.width,s=o.patterns[e].current.height,u=o.changeFunctions.functions[i].params,l=o.changeFunctions.functions[i].type;return cn[l](t,a,c,s,u)}return t}))}},stop:function(e){return function(t,n){Gt.stop(e)}},pause:function(e){return function(t,n){Gt.pause(e)}},play:function(e){return function(t,n){Gt.play(e)}},setVideoParams:function(e,t){return function(n,a){n({type:Kt.SET_VIDEO_PARAMS,id:e,value:t})}},onNewVideoFrame:function(e,t){return function(n,a){n(Ft(e,t))}}},pn=Object(m.b)((function(e,t){var n,a,r=t.patternId;return{changeFunctions:st(e),videoParams:(null===(n=e.patterns[r])||void 0===n||null===(a=n.video)||void 0===a?void 0:a.params)||null}}),ln)(un),hn=(n(211),function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).inputRef=void 0,a.handleFile=function(e){var t=new FileReader;t.onload=function(e){var t=new Image;t.onload=function(){a.props.onChange(t)},t.src=e.target.result,a.inputRef.current.value=null},e.target.files[0]&&t.readAsDataURL(e.target.files[0])},a.inputRef=r.createRef(),a}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.children;return r.createElement("div",{className:"input-file"},r.createElement("input",{type:"file",name:t,id:t,ref:this.inputRef,onChange:this.handleFile}),r.createElement("label",{htmlFor:t},n))}}]),n}(r.PureComponent));!function(e){e.UPDATE_MASK="pattern/update-mask",e.SET_MASK_PARAMS="pattern/set-mask-params"}(sn||(sn={}));var mn,fn=function(e,t){return{type:sn.UPDATE_MASK,imageData:t,id:e}};!function(e){e.SET_IMPORT_PARAMS="pattern/set-import-params",e.LOAD="pattern/load",e.SAVE="pattern/save"}(mn||(mn={}));var dn,vn=n(47);!function(e){e.CREATE_ROOM="pattern/create-room"}(dn||(dn={}));var gn,bn=function(e,t){return function(n){var a=vn("http://64.227.78.194:3000",{path:"/room",query:{name:t}});return a.on("image",(function(t){var a;(a=t,new Promise((function(e){var t=new Image;t.src=a,t.onload=function(){var n=J(t.width,t.height),a=n.canvas,r=n.context;r.drawImage(t,0,0),e(r.getImageData(0,0,a.width,a.height))}}))).then((function(t){n(Ft(e,t,!1))}))})),n({type:dn.CREATE_ROOM,id:e,roomName:t,socket:a})}},yn=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={roomName:""},e.handleCreateRoom=function(){var t=e.props;(0,t.createRoom)(t.patternId,e.state.roomName)},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this,t=this.props.connected;return r.createElement(r.Fragment,null,t,r.createElement(ot,{value:this.state.roomName,onChange:function(t){return e.setState({roomName:t})}}),r.createElement(f.a,{onClick:this.handleCreateRoom}))}}]),n}(r.PureComponent),On={createRoom:bn},Cn=Object(m.b)((function(e,t){var n,a,r=t.patternId;return{connected:null===(n=e.patterns[r].room)||void 0===n||null===(a=n.value)||void 0===a?void 0:a.connected}}),On)(yn),jn={min:0,max:500,step:1,delay:1e3,notZero:!0},En=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleImageChange=function(t){return e.props.onImageChange(e.props.id,t)},e.handleMaskChange=function(t){return e.props.onMaskChange(e.props.id,t)},e.handleSelectionChange=function(t,n){return e.props.onSelectionChange(e.props.id,t,n)},e.handleClearSelection=function(){return e.props.onSelectionChange(e.props.id,[],null)},e.handleRemove=function(){return e.props.onRemove(e.props.id)},e.handleDouble=function(){return e.props.onDouble(e.props.id)},e.handleSetWidth=function(t){return e.props.onSetWidth(e.props.id,t)},e.handleSetHeight=function(t){return e.props.onSetHeight(e.props.id,t)},e.handleMaskParamsChange=function(t){return e.props.onMaskParamsChange(e.props.id,t)},e.handleCreateRoom=function(t){e.props.onCreateRoom(e.props.id,t)},e.handleConfigToggle=function(t){e.props.editConfig(e.props.id,Object(b.a)({},e.props.config,Object(g.a)({},t.name,!t.selected)))},e.handleLoad=function(t){e.props.onLoad(e.props.id,t)},e.handleSave=function(){e.props.onSave(e.props.id)},e.handleFitChange=function(t){var n=e.props,a=n.importParams,r=n.id,o=t.selected;e.props.setImportParams(r,Object(b.a)({},a,{fit:!o}))},e.handleCreatePatternFromSelection=function(){e.props.onCreatePatternFromSelection(e.props.id)},e.handleCutBySelection=function(){e.props.onCutBySelection(e.props.id)},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.imageValue,n=e.maskValue,a=e.height,o=e.width,i=e.id,c=e.config,s=e.selection,u=e.rotation,l=(e.importParams,e.t);return console.log("pattern render ",i,u),r.createElement("div",{className:"pattern"},r.createElement("div",{className:"left"},r.createElement("div",{className:"plugins"},c.repeating&&r.createElement(Dt,{patternId:i}),c.video&&r.createElement(pn,{patternId:i}),c.rotation&&r.createElement(yt,{patternId:i}),c.room&&r.createElement(Cn,{patternId:i}),r.createElement("div",{className:"plugins-toggles"},r.createElement(Ue,{name:"repeating",selected:c.repeating,onClick:this.handleConfigToggle},l("plugins.repeating")),r.createElement(Ue,{name:"rotation",selected:c.rotation,onClick:this.handleConfigToggle},l("plugins.rotating")),r.createElement(Ue,{name:"room",selected:c.room,onClick:this.handleConfigToggle},l("plugins.room")),r.createElement(Ue,{name:"video",selected:c.video,onClick:this.handleConfigToggle},l("plugins.video")))),r.createElement("div",{className:"pattern-controls"},r.createElement(f.a,{onClick:this.handleRemove},l("patternControls.delete")),r.createElement(f.a,{onClick:this.handleDouble},l("patternControls.double")),r.createElement("div",{className:"save-load-sizes"},r.createElement("div",null,r.createElement(f.a,{onClick:this.handleSave},l("patternControls.save")),r.createElement(hn,{name:i+"-fileInput",onChange:this.handleLoad},l("patternControls.load")),r.createElement(Ue,{selected:this.props.importParams.fit,onClick:this.handleFitChange},l("patternControls.stretch"))),r.createElement("div",{className:"pattern-sizes"},r.createElement(He,Object.assign({className:"size-input-number",onChange:this.handleSetWidth,value:o},jn)),r.createElement(He,Object.assign({className:"size-input-number",onChange:this.handleSetHeight,value:a},jn)))))),r.createElement("div",{className:"right"},r.createElement(At,{selectionValue:s.value,onCreatePattern:this.handleCreatePatternFromSelection,onClear:this.handleClearSelection,onCut:this.handleCutBySelection}),r.createElement("div",{className:"areas"},r.createElement(Xe,{name:i,width:o,height:a,rotation:u,imageValue:t,selectionValue:s.value.segments,selectionParams:s.params,onImageChange:this.handleImageChange,onSelectionChange:this.handleSelectionChange}),c.mask&&r.createElement(Xe,{mask:!0,name:i,rotation:u,imageValue:n,selectionValue:s.value.segments,selectionParams:s.params,width:o,height:a,onSelectionChange:this.handleSelectionChange,onImageChange:this.handleMaskChange})),c.history&&r.createElement(j,{patternId:i})))}}]),n}(r.PureComponent),xn={updateImage:Ft,updateMask:fn,editConfig:function(e,t){return{type:xt.EDIT_CONFIG,id:e,config:t}},setImportParams:function(e,t){return{type:mn.SET_IMPORT_PARAMS,id:e,value:t}}},kn=Object(m.b)((function(e,t){var n,a,r,o,i=t.id,c=e.patterns[i];return{importParams:c.import.params,config:c.config,width:c.current.width,height:c.current.height,selection:null===c||void 0===c?void 0:c.selection,rotation:null===c||void 0===c||null===(n=c.rotation)||void 0===n?void 0:n.value,imageValue:(null===c||void 0===c||null===(a=c.current)||void 0===a?void 0:a.imageData)||null,maskValue:(null===c||void 0===c||null===(r=c.mask)||void 0===r||null===(o=r.value)||void 0===o?void 0:o.imageData)||null}}),xn)(Object(y.c)("common")(En)),Sn=function(e,t){return function(n,a,r){if(n)return{value:a?a.value:e,params:r?a?Object(b.a)({},a.params,{},r):Object(b.a)({},t,{},r):a?a.params:t}}},Pn=Sn({segments:[],bBox:null,mask:null},{}),wn=function(e,t,n){var a=J(e,t).context,r=new Path2D(function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setPathData(e),t.getAttribute("d")}(n));return a.fillStyle="black",a.fill(r),a.getImageData(0,0,e,t)},Tn=function(e){var t=e.selection.value.bBox,n=wn(e.current.width,e.current.height,e.selection.value.segments),a=J(e.current.width,e.current.height).context;return n&&(a.putImageData(n,0,0),a.globalCompositeOperation="source-in"),a.drawImage(Q(e.current.imageData),0,0,e.current.width,e.current.height),a.getImageData(t.x,t.y,t.width,t.height),a.getImageData(t.x,t.y,t.width,t.height)};!function(e){e.UPDATE_SELECTION="pattern/update-selection"}(gn||(gn={}));var Dn,An=function(e,t,n){return{type:gn.UPDATE_SELECTION,value:t,bBox:n,id:e}},In=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleAddClick=function(){return e.props.addPattern({history:!0,selection:!0,rotation:!0,repeating:!1})},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.patterns,n=e.createRoom,a=e.removePattern,o=e.updateImage,i=e.updateMask,c=e.setMaskParams,s=e.updateSelection,u=e.setWidth,l=e.setHeight,p=e.save,h=e.load,m=e.createPatternFromSelection,d=e.doublePattern,v=e.cutPatternBySelection,g=e.t;return r.createElement(r.Fragment,null,t.map((function(e){var t=e.id,f=(e.current,e.mask,e.config,e.store),g=(e.selection,e.connected),b=e.resultImage;e.rotation,e.import;return r.createElement(kn,{key:t,id:t,connected:g,store:f,resultImage:b,onImageChange:o,onMaskChange:i,onMaskParamsChange:c,onSelectionChange:s,onRemove:a,onSetWidth:u,onSetHeight:l,onCreateRoom:n,onSave:p,onLoad:h,onCreatePatternFromSelection:m,onDouble:d,onCutBySelection:v})})),r.createElement("div",{className:"zero-pattern"},r.createElement(f.a,{onClick:this.handleAddClick},g("add"))))}}]),n}(r.PureComponent),Rn={setMaskParams:function(e,t){return{type:sn.SET_MASK_PARAMS,id:e,params:t}},createRoom:bn,addPattern:v,removePattern:function(e){return{type:a.REMOVE_PATTERN,id:e}},updateImage:Ft,updateSelection:An,setWidth:function(e,t){return{type:xt.SET_WIDTH,id:e,width:t}},setHeight:function(e,t){return{type:xt.SET_HEIGHT,id:e,height:t}},updateMask:fn,save:function(e){return function(t,n){var a=n(),r=document.createElement("canvas"),o=r.getContext("2d");if(!o)return null;r.width=a.patterns[e].current.width,r.height=a.patterns[e].current.height,o.putImageData(a.patterns[e].current.imageData,0,0);var i=r.toDataURL("image/png"),c=document.createElement("a");document.body.appendChild(c),c.href=i,c.download="".concat(function(){var e,t=new Date;return e=4===t.getDay()||4===t.getDay()?X:_,H=(H+1)%4,e(t.getTime().toString(4),0)}(),".png"),c.click(),document.body.removeChild(c),t({type:mn.SAVE,id:e})}},load:function(e,t){return function(n,a){var r=function(e){var t=J(e.width,e.height).context;return t.drawImage(e,0,0),t.getImageData(0,0,e.width,e.height)}(t),o=a();if(o.patterns[e].import.params.fit){var i=document.createElement("canvas"),c=i.getContext("2d");if(!c)return null;var s=o.patterns[e].current.width,u=o.patterns[e].current.height;i.width=s,i.height=u,c.drawImage(t,0,0,s,u);var l=c.getImageData(0,0,s,u);n(Ft(e,l))}else n(Ft(e,r));n({type:mn.LOAD,id:e,imageData:r})}},createPatternFromSelection:function(e){return function(t,n){var a=n().patterns[e],r=Object(b.a)({},Rt(a),{mask:!0}),o=Nt(a);r.startImage=Tn(a),r.startMask=function(e){var t=e.selection.value.bBox,n=wn(e.current.width,e.current.height,e.selection.value.segments),a=J(e.current.width,e.current.height).context;return n&&(a.putImageData(n,0,0),a.globalCompositeOperation="source-in"),e.mask?a.drawImage(Q(e.mask.value.imageData),0,0,e.current.width,e.current.height):(a.fillStyle="black",a.fillRect(0,0,e.current.width,e.current.height)),a.getImageData(t.x,t.y,t.width,t.height),a.getImageData(t.x,t.y,t.width,t.height)}(a),t(v(r,o))}},doublePattern:function(e){return function(t,n){var a=n().patterns[e],r=Rt(a),o=Nt(a);t(v(r,o))}},cutPatternBySelection:function(e){return function(t,n){var a=n().patterns[e];t(Ft(e,Tn(a))),t(An(e,[],null))}}},Nn=Object(m.b)((function(e){return{patterns:Object.values(e.patterns)}}),Rn)(Object(y.c)("common")(In));!function(e){e.SET_CURRENT="tools/set-current"}(Dn||(Dn={}));var Mn;!function(e){e.SET_PARAMS="brush/set-params"}(Mn||(Mn={}));var Ln,Fn=Object(ct.a)([function(e){return e.patterns}],(function(e){return Object.values(e).map((function(e){var t=e,n=t.current,a=t.id,r=t.resultImage;return{imageData:n.imageData,image:r,id:a}}))})),Vn=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).canvasRef=void 0,a.drawFunctions=void 0,a.draw=function(){var e=a.props,t=e.width,n=e.height,r=e.imageData;a.canvasRef.current.getContext("2d").drawImage(Q(r),0,0,t,n)},a.canvasRef=r.createRef(),a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.canvasRef.current&&(this.drawFunctions=Ot(this.canvasRef.current),this.draw())}},{key:"componentDidUpdate",value:function(){this.drawFunctions.reset(),this.draw()}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.height;return r.createElement("canvas",{className:"canvas-by-draw-function",width:t,height:n,ref:this.canvasRef})}}]),n}(r.PureComponent),_n=(n(243),n(244),n(245),function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return r.createElement("div",{className:"color-value",style:{backgroundColor:this.props.color}})}}]),n}(r.PureComponent)),Xn=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props.color;return r.createElement("div",{className:"color"},r.createElement(_n,{color:e}))}}]),n}(r.PureComponent);!function(e){e.CHANGE="color/change"}(Ln||(Ln={}));var Hn,Yn=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.color,n=e.changeColor;return r.createElement(Xn,{color:t,onChange:n})}}]),n}(r.PureComponent),Un={changeColor:function(e){return{type:Ln.CHANGE,color:e}}},Bn=Object(m.b)((function(e){return{color:e.color.value}}),Un)(Yn),zn=[1,200],Gn=Ke(.2),Wn=[0,5],qn=Ke(200),Zn=[0,1],Kn=Ke(100),Jn=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleSizeChange=function(t){var n=t.value;e.props.setBrushParams(Object(b.a)({},e.props.paramsValue,{size:n}))},e.handlePatternChange=function(t){return function(){e.props.setBrushParams(Object(b.a)({},e.props.paramsValue,{pattern:+t}))}},e.handleCompositeChange=function(t){var n=t.value;e.props.setBrushParams(Object(b.a)({},e.props.paramsValue,{compositeOperation:n}))},e.handleOpacityChange=function(t){var n=t.value;e.props.setBrushParams(Object(b.a)({},e.props.paramsValue,{opacity:n}))},e.handleTypeChange=function(t){var n=t.value;e.props.setBrushParams(Object(b.a)({},e.props.paramsValue,{type:n}))},e.handleParamChange=function(t){var n=t.value,a=t.name;e.props.setBrushParams(Object(b.a)({},e.props.paramsValue,Object(g.a)({},a,n)))},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.paramsConfigMap,a=t.paramsValue,o=t.patternsSelectItems,i=t.t;return console.log(n.type.props.items),r.createElement("div",{className:"brush-tool"},r.createElement(tt,{value:a.type,getText:function(e){return i("brushTypes.".concat(e.text.toLowerCase()))},items:n.type.props.items,onChange:this.handleTypeChange}),r.createElement("div",{className:"brush-params"},a.type===ce.Pattern?r.createElement(ht,{path:"brush.params.patternSize",value:a.patternSize,name:"patternSize",onChange:this.handleParamChange,range:Wn,valueD:qn}):r.createElement(ht,{path:"brush.params.size",value:a.size,name:"size",onChange:this.handleSizeChange,range:zn,valueD:Gn}),r.createElement(ht,{path:"brush.params.opacity",value:a.opacity,name:"opacity",onChange:this.handleOpacityChange,range:Zn,valueD:Kn}),r.createElement(nt,{value:a.compositeOperation,items:n.compositeOperation.props.items,onChange:this.handleCompositeChange})),r.createElement("div",{className:"pattern-list"},a.type===ce.Pattern&&r.createElement(r.Fragment,null,o.map((function(t,n){var o=t.imageData,i=t.id,c=o.width,s=o.height;return r.createElement(r.Fragment,null,r.createElement(Ue,{className:"pattern-select-button",width:42,height:42,onClick:e.handlePatternChange(i),selected:+i===a.pattern},r.createElement(Vn,{width:40*(c/s<=1?c/s:1),height:40*(c/s>1?s/c:1),imageData:o})),(n+1)%5?null:r.createElement("br",null))})))),a.type!==ce.Pattern&&r.createElement(Bn,null))}}]),n}(r.PureComponent),$n=Object(ct.a)([function(e){return e.brush.paramsConfig}],(function(e){return e.reduce((function(e,t){return e[t.name]=t,e}),{})})),Qn={setBrushParams:function(e){return{type:Mn.SET_PARAMS,params:e}}},ea=Object(m.b)((function(e){return{paramsConfig:e.brush.paramsConfig,paramsConfigMap:$n(e),paramsValue:e.brush.params,patternsSelectItems:Fn(e)}}),Qn)(Object(y.c)("common")(Jn));!function(e){e.SET_PARAMS="line/set-params"}(Hn||(Hn={}));n(246);var ta,na=[1,200],aa=Ke(.2),ra=[0,1],oa=Ke(100),ia=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleParamChange=function(t){var n=t.value,a=t.name,r=e.props,o=r.setLineParams,i=r.paramsValue;o(Object(b.a)({},i,Object(g.a)({},a,n)))},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.paramsConfigMap,n=(e.paramsConfig,e.paramsValue),a=e.patternsSelectItems,o=e.t;return r.createElement("div",{className:"line-tool"},r.createElement(tt,{br:3,value:n.type,name:"type",getText:function(e){return o("lineTypes.".concat(e.text.toLowerCase()))},items:t.type.props.items,onChange:this.handleParamChange}),r.createElement("div",{className:"line-params"},r.createElement(ht,{path:"line.params.size",value:n.size,name:"size",onChange:this.handleParamChange,range:na,valueD:aa}),r.createElement(ht,{path:"line.params.opacity",value:n.opacity,name:"opacity",onChange:this.handleParamChange,range:ra,valueD:oa}),r.createElement(nt,{name:"compositeOperation",value:n.compositeOperation,items:t.compositeOperation.props.items,onChange:this.handleParamChange})),n.type===le.Pattern&&r.createElement(tt,{name:"pattern",value:n.pattern,onChange:this.handleParamChange,items:a}))}}]),n}(r.PureComponent),ca=Object(ct.a)([function(e){return e.line.paramsConfig}],(function(e){return e.reduce((function(e,t){return e[t.name]=t,e}),{})})),sa={setLineParams:function(e){return{type:Hn.SET_PARAMS,params:e}}},ua=Object(m.b)((function(e){return{paramsConfig:e.line.paramsConfig,paramsConfigMap:ca(e),paramsValue:e.line.params,patternsSelectItems:Fn(e)}}),sa)(Object(y.c)("common")(ia));!function(e){e.SET_PARAMS="select/set-params"}(ta||(ta={}));n(247);var la,pa,ha=Ke(100),ma=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleParamChange=function(t){var n=t.value,a=t.name,r=e.props,o=r.setSelectToolParams,i=r.paramsValue;o(Object(b.a)({},i,Object(g.a)({},a,n)))},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.paramsValue,a=t.paramsConfigMap,o=t.t,i=a.mode,c=a.curveType,s=Object(Ye.a)(a,["mode","curveType"]);return r.createElement("div",{className:"select-tool"},r.createElement(tt,{name:"mode",value:n.mode,getText:function(e){return o("selectTypes.".concat(e.text.toLowerCase()))},items:i.props.items,onChange:this.handleParamChange}),r.createElement("div",{className:"select-tool-params"},n.mode===B.Points&&r.createElement(nt,{name:"curveType",value:n.curveType,items:c.props.items,onChange:this.handleParamChange}),Object.values(s).map((function(t){var a=t.name,o=t.props;return r.createElement(ht,{value:n[a],name:a,path:"selectTool.params.".concat(a),range:o.range,onChange:e.handleParamChange,valueD:ha})}))))}}]),n}(r.PureComponent),fa=Object(ct.a)([function(e){return e.selectTool.paramsConfig}],(function(e){return e.reduce((function(e,t){return e[t.name]=t,e}),{})})),da={setSelectToolParams:function(e){return{type:ta.SET_PARAMS,params:e}}},va=Object(m.b)((function(e){return{paramsConfig:e.selectTool.paramsConfig,paramsValue:e.selectTool.params,paramsConfigMap:fa(e)}}),da)(Object(y.c)("common")(ma)),ga=n(313);!function(e){e.ON="fullscreen/on",e.OFF="fullscreen/off",e.SET="fullscreen/set",e.REVERSE="fullscreen/reverse"}(pa||(pa={}));var ba,ya,Oa=Object(ga.a)((la={},Object(g.a)(la,pa.ON,(function(){return!0})),Object(g.a)(la,pa.OFF,(function(){return!1})),Object(g.a)(la,pa.SET,(function(e,t){return t.value})),Object(g.a)(la,pa.REVERSE,(function(e){return!e})),la),!1),Ca=function(){return{type:pa.REVERSE}},ja=(n(248),ba={},Object(g.a)(ba,O.Brush,{component:ea,type:O.Brush}),Object(g.a)(ba,O.Line,{component:ua,type:O.Line}),Object(g.a)(ba,O.Select,{component:va,type:O.Select}),ba),Ea={setCurrentTool:function(e){return{type:Dn.SET_CURRENT,tool:e}},reverseFullScreen:Ca},xa=Object(m.b)((function(e){return{currentTool:e.tool.current}}),Ea)(Object(y.c)("common")((function(e){var t=e.t,n=(e.i18n,e.currentTool),a=e.setCurrentTool,o=(e.reverseFullScreen,e.className),i=ja[n].component;return r.createElement("div",{className:Y("tools",o)},r.createElement("div",null,Object.keys(ja).map((function(e){return r.createElement(Ue,{key:e,selected:e===n,onClick:function(){return a(ja[e].type)}},t("tools.".concat(e.toLowerCase())))}))),r.createElement(i,null))})));!function(e){e.ADD_CF="change-functions/add",e.REMOVE_CF="change-functions/remove",e.CHANGE_PARAMS="change-functions/change-params"}(ya||(ya={}));n(106);var ka,Sa=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).canvasRef=void 0,a.drawFunctions=void 0,a.draw=function(){var e=a.props,t=e.A,n=e.T,r=e.W,o=e.H,i=e.Tmax,c=e.Amax,s=e.O,u=a.canvasRef.current.getContext("2d");u.strokeStyle="black",u.font="28px",u.textBaseline="hanging",u.fillStyle="black",u.fillText(2*Math.sqrt(i/n),120,Math.sqrt(c/t)*t/c*o/2),u.fillText(t,20,-Math.sqrt(c/t)*t/c*o/2+o/2);for(var l=0;l<=150;l++){var p=l/150,h=p*(2*Math.PI)*i/n,m=p*r,f=Math.sin(h+2*s*Math.PI)*t/c*o/2*-1+o/2;u.lineTo(m,f)}u.stroke()},a.canvasRef=r.createRef(),a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.canvasRef.current&&(this.drawFunctions=Ot(this.canvasRef.current),this.draw())}},{key:"componentDidUpdate",value:function(e,t,n){this.drawFunctions.reset(),this.draw()}},{key:"render",value:function(){var e=this.props,t=e.W,n=void 0===t?120:t,a=e.H,o=void 0===a?100:a;return r.createElement("canvas",{className:"grid-bezier-curve-canvas",width:n,height:o,ref:this.canvasRef})}}]),n}(r.PureComponent),Pa=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleParamChange=function(t){var n=t.value,a=t.name;e.props.onChange(Object(b.a)({},e.props.params,Object(g.a)({},a,n)),e.props.name)},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.params,n=(e.paramsConfig,e.onChange,e.name);return r.createElement("div",{className:"sin-change-function"},r.createElement(ht,{path:"changeFunctions.functions.".concat(n,".params.a"),value:t.a,name:"a",range:[1e-4,1],valueD:Ke(100),onChange:this.handleParamChange}),r.createElement(ht,{path:"changeFunctions.functions.".concat(n,".params.t"),value:t.t,name:"t",range:[1,5e3],valueD:Ke(.05),onChange:this.handleParamChange}),r.createElement(ht,{path:"changeFunctions.functions.".concat(n,".params.o"),value:t.o,name:"o",range:[0,1],valueD:Ke(100),onChange:this.handleParamChange}),r.createElement(Sa,{W:68,H:50,O:t.o,Tmax:5e3,Amax:1,A:t.a,T:t.t}))}}]),n}(r.PureComponent),wa=[-3e3,3e3],Ta=Ke(.05),Da=[0,1],Aa=Ke(100),Ia=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleParamChange=function(t){var n=t.value,a=t.name;e.props.onChange(Object(b.a)({},e.props.params,Object(g.a)({},a,n)),e.props.name)},e}return Object(l.a)(n,[{key:"shouldComponentUpdate",value:function(e,t,n){return e.params!==this.props.params}},{key:"render",value:function(){var e=this.props,t=e.params,n=(e.paramsConfig,e.onChange,e.name);return r.createElement("div",{className:"sin-change-function"},r.createElement(ht,{path:"changeFunctions.functions.".concat(n,".params.start"),value:t.start,name:"start",valueD:Aa,range:Da,onChange:this.handleParamChange}),r.createElement(ht,{path:"changeFunctions.functions.".concat(n,".params.end"),value:t.end,name:"end",valueD:Aa,range:Da,onChange:this.handleParamChange}),r.createElement(ht,{path:"changeFunctions.functions.".concat(n,".params.t"),value:t.t,name:"t",valueD:Ta,range:wa,onChange:this.handleParamChange}))}}]),n}(r.PureComponent),Ra=(n(249),function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).canvasRef=void 0,a.drawFunctions=void 0,a.draw=function(){var e=a.canvasRef.current,t=e.getContext("2d");a.props.children({canvas:e,context:t,drawFunctions:a.drawFunctions})},a.canvasRef=r.createRef(),a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.canvasRef.current&&(this.drawFunctions=Ot(this.canvasRef.current),this.draw())}},{key:"componentDidUpdate",value:function(){this.drawFunctions.reset(),this.draw()}},{key:"render",value:function(){var e=this.props,t=e.width,n=void 0===t?120:t,a=e.height,o=void 0===a?100:a;return r.createElement("canvas",{className:"canvas-by-draw-function",width:n,height:o,ref:this.canvasRef})}}]),n}(r.Component)),Na=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).draw=function(t){for(var n=t.context,a=e.props,r=a.width,o=a.height,i=e.props.params,c=i.zd,s=(i.end,i.x),u=i.y,l=(i.xa,i.ya,n.getImageData(0,0,r,o)),p=en(.5,.5,s,u),h=0;h<l.data.length;h+=4){var m=p(h/4%r/r*1,Math.floor(h/4/r)/o*1)+c,f=qe.hsl(Math.max(Math.min(350-100*m,350),250),50,50).rgb().array();l.data[h]=f[0],l.data[h+1]=f[1],l.data[h+2]=f[2],l.data[h+3]=255}n.putImageData(l,0,0)},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.width,n=e.height;return r.createElement(Ra,{width:t,height:n},this.draw)}}]),n}(r.PureComponent),Ma=[0,1],La=Ke(100),Fa=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleParamChange=function(t){var n=t.value,a=t.name;e.props.onChange(Object(b.a)({},e.props.params,Object(g.a)({},a,n)),e.props.name)},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.params,n=(e.paramsConfig,e.onChange,e.name);return r.createElement("div",{className:"XY_PARABOLOID-change-function"},r.createElement(ht,{path:"changeFunctions.functions.".concat(n,".params.zd"),value:t.zd,name:"zd",range:[-2,2],valueD:Ke(20),onChange:this.handleParamChange}),r.createElement(ht,{path:"changeFunctions.functions.".concat(n,".params.x"),value:t.x,name:"x",range:[-20,20],precision:200,valueD:Ke(2),onChange:this.handleParamChange}),r.createElement(ht,{path:"changeFunctions.functions.".concat(n,".params.y"),value:t.y,name:"y",range:[-20,20],precision:200,valueD:Ke(2),onChange:this.handleParamChange}),r.createElement(Na,{type:Re.XY_PARABOLOID,params:t,width:68,height:68}),r.createElement(ht,{path:"changeFunctions.functions.".concat(n,".params.end"),value:t.end,name:"end",valueD:La,range:Ma,onChange:this.handleParamChange}))}}]),n}(r.PureComponent),Va=(ka={},Object(g.a)(ka,Re.SIN,Pa),Object(g.a)(ka,Re.LOOP,Ia),Object(g.a)(ka,Re.XY_PARABOLOID,Fa),ka),_a=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleChange=function(t,n){e.props.changeCFParams(n,t)},e.handleDelete=function(t){var n=t.value;e.props.removeCF(n)},e.handleAddSin=function(){e.props.addCF(Re.SIN)},e.handleAddLoop=function(){e.props.addCF(Re.LOOP)},e.handleAddXY=function(){e.props.addCF(Re.XY_PARABOLOID)},e.handleModeChange=function(t){var n=t.value;e.props.setChangingMode(n)},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.cfs;t.changingMode;return r.createElement("div",{className:"change-functions"},r.createElement("div",{className:"control-buttons"},r.createElement(f.a,{onClick:this.handleAddSin},"sin"),r.createElement(f.a,{onClick:this.handleAddLoop},"loop"),r.createElement(f.a,{onClick:this.handleAddXY},"parab")),r.createElement("div",{className:"functions-list"},Object.values(n).reverse().map((function(t){var n=t.type,a=t.id,o=t.params,i=t.paramsConfig,c=Va[n];return c?r.createElement("div",{className:"function-container",key:a},r.createElement(c,{key:a,name:a,params:o,paramsConfig:i,onChange:e.handleChange}),r.createElement("div",{className:"function-controls"},r.createElement(f.a,{value:a,onClick:e.handleDelete,className:"function-delete"},"del"))):null}))))}}]),n}(r.PureComponent),Xa={changeCFParams:function(e,t){return{type:ya.CHANGE_PARAMS,params:t,id:e}},addCF:function(e){return{type:ya.ADD_CF,cfType:e}},startChanging:ke,stopChanging:Se,setChangingMode:function(e){return function(t,n){var a=n().changing.mode;if(a!==e)return e===de.OnDraw?a===de.On&&(t(ge()),t(Se())):e===de.On?t(ke()):e===de.Off&&a===de.On&&(t(ge()),t(Se())),t({type:be.SET_MODE,mode:e})}},removeCF:function(e){return{type:ya.REMOVE_CF,name:e}}},Ha=Object(m.b)((function(e){return{cfs:st(e),changingMode:e.changing.mode}}),Xa)(_a),Ya=n(126),Ua=n.n(Ya),Ba=n(76),za=n(127),Ga=n(128),Wa=localStorage.getItem("lang");Ba.a.use(y.a).init({interpolation:{escapeValue:!1},lng:Wa||"en",resources:{en:{common:za},ru:{common:Ga}}});var qa,Za=Ba.a;!function(e){e.SET="language/set"}(qa||(qa={}));var Ka=Object(ga.a)(Object(g.a)({},qa.SET,(function(e,t){return t.value})),Za.language),Ja=["en","ru"],$a=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleLanguage=function(){var t=e.props,n=t.setLanguage,a=t.language,r=t.i18n,o=Ja[(Ja.indexOf(a)+1)%Ja.length];n(o),r.changeLanguage(o)},e}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props,t=e.reverseFullScreen,n=e.isFull,a=(e.setLanguage,e.language);return r.createElement("div",{className:"app-controls"},r.createElement(f.a,{className:"app-control-button",onClick:this.handleLanguage},a),r.createElement(f.a,{className:"app-control-button",onClick:t},"?"),r.createElement(f.a,{className:Y("app-control-button","full-button",Object(g.a)({},"full-button-off",n)),onClick:t},r.createElement("div",{className:"tl"}),r.createElement("div",{className:"br"})))}}]),n}(r.PureComponent),Qa={reverseFullScreen:Ca,setLanguage:function(e){return function(t){localStorage.setItem("lang",e),t({type:qa.SET,value:e})}}},er=Object(m.b)((function(e){return{isFull:e.fullScreen,language:e.language}}),Qa)(Object(y.c)()($a)),tr=Object(m.b)((function(e){return{full:e.fullScreen}}),{setFullScreen:function(e){return{type:pa.SET,value:e}}})((function(e){var t=e.full,n=e.setFullScreen;return r.createElement(Ua.a,{enabled:t,onChange:n},r.createElement("div",{className:"layout-container"},r.createElement("div",{className:"layout"},r.createElement("div",{className:"tools-panel"},r.createElement(xa,null),r.createElement(Ha,null)),r.createElement("div",{className:"windows"},r.createElement(Nn,null)),r.createElement(er,null))))})),nr=function(e){return Object(s.a)(e),r.createElement(tr,null)},ar=n(29),rr=n(129),or=n.n(rr),ir=n(130),cr=n(131);function sr(e,t){return{imageData:document.createElement("canvas").getContext("2d").createImageData(e,t),width:e,height:t}}function ur(e,t,n){return{imageData:e,width:t||e.width,height:n||e.height}}var lr,pr,hr,mr,fr,dr,vr=n(48),gr=Sn({before:[],after:[]},{length:23}),br=function(e,t){var n=e.value.before,a=e.params.length,r=[].concat(Object(D.a)(n),[t]);return r.length>a&&r.shift(),Object(b.a)({},e,{value:{before:r,after:[]}})},yr=Sn(null,{}),Or=function(e,t,n){return Sn(n?ur(n):sr(e,t),{opacity:1,black:!0})},Cr=Sn({angle:0,offset:{x:0,y:0}},{}),jr=Sn({},{type:re.Grid,gridParams:{x:2,y:2,xOut:1,yOut:1,bezierPoints:[{x:0,y:0},{x:50,y:50},{x:50,y:50},{x:100,y:100}],integer:!0}}),Er=Sn({},{fit:!1}),xr=Sn({},{on:!1,changeFunctionId:null}),kr=(lr={},Object(g.a)(lr,xt.EDIT_CONFIG,It((function(e,t){return function(e,t,n){var a=t||{},r=a.history,o=a.store,i=a.selection,c=a.mask,s=a.rotation,u=a.repeating;n=n||{};var l=Or(e.current.width,e.current.height)(c,e.mask,n.mask);return{config:t,id:e.id,current:e.current,resultImage:l?ne(e.current.imageData,l.value.imageData):ne(e.current.imageData),history:gr(r,e.history,n.history),store:yr(o,e.store,n.store),selection:Pn(i,e.selection,n.selection),mask:l,rotation:Cr(s,e.rotation,n.rotation),repeating:jr(u,e.repeating,n.repeating),import:Er(!0,e.import,n.import),video:xr(!0,e.video,n.video)}}(e,t.config)}))),Object(g.a)(lr,xt.UPDATE_IMAGE,It((function(e,t){return Object(b.a)({},e,{current:Object(b.a)({},e.current,{imageData:t.imageData,width:t.imageData.width,height:t.imageData.height}),resultImage:ne(t.imageData,e.mask&&e.mask.value.imageData),history:e.history&&br(e.history,{current:e.current})})}))),Object(g.a)(lr,xt.SET_WIDTH,It((function(e,t){var n=ee(e.current.imageData,t.width,e.current.height,!e.import.params.fit),a=e.mask&&ee(e.mask.value.imageData,t.width,e.mask.value.height,!e.import.params.fit);return Object(b.a)({},e,{current:Object(b.a)({},e.current,{width:t.width,imageData:n}),mask:e.mask&&Object(b.a)({},e.mask,{value:Object(b.a)({},e.mask.value,{width:t.width,imageData:a})}),history:e.history&&br(e.history,{current:e.current,maskValue:e.mask&&e.mask.value}),resultImage:ne(n,a)})}))),Object(g.a)(lr,xt.SET_HEIGHT,It((function(e,t){var n=ee(e.current.imageData,e.current.width,t.height,!e.import.params.fit),a=e.mask&&ee(e.mask.value.imageData,e.mask.value.width,t.height,!e.import.params.fit);return Object(b.a)({},e,{current:Object(b.a)({},e.current,{height:t.height,imageData:n}),mask:e.mask&&Object(b.a)({},e.mask,{value:Object(b.a)({},e.mask.value,{height:t.height,imageData:a})}),history:e.history&&br(e.history,{current:e.current,maskValue:e.mask&&e.mask.value}),resultImage:ne(n,a)})}))),lr),Sr=(pr={},Object(g.a)(pr,d.UNDO,It((function(e){var t=function(e,t){var n=e.value,a=n.before,r=n.after;if(0===a.length)return null;var o=a[a.length-1],i=a.slice(0,a.length-1),c=[t].concat(Object(D.a)(r));return{history:Object(b.a)({},e,{value:{before:i,after:c}}),prev:o}}(e.history,{current:e.current,maskValue:e.mask&&e.mask.value});if(!t)return e;var n=t.prev.current||e.current,a=e.mask&&Object(b.a)({},e.mask,{value:t.prev.maskValue||e.mask.value});return Object(b.a)({},e,{history:t.history,current:n,resultImage:ne(n.imageData,a&&a.value.imageData),mask:a})}))),Object(g.a)(pr,d.REDO,It((function(e){var t=function(e,t){var n=e.value,a=n.before,r=n.after;if(0===r.length)return null;var o=r[0],i=[].concat(Object(D.a)(a),[t]),c=r.slice(1,r.length);return{history:Object(b.a)({},e,{value:{before:i,after:c}}),next:o}}(e.history,{current:e.current,maskValue:e.mask&&e.mask.value});if(!t)return e;var n=t.next.current||e.current,a=e.mask&&Object(b.a)({},e.mask,{value:t.next.maskValue||e.mask.value});return Object(b.a)({},e,{history:t.history,current:n,resultImage:ne(n.imageData,a&&a.value.imageData),mask:a})}))),pr),Pr=(hr={},Object(g.a)(hr,sn.SET_MASK_PARAMS,It((function(e,t){return Object(b.a)({},e,{mask:e.mask&&Object(b.a)({},e.mask,{params:Object(b.a)({},e.mask.params,{},t.params)})})}))),Object(g.a)(hr,sn.UPDATE_MASK,It((function(e,t){return Object(b.a)({},e,{mask:Object(b.a)({},e.mask,{value:Object(b.a)({},e.mask.value,{imageData:t.imageData})}),resultImage:ne(e.current.imageData,t.imageData),history:e.history&&br(e.history,{maskValue:e.mask.value})})}))),hr),wr=Object(g.a)({},mn.SET_IMPORT_PARAMS,It((function(e,t){return Object(b.a)({},e,{import:Object(b.a)({},e.import,{params:Object(b.a)({},e.import.params,{},t.value)})})}))),Tr=Object(g.a)({},Ct.SET_REPEATING,It((function(e,t){return Object(b.a)({},e,{repeating:e.repeating&&Object(b.a)({},e.repeating,{params:t.repeating})})}))),Dr=Object(g.a)({},at.SET_ROTATION,It((function(e,t){return Object(b.a)({},e,{rotation:e.rotation&&Object(b.a)({},e.rotation,{value:t.rotation})})}))),Ar=Object(g.a)({},gn.UPDATE_SELECTION,It((function(e,t){return Object(b.a)({},e,{selection:Object(b.a)({},e.selection,{value:{segments:t.value,mask:t.value.length?wn(e.current.width,e.current.height,t.value):null,bBox:t.bBox}})})}))),Ir=Object(g.a)({},Kt.SET_VIDEO_PARAMS,It((function(e,t){return Object(b.a)({},e,{video:Object(b.a)({},e.video,{params:Object(b.a)({},e.video.params,{},t.value)})})}))),Rr=Object(g.a)({},dn.CREATE_ROOM,It((function(e,t){return Object(b.a)({},e,{room:Object(b.a)({},e.room,{value:{connected:t.roomName,socket:t.socket}})})}))),Nr=Object(ga.a)(Object(b.a)((mr={},Object(g.a)(mr,a.ADD_PATTERN,(function(e,t){var n=function(e){return(Object.keys(e).length?Math.max.apply(Math,Object(D.a)(Object.keys(e).map((function(e){return+e}))))+1:1).toString()}(e);return Object(b.a)({},e,Object(g.a)({},n,function(e,t,n){var a=t||{},r=a.history,o=a.store,i=a.selection,c=a.mask,s=a.rotation,u=a.repeating,l=a.startImage,p=a.startMask,h=l?l.width:t.width||300,m=l?l.height:t.height||300,f=l?ur(l):sr(h,m);return{id:e,config:t,resultImage:p?ne(f.imageData,p):Q(f.imageData),current:f,history:gr(r,void 0,(n||{}).history),store:yr(o,void 0,(n||{}).store),selection:Pn(i,void 0,(n||{}).selection),mask:Or(h,m,p)(c,void 0,(n||{}).mask),rotation:Cr(s,void 0,(n||{}).rotation),repeating:jr(u,void 0,(n||{}).repeating),import:Er(!0,void 0,(n||{}).import),video:xr(!0,void 0,(n||{}).video)}}(n,t.config,t.params)))})),Object(g.a)(mr,a.REMOVE_PATTERN,(function(e,t){return function(e,t){return Object(vr.omit)(e,t)}(e,t.id)})),mr),kr,{},Sr,{},Pr,{},Ar,{},wr,{},Tr,{},Dr,{},Ir,{},{},{},Rr),{}),Mr=Object(ga.a)(Object(g.a)({},Dn.SET_CURRENT,(function(e,t){return Object(b.a)({},e,{current:t.tool})})),{current:O.Brush}),Lr=L(Object.values(ce)),Fr=L(Object.values(se)),Vr=[1,200],_r=Ke(.5),Xr=[0,1],Hr=[0,5],Yr=Ke(200),Ur=function(e){return[{name:"size",type:Lt.Number,props:{range:Vr,valueD:_r}},{name:"opacity",type:Lt.Number,props:{range:Xr}},{name:"type",type:Lt.Select,props:{items:Lr}},{name:"compositeOperation",type:Lt.Select,props:{items:Fr}},{name:"patternSize",type:Lt.Number,props:{range:Hr,valueD:Yr}}]},Br=Object(ga.a)(Object(g.a)({},Mn.SET_PARAMS,(function(e,t){var n=Object(b.a)({},e.params,{},t.params);return{paramsConfig:Ur(),params:n}})),{params:{patternSize:1,size:43,opacity:1,type:ce.Circle},paramsConfig:Ur()}),zr=L(Object.values(le)),Gr=L(Object.values(pe)),Wr=[1,200],qr=Ke(.5),Zr=[0,1],Kr=function(e){return[{name:"size",type:Lt.Number,props:{range:Wr,valueD:qr}},{name:"opacity",type:Lt.Number,props:{range:Zr}},{name:"type",type:Lt.Select,props:{items:zr}},{name:"compositeOperation",type:Lt.Select,props:{items:Gr}}]},Jr=Object(ga.a)(Object(g.a)({},Hn.SET_PARAMS,(function(e,t){var n=Object(b.a)({},e.params,{},t.params);return{paramsConfig:Kr(),params:n}})),{params:{size:5,opacity:1,type:le.Default},paramsConfig:Kr()}),$r=function(e){var t=[{name:"mode",type:Lt.Select,props:{items:W}}];return e&&e.mode===B.Points&&(t.push({name:"curveType",type:Lt.Select,props:{items:q}}),-1!==Object.keys(z).indexOf(e.curveType)&&(t=[].concat(Object(D.a)(t),[{name:z[e.curveType],type:Lt.Number,props:{range:[0,1],text:1}}]))),t},Qr=Object(ga.a)(Object(g.a)({},ta.SET_PARAMS,(function(e,t){var n=Object(b.a)({},e.params,{},t.params);return{paramsConfig:$r(n),params:n}})),{params:(fr={mode:B.Rect,curveType:V.CurveLinear},Object(g.a)(fr,z[V.CurveBundle],0),Object(g.a)(fr,z[V.CurveCardinal],1),Object(g.a)(fr,z[V.CurveCatmullRom],1),fr),paramsConfig:$r()});!function(e){e.UPDATE_ROOMS="rooms/update",e.CONNECT_ROOMS="rooms/connect"}(dr||(dr={}));var eo,to,no,ao,ro=Object(ga.a)(Object(g.a)({},dr.UPDATE_ROOMS,(function(e,t){return{rooms:t.rooms}})),{rooms:[]}),oo=Object(ga.a)((eo={},Object(g.a)(eo,ya.ADD_CF,(function(e,t){var n=function(e,t){return e.toString()+(Object.keys(t).length?Math.max.apply(Math,[0].concat(Object(D.a)(Object.keys(t).filter((function(n){return t[n].type===e})).map((function(e){return function(e,t){return+e.slice(t.toString().length)}(e,t[e].type)})))))+1:1)}(t.cfType,e.functions);return{functions:Object(b.a)({},e.functions,Object(g.a)({},n,rn(n,t.cfType))),namesList:[].concat(Object(D.a)(Object.keys(e.functions)),[n])}})),Object(g.a)(eo,ya.REMOVE_CF,(function(e,t){var n=Object(vr.omit)(e.functions,t.name);return{functions:n,namesList:Object.keys(n)}})),Object(g.a)(eo,ya.CHANGE_PARAMS,(function(e,t){return Object(b.a)({},e,{functions:Object(b.a)({},e.functions,Object(g.a)({},t.id,Object(b.a)({},e.functions[t.id],{params:t.params})))})})),eo),{functions:{},namesList:[]}),io=n(74),co=n.n(io),so=Object(ga.a)((to={},Object(g.a)(to,We.SET_VALUE_IN_CHANGING_LIST,(function(e,t){return e[t.path]?t.changeFunctionId?Object(b.a)({},e,Object(g.a)({},t.path,Object(b.a)({},e[t.path],{path:t.path,changeFunctionId:t.changeFunctionId,range:t.range}))):co()(e,t.path):t.changeFunctionId?Object(b.a)({},e,Object(g.a)({},t.path,{active:!0,path:t.path,changeFunctionId:t.changeFunctionId,range:t.range,startValue:t.startValue})):e})),Object(g.a)(to,We.SET_START_VALUE,(function(e,t){return e[t.path]?Object(b.a)({},e,Object(g.a)({},t.path,Object(b.a)({},e[t.path],{startValue:t.startValue}))):e})),Object(g.a)(to,We.ACTIVATE_VALUE_CHANGING,(function(e,t){return Object(b.a)({},e,Object(g.a)({},t.path,Object(b.a)({},e[t.path],{active:!0})))})),Object(g.a)(to,We.DEACTIVATE_VALUE_CHANGING,(function(e,t){return Object(b.a)({},e,Object(g.a)({},t.path,Object(b.a)({},e[t.path],{active:!1})))})),Object(g.a)(to,ya.REMOVE_CF,(function(e,t){var n=Object.values(e).filter((function(e){return e.changeFunctionId===t.name})).map((function(e){return e.path}));return co.a.apply(void 0,[e].concat(Object(D.a)(n)))})),to),{}),uo=Object(ga.a)((no={},Object(g.a)(no,be.START,(function(e){return Object(b.a)({},e,{isChanging:!0})})),Object(g.a)(no,be.STOP,(function(e){return Object(b.a)({},e,{isChanging:!1})})),Object(g.a)(no,be.SET_MODE,(function(e,t){return Object(b.a)({},e,{mode:t.mode})})),no),{isChanging:!1,mode:de.OnDraw}),lo=Object(ga.a)(Object(g.a)({},Ln.CHANGE,(function(e,t){return Object(b.a)({},e,{value:t.color})})),{value:"#000000"}),po=n(49),ho=Object(ga.a)((ao={},Object(g.a)(ao,he.CHANGE,(function(e,t){var n=e.changeFunctions.functions,a=e.changingValues,r=e.patterns;return Object.values(a).reduce((function(e,a){var o=a.active,i=a.path,c=a.range,s=a.changeFunctionId,u=a.startValue,l=r[t.position.patternId];if(!o)return e;var p=n[s],h=(0,on[p.type])({params:p.params,range:c,pattern:l})({startValue:u,time:t.time,position:t.position});return h=Math.min(Math.max(h,c[0]),c[1]),e.set(i,h)}),po.a(e)).value()})),Object(g.a)(ao,he.TO_START_VALUE,(function(e,t){var n=t.path,a=e.changingValues;return a[n]?po.a(e).set(n,a[n].startValue).value():e})),Object(g.a)(ao,he.ALL_TO_START_VALUE,(function(e){var t=e.changingValues;return Object.values(t).reduce((function(e,t){t.active;var n=t.path,a=(t.range,t.changeFunctionId,t.startValue);return e.set(n,a)}),po.a(e)).value()})),ao),{}),mo=Object(cr.a)(Object(ar.c)({fullScreen:Oa,language:Ka,patterns:Nr,color:lo,tool:Mr,brush:Br,line:Jr,selectTool:Qr,rooms:ro,changeFunctions:oo,changingValues:so,changing:uo}),ho),fo=Object(ar.d)(mo,Object(ar.a)(ir.a,or.a)),vo=function(){return o.a.createElement(m.a,{store:fo},o.a.createElement(nr,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(311);c.a.render(o.a.createElement(vo,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[133,1,2]]]);
//# sourceMappingURL=main.34612083.chunk.js.map