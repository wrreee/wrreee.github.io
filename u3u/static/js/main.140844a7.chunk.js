(this.webpackJsonpzd2=this.webpackJsonpzd2||[]).push([[0],{108:function(e,t,n){e.exports=n(256)},113:function(e,t,n){},114:function(e,t,n){},115:function(e,t,n){},122:function(e,t,n){},150:function(e,t){},153:function(e,t,n){},154:function(e,t,n){},155:function(e,t,n){},185:function(e,t,n){},186:function(e,t,n){},189:function(e,t,n){},190:function(e,t,n){},191:function(e,t,n){},192:function(e,t,n){},193:function(e,t,n){},256:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(37),c=n.n(o),i=(n(113),n(114),n(99)),s=(n(115),n(2)),u=n(3),l=n(5),p=n(4),h=n(6),f=n(7),m=n(8),g=n.n(m),v=(n(122),function(e){var t=e.children,n=e.onClick,r=e.onMouseDown,o=e.onMouseUp,c=e.disabled,i=e.width,s=e.className,u=e.value,l=e.name;return a.createElement("button",{className:m("button",s),onClick:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return n&&n({e:e,value:u,name:l})})),onMouseUp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return o&&o({e:e,value:u,name:l})})),onMouseDown:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return r&&r({e:e,value:u,name:l})})),style:{width:i},disabled:c},t)}),d=n(38),O=function(e){return e.getContext("2d").getImageData(0,0,e.width,e.height)};function b(e){var t=document.createElement("canvas"),n=t.getContext("2d");return n?(t.width=e.width,t.height=e.height,n.putImageData(e,0,0),t):null}var y,j,C=function(e,t,n){var a=b(e),r=document.createElement("canvas");return r.width=t,r.height=n,r.getContext("2d").drawImage(a,0,0,t,n),O(r)},P=function(e){var t=document.createElement("canvas"),n=t.getContext("2d");return n?(t.width=e.width,t.height=e.height,n.putImageData(e,0,0),t.toDataURL()):null},E=function(e,t){var n=document.createElement("canvas"),a=n.getContext("2d");return a?(n.width=e.width,n.height=e.height,t&&(a.putImageData(t,0,0),a.globalCompositeOperation="source-in"),a.drawImage(b(e),0,0,e.width,e.height),n):null};!function(e){e.ADD_PATTERN="patterns/add",e.REMOVE_PATTERN="patterns/remove"}(y||(y={})),function(e){e.UPDATE_IMAGE="pattern/update-image",e.UPDATE_MASK="pattern/update-mask",e.UPDATE_SELECTION="pattern/update-selection",e.SET_MASK_PARAMS="pattern/set-mask-params",e.EDIT_CONFIG="pattern/edit-config",e.UNDO="pattern/undo",e.REDO="pattern/redo",e.STORE_IMAGE="pattern/store-image",e.UNSTORE_IMAGE="pattern/unstore-image",e.SET_WIDTH="pattern/set-width",e.SET_HEIGHT="pattern/set-height",e.SET_SELECTION_PARAMS="pattern/set-selection-params",e.CREATE_ROOM="pattern/create-room"}(j||(j={}));var S,w=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(a,r){var o=r().patterns[e].socket;return n&&o&&o.emit("image",P(t)),a({type:j.UPDATE_IMAGE,imageData:t,id:e})}},k=n(1),D=(n(153),function(e){var t=e.onUndo,n=e.onRedo,r=e.history;return a.createElement(a.Fragment,null,a.createElement(v,{onClick:t,disabled:!r.before.length,width:70},"undo",r.before.length?"(".concat(r.before.length,")"):""),a.createElement(v,{onClick:n,disabled:!r.after.length,width:70},"redo",r.after.length?"(".concat(r.after.length,")"):""))});!function(e){e.Brush="Brush",e.Select="Select",e.Line="Line"}(S||(S={}));var A,T,R,M=[S.Select],N=function(e,t,n,a){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-a,2))},V=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).elementRef=void 0,n.pre=void 0,n.mouseDownHandler=function(e){n.setState({dragging:!0});var t=n.props.onDown;t&&t(e)},n.mouseUpHandler=function(e){if(n.state.dragging){n.setState({dragging:!1}),n.pre=null;var t=n.props.onUp;t&&t(e)}},n.mouseMoveHandler=function(e){var t=n.props,a=t.onDrag,r=t.onMove;n.state.dragging&&a&&a(e,n.pre),r&&r(e,n.pre),n.pre=e},n.state={dragging:!1},n.elementRef=r.a.createRef(),n.pre=null,n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.elementRef.current.addEventListener("mousedown",this.mouseDownHandler),document.addEventListener("mouseup",this.mouseUpHandler),this.elementRef.current.addEventListener("mousemove",this.mouseMoveHandler)}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.width,a=e.height,o=e.className,c=e.style;return r.a.createElement("svg",{ref:this.elementRef,width:n,height:a,className:o,style:c},t)}}]),t}(r.a.PureComponent),I=n(61),x=n(9),_=n(26);!function(e){e.M="M",e.L="L",e.Z="Z"}(T||(T={})),function(e){e.M="M",e.L="L",e.Z="Z",e.Rect="Rect",e.Slice="Slice"}(R||(R={}));var L=(A={},Object(k.a)(A,R.M,(function(e,t){var n=Object(_.a)(t,2),a=n[0],r=n[1];return[].concat(Object(x.a)(e),[{type:T.M,values:[a,r]}])})),Object(k.a)(A,R.L,(function(e,t){var n=Object(_.a)(t,2),a=n[0],r=n[1];return[].concat(Object(x.a)(e),[{type:T.L,values:[a,r]}])})),Object(k.a)(A,R.Z,(function(e){return[].concat(Object(x.a)(e),[{type:T.Z}])})),Object(k.a)(A,R.Rect,(function(e,t){var n=Object(_.a)(t,4),a=n[0],r=n[1],o=n[2],c=n[3],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=F(e,i),u=s.sliceStart,l=s.sliceEnd;return[].concat(Object(x.a)(e.slice(0,u)),[{type:T.M,values:[a,r]},{type:T.L,values:[o,r]},{type:T.L,values:[o,c]},{type:T.L,values:[a,c]},{type:T.Z}],Object(x.a)(e.slice(l+1)))})),Object(k.a)(A,R.Slice,(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=F(e,n),r=a.sliceStart,o=a.sliceEnd;return[].concat(Object(x.a)(e.slice(0,r)),Object(x.a)(t),Object(x.a)(e.slice(o+1)))})),A),F=function(e,t){for(var n,a,r=0,o=0;o<e.length;o++)if(e[o].type===T.M){if(r===t){n=o;for(var c=o;c<e.length;c++)if(e[c].type===T.Z){a=c;break}break}r++}return{sliceStart:"undefined"===typeof n?e.length:n,sliceEnd:"undefined"===typeof a?e.length:a}},U=function(e){var t;for(t=e.length-1;t>=0&&e[t].type!==T.M;t--);return e.slice(t)},X=function(e,t,n){if(e&&e.length){var a,r,o=e.slice(1).reduce((function(e,a,r){if(r++,!a.values)return e;var o=N(t,n,a.values[0],a.values[1]);return o<e.distance?{distance:o,segment:a,index:r}:e}),{sliceStart:0,sliceEnd:0,startInSlice:0,index:0,segment:e[0],distance:N(t,n,e[0].values[0],e[0].values[1])});o.sliceN=-1;for(var c=0;c<e.length;c++)e[c].type===T.M&&c<=o.index&&(a=c,o.sliceN+=1),e[c].type===T.Z&&c>o.index&&!r&&(r=c);return o.sliceStart=a,o.sliceEnd=r,o.startInSlice=a?o.index%a:o.index,o.slice=e.slice(o.sliceStart,o.sliceEnd+1),o}},Y=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",e),t.getPathData()};var H,B,G=function(e,t){return t},z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G,a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,o=Object.keys(e).map((function(a){return{value:t(e[a],a),text:n(e[a],a)}}));return a?[{value:null,text:r||"-"}].concat(Object(x.a)(o)):o},W=function(e){return e},Z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W;return e.map((function(e){return{value:t(e),text:n(e)}}))};!function(e){e.CurveBasis="curveBasis",e.CurveBundle="curveBundle",e.CurveCardinal="curveCardinal",e.CurveCatmullRom="curveCatmullRom",e.CurveLinear="curveLinear",e.CurveMonotoneX="curveMonotoneX",e.CurveMonotoneY="curveMonotoneY",e.CurveNatural="curveNatural",e.CurveStep="curveStep",e.CurveStepBefore="curveStepBefore",e.CurveStepAfter="curveStepAfter"}(B||(B={}));var q,K=(H={},Object(k.a)(H,B.CurveBundle,"beta"),Object(k.a)(H,B.CurveCardinal,"tension"),Object(k.a)(H,B.CurveCatmullRom,"alpha"),H);!function(e){e.Line="Line",e.Rect="Rect",e.SimplePoints="SimplePoints",e.Points="Points"}(q||(q={}));n(154);var J,$,Q=I.line().x((function(e){var t=e.values;return t?t[0]:0})).y((function(e){var t=e.values;return t?t[1]:0})).defined((function(e){return!!e.values})),ee=5,te=Z([q.Rect,q.Line,q.Points]),ne=Z(Object.values(B)),ae=function(e){function t(e){var n,r;return Object(s.a)(this,t),(r=Object(l.a)(this,Object(p.a)(t).call(this,e))).canvasRef=void 0,r.pathRef=void 0,r.pathPointsRef=void 0,r.maskPathRef=void 0,r.maskRef=void 0,r.commitChanges=function(){var e=r.props.onChange;e&&e(r.state.path)},r.selectToolHandlers=(n={},Object(k.a)(n,q.Rect,{down:function(e){var t=r.state.path;if(t.length){var n=X(t,e.offsetX,e.offsetY);if(n&&n.distance<2*ee){if(5!==n.slice.length)return r.setState((function(t){return{startX:e.offsetX,startY:e.offsetY,offsetX:0,offsetY:0,currentSliceN:n.sliceN,path:L[R.Rect](t.path,[e.offsetX,e.offsetY,e.offsetX,e.offsetY],n.sliceN)}}));var a=(n.startInSlice+2)%4,o=n.slice[a],c=n.segment.values[0]-e.offsetX,i=n.segment.values[1]-e.offsetY,s=o.values[0],u=o.values[1];return r.setState((function(t){return{startX:s,startY:u,offsetX:c,offsetY:i,currentSliceN:n.sliceN,path:L[R.Rect](t.path,[s,u,e.offsetX+c,e.offsetY+i],n.sliceN)}}))}}r.setState((function(t){var n=t.currentSliceN,a=t.path;return{offsetX:0,offsetY:0,startX:e.offsetX,startY:e.offsetY,path:L[R.Rect](a,[e.offsetX,e.offsetY,e.offsetX,e.offsetY],n)}}))},drag:function(e){r.setState((function(t){var n=t.path,a=t.startX,r=t.startY,o=(t.offsetX,t.offsetY,t.currentSliceN);return{path:L[R.Rect](n,[a,r,e.offsetX,e.offsetY],o)}}))},up:function(){r.setState((function(e){return{startX:0,startY:0,offsetX:0,offsetY:0,currentSliceN:e.path.filter((function(e){return e.type===T.M})).length}}),r.commitChanges)},exit:function(e){}}),Object(k.a)(n,q.SimplePoints,{down:function(e){var t=r.state,n=t.path,a=t.curvePath;if(n.length&&n[n.length-1].type!==T.Z){a.length&&r.setState((function(e){var t=e.path,n=e.currentSliceN;return{curvePath:[],path:L[R.Slice](t,a,n)}}));var o=n.filter((function(e){return e.type===T.M})).reverse()[0];N(e.offsetX,e.offsetY,o.values[0],o.values[1])<2*ee?r.setState((function(e){var t=e.path;return{path:L[R.Z](t),currentSliceN:t.filter((function(e){return e.type===T.M})).length}}),r.commitChanges):r.setState((function(t){var n=t.path;return{path:L[R.L](n,[e.offsetX,e.offsetY])}}))}else r.setState((function(t){var n=t.path;return{path:L[R.M](n,[e.offsetX,e.offsetY])}}))},drag:function(){},up:function(){},exit:function(e){var t=r.state.path;t&&t.length&&t[t.length-1].type!==T.Z&&e!==q.Points&&r.setState((function(e){var t=e.path;return{curvePath:[],path:L[R.Z](t),currentSliceN:t.filter((function(e){return e.type===T.M})).length}}),r.commitChanges)}}),Object(k.a)(n,q.Points,{down:function(e){var t=r.state,n=t.path,a=t.curvePath;if(n.length&&n[n.length-1].type!==T.Z){a.length||r.setState((function(e){var t=e.path;return{curvePath:U(t)}}));var o=n.filter((function(e){return e.type===T.M})).reverse()[0];N(e.offsetX,e.offsetY,o.values[0],o.values[1])<2*ee?r.setState((function(e){var t=e.path,n=e.curvePath,a=L[R.L](n,[o.values[0],o.values[1]]);return a=L[R.Z](a),{curvePath:[],path:L[R.Z](r.line(t,a)),currentSliceN:t.filter((function(e){return e.type===T.M})).length}}),r.commitChanges):r.setState((function(t){var n=t.path,a=t.curvePath,o=L[R.L](a,[e.offsetX,e.offsetY]);return{curvePath:o,path:r.line(n,o)}}))}else{var c=L[R.M](r.state.curvePath,[e.offsetX,e.offsetY]);r.setState((function(t){var n=t.path;return{curvePath:c,path:L[R.M](n,[e.offsetX,e.offsetY])}}))}},drag:function(){},up:function(){},exit:function(e){var t=r.state.path;t&&t.length&&t[t.length-1].type!==T.Z&&e!==q.Points&&r.setState((function(e){var t=e.path;return{curvePath:[],path:L[R.Z](t),currentSliceN:t.filter((function(e){return e.type===T.M})).length}}),r.commitChanges)}}),Object(k.a)(n,q.Line,{down:function(e){r.setState((function(t){var n=t.path;return{path:L[R.M](n,[e.offsetX,e.offsetY])}}))},drag:function(e){r.setState((function(t){var n=t.path;return{path:L[R.L](n,[e.offsetX,e.offsetY])}}))},up:function(e){r.setState((function(e){var t=e.path;return{path:L[R.Z](t),currentSliceN:t.filter((function(e){return e.type===T.M})).length}}),r.commitChanges)},exit:function(e){}}),n),r.line=function(e,t){var n=r.props.selectToolParams,a=n.curveType,o=n[K[a]],c=I[a||"curveLinear"];return-1!==Object.keys(K).indexOf(a)&&(c=c[K[a]](o)),L[R.Slice](e,Y(Q.curve(c)(U(t))),r.state.currentSliceN)},r.canvasRef=a.createRef(),r.pathRef=a.createRef(),r.pathPointsRef=a.createRef(),r.maskPathRef=a.createRef(),r.maskRef=a.createRef(),r.state={startX:null,startY:null,offsetX:null,offsetY:null,points:[],closed:!0,path:[],prevPath:null,curvePath:[],currentSliceN:0},r}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.value;Array.isArray(e)&&this.setState({path:e,currentSliceN:e.filter((function(e){return e.type===T.M})).length})}},{key:"componentDidUpdate",value:function(e){e.selectToolParams.mode!==this.props.selectToolParams.mode&&this.selectToolHandlers[e.selectToolParams.mode].exit(this.props.selectToolParams.mode)}},{key:"render",value:function(){console.log("selector render",this.state.path);var e=this.props,t=e.width,n=e.height,r=e.selectToolParams.mode,o=e.isActive,c=e.name;return this.pathRef.current&&this.pathRef.current.setPathData(this.state.path),this.maskPathRef.current&&this.maskPathRef.current.setPathData(this.state.path),a.createElement("div",{className:g()("selection",Object(k.a)({},"selectionActive",o))},a.createElement(V,{width:t,height:n,onDown:this.selectToolHandlers[r].down,onDrag:this.selectToolHandlers[r].drag,onUp:this.selectToolHandlers[r].up},this.state.path&&this.state.path.length&&a.createElement(a.Fragment,null,a.createElement("mask",{id:"selectionMask".concat(c),ref:this.maskRef},a.createElement("rect",{x:"0",y:"0",width:t,height:n,fill:"white"}),a.createElement("path",{ref:this.maskPathRef,fillOpacity:1,fill:"black"})),a.createElement("rect",{x:"0",y:"0",width:t,height:n,fill:"black",fillOpacity:.3,mask:"url(#selectionMask".concat(c,")")}),a.createElement("path",{ref:this.pathRef,fillOpacity:0,fill:"black",stroke:"red"}))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.value;return Array.isArray(n)&&n!==t.prevPath?{prevPath:n,path:n,currentSliceN:n.filter((function(e){return e.type===T.M})).length}:{}}}]),t}(a.PureComponent),re=Object(f.b)((function(e){return{selectToolParams:e.selectTool.params,currentTool:e.tool.current}}),{})(ae),oe=(n(155),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).canvasRef=void 0,n.ctx=void 0,n.pre=void 0,n.mouseDownHandler=function(e){console.log("canvas down"),document.addEventListener("mouseup",n.mouseUpHandler),n.setState({drawing:!0});var t={e:e,ctx:n.ctx,canvas:n.canvasRef.current,drawing:!0},a=n.props.onDown;a&&a(t);var r=n.props.clickProcess;r&&r(t)},n.mouseUpHandler=function(e){if(console.log("canvas up"),document.removeEventListener("mouseup",n.mouseUpHandler),n.state.drawing){n.setState({drawing:!1}),n.pre=null;var t=n.props.onChange;t&&t(O(n.canvasRef.current));var a={e:e,ctx:n.ctx,canvas:n.canvasRef.current,drawing:!1},r=n.props.onUp;r&&r(a);var o=n.props.releaseProcess;o&&o(a)}},n.mouseMoveHandler=function(e){var t=n.props,a=t.drawProcess,r=t.moveProcess;n.state.drawing&&a&&a({e:e,pre:n.pre,ctx:n.ctx,canvas:n.canvasRef.current,drawing:!0}),r&&r({e:e,pre:n.pre,ctx:n.ctx,canvas:n.canvasRef.current,drawing:n.state.drawing}),n.pre=e},n.state={drawing:!1},n.canvasRef=r.a.createRef(),n.ctx=null,n.pre=null,n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.ctx=this.canvasRef.current.getContext("2d"),this.canvasRef.current.addEventListener("mousedown",this.mouseDownHandler),this.canvasRef.current.addEventListener("mousemove",this.mouseMoveHandler),this.props.value instanceof ImageData&&this.ctx.putImageData(this.props.value,0,0)}},{key:"componentWillUnmount",value:function(){this.canvasRef.current.removeEventListener("mousedown",this.mouseDownHandler),this.canvasRef.current.removeEventListener("mousemove",this.mouseMoveHandler)}},{key:"componentDidUpdate",value:function(e){(e.value!==this.props.value||e.width!==this.props.width||e.height!==this.props.height)&&this.props.value instanceof ImageData&&(this.ctx=this.canvasRef.current.getContext("2d"),console.log(),this.ctx.putImageData(this.props.value,0,0))}},{key:"render",value:function(){console.log("canvas render");var e=this.props,t=e.value,n=e.width,a=e.height,o=e.className,c=e.style,i=e.children;return r.a.createElement("div",{className:m(o,"canvas")},r.a.createElement("canvas",{style:c,ref:this.canvasRef,width:n||(t?t.width:300),height:a||(t?t.height:300)}),i)}}]),t}(r.a.PureComponent));!function(e){e.Square="Square",e.Circle="Circle",e.Pattern="Pattern"}(J||(J={})),function(e){e.SourceOver="source-over",e.SourceAtop="source-atop",e.DestinationOver="destination-over",e.DestinationOut="destination-out",e.Lighter="lighter",e.Xor="xor"}($||($={}));var ce,ie,se,ue=n(25),le=n.n(ue);!function(e){e.Default="Default",e.Interrupted="Interrupted",e.InterruptedOneStroke="InterruptedOneStroke",e.Pattren="Pattren"}(ce||(ce={})),function(e){e.SourceOver="source-over",e.SourceAtop="source-atop",e.DestinationOver="destination-over",e.DestinationOut="destination-out",e.Lighter="lighter",e.Xor="xor"}(ie||(ie={})),function(e){e.CHANGE="change",e.TO_START_VALUE="change/to-start-value",e.ALL_TO_START_VALUE="change/all-to-start-value"}(se||(se={}));var pe,he,fe=function(e){return{type:se.TO_START_VALUE,path:e}},me=function(){return{type:se.ALL_TO_START_VALUE}};!function(e){e.OnDraw="onDraw",e.On="on",e.Off="off"}(pe||(pe={})),function(e){e.START="changing/start",e.STOP="changing/stop",e.SET_MODE="changing/set-mode"}(he||(he={}));var ge,ve=null,de=function(){return function(e,t){if(!ve){ve&&cancelAnimationFrame(ve);var n=performance.now();return ve=requestAnimationFrame((function t(a){e(function(e){return{type:se.CHANGE,time:e}}(a-n)),ve=requestAnimationFrame(t)})),e({type:he.START})}}},Oe=function(){return function(e,t){return ve&&cancelAnimationFrame(ve),ve=null,e({type:he.STOP})}},be=function(){return function(e,t){if(t().changing.mode===pe.OnDraw)return e(de())}},ye=function(){return function(e,t){if(t().changing.mode===pe.OnDraw)return e(me()),e(Oe())}};function je(){for(var e="#",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}var Ce,Pe=function(e){function t(){var e,n,a,r,o;Object(s.a)(this,t);for(var c=arguments.length,i=new Array(c),u=0;u<c;u++)i[u]=arguments[u];return(o=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).handlers=(r={},Object(k.a)(r,S.Brush,(n={},Object(k.a)(n,J.Square,function(){var e=function(e){var t=e.ctx,n=e.e,a=o.props.brush.params,r=a.size,c=a.opacity,i=a.compositeOperation;t.fillStyle=je(),t.globalAlpha=c,t.globalCompositeOperation=i,t.fillRect(n.offsetX-r/2,n.offsetY-r/2,r,r),t.globalCompositeOperation=$.SourceOver,t.globalAlpha=1};return{draw:e,click:e}}()),Object(k.a)(n,J.Circle,function(){var e=function(e){var t=e.ctx,n=e.e,a=o.props.brush.params,r=a.size,c=a.opacity,i=a.compositeOperation;t.fillStyle=je(),t.globalAlpha=c,t.globalCompositeOperation=i,t.beginPath(),t.arc(n.offsetX,n.offsetY,r/2,0,2*Math.PI),t.fill(),t.globalCompositeOperation=$.SourceOver,t.globalAlpha=1};return{draw:e,click:e}}()),Object(k.a)(n,J.Pattern,function(){var e=function(e){var t=e.ctx,n=e.e,a=o.props.patterns,r=o.props.brush.params,c=(r.size,r.opacity),i=r.compositeOperation,s=r.pattern;t.fillStyle=je(),t.globalAlpha=c,t.globalCompositeOperation=i;var u=a[s]&&a[s].resultImage;u&&(t.drawImage(u,n.offsetX-u.width/2,n.offsetY-u.height/2,u.width,u.height),t.globalCompositeOperation=$.SourceOver,t.globalAlpha=1)};return{draw:e,click:e}}()),n)),Object(k.a)(r,S.Line,(a={},Object(k.a)(a,ce.Default,{click:function(e){var t=e.ctx,n=e.e,a=o.props.line.params,r=a.size,c=a.opacity,i=a.compositeOperation;t.beginPath(),t.globalCompositeOperation=i,t.globalAlpha=c,t.strokeStyle=je(),t.lineWidth=r,t.moveTo(n.offsetX,n.offsetY)},draw:function(e){var t=e.ctx,n=e.e,a=o.props.line.params,r=a.size,c=a.opacity;t.lineWidth=r,t.globalAlpha=c,t.lineTo(n.offsetX,n.offsetY),t.stroke()},release:function(e){e.ctx.globalCompositeOperation=ie.SourceOver,e.ctx.globalAlpha=1,e.ctx.closePath()}}),Object(k.a)(a,ce.Interrupted,{click:function(e){var t=e.ctx,n=(e.e,o.props.line.params),a=n.size,r=n.opacity,c=n.compositeOperation;t.globalCompositeOperation=c,t.globalAlpha=r,t.strokeStyle=je(),t.lineWidth=a,t.beginPath()},draw:function(e){var t=e.ctx,n=e.e,a=e.pre,r=o.props.line.params,c=r.size,i=r.opacity;a&&(t.lineWidth=c,t.globalAlpha=i,t.moveTo(a.offsetX,a.offsetY),t.lineTo(n.offsetX,n.offsetY),t.stroke())},release:function(e){e.ctx.globalCompositeOperation=ie.SourceOver,e.ctx.globalAlpha=1,e.ctx.closePath()}}),Object(k.a)(a,ce.InterruptedOneStroke,{click:function(e){var t=e.ctx,n=(e.e,o.props.line.params),a=n.size,r=n.opacity,c=n.compositeOperation;t.globalCompositeOperation=c,t.globalAlpha=r,t.strokeStyle=je(),t.lineWidth=a},draw:function(e){var t=e.ctx,n=e.e,a=e.pre,r=o.props.line.params,c=r.size,i=r.opacity;t.lineWidth=c,t.globalAlpha=i,a&&(t.beginPath(),t.moveTo(a.offsetX,a.offsetY),t.lineTo(n.offsetX,n.offsetY),t.stroke(),t.closePath())},release:function(e){e.ctx.globalCompositeOperation=ie.SourceOver,e.ctx.globalAlpha=1}}),a)),r),o}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.tool,n=e.startChanging,r=e.stopChanging,o=Ee[t],c=o?o(this.props):0,i=this.handlers[t],s=i&&i[c];return console.log(s),a.createElement(oe,Object.assign({onDown:n,onUp:r,drawProcess:s&&s.draw,clickProcess:s&&s.click,releaseProcess:s&&s.release},this.props))}}]),t}(a.PureComponent),Ee=(ge={},Object(k.a)(ge,S.Line,(function(e){return le()(e,"line.params.type")})),Object(k.a)(ge,S.Brush,(function(e){return le()(e,"brush.params.type")})),ge),Se={startChanging:be,stopChanging:ye},we=Object(f.b)((function(e){return{brush:e.brush,line:e.line,tool:e.tool.current,patterns:e.patterns}}),Se)(Pe),ke=(n(185),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.currentTool,n=e.name,r=e.height,o=e.width,c=e.imageValue,i=e.selectionValue,s=e.selectionParams,u=e.onImageChange,l=e.onSelectionChange;return a.createElement("div",{className:"area"},a.createElement(we,{value:c,width:o,height:r,onChange:u}),a.createElement(re,{isActive:-1!==M.indexOf(t),name:n,width:o,height:r,value:i,params:s,onChange:l}))}}]),t}(a.PureComponent)),De=Object(f.b)((function(e){return{currentTool:e.tool.current}}),{})(ke),Ae=function(e){var t=e.value,n=e.onChange,r=e.min,o=void 0===r?0:r,c=e.max,i=void 0===c?1:c,s=e.step,u=void 0===s?.05:s,l=e.delay,p=e.notZero,h=a.useState(t),f=Object(_.a)(h,2),m=f[0],g=f[1];a.useEffect((function(){t!==m&&!Ce&&g(t)}));return a.createElement("input",{type:"number",step:u,min:o,max:i,value:m,onChange:function(e){var a=+e.target.value;if(l)g(a),Ce&&clearTimeout(Ce),Ce=setTimeout((function(){!p||a?(n(a),clearTimeout(Ce),Ce=null):g(t)}),l);else{if(p&&!a)return;g(a),n(a)}}})},Te=function(e){var t=e.onChange,n=e.onFocus,r=e.onBlur,o=e.value,c=e.className;return a.createElement("input",{className:m(c,"input-text"),type:"text",value:o,onFocus:n,onBlur:r,onChange:function(e){t&&t(e.target.value)}})},Re=(n(186),n(12));function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ve,Ie=function(e){var t=e.className,n=e.selected,r=e.onClick,o=e.onMouseDown,c=e.onMouseUp,i=Object(Re.a)(e,["className","selected","onClick","onMouseDown","onMouseUp"]);return a.createElement(v,Object.assign({},i,{onClick:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return r&&r(Ne({},e,{selected:n}))})),onMouseDown:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return o&&o(Ne({},e,{selected:n}))})),onMouseUp:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return c&&c(Ne({},e,{selected:n}))})),className:m("button-select",t,Object(k.a)({},"button-select-selected",n))}))},xe=n(17),_e=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handlePress=function(e){e.preventRepeat();var t=n.props,a=t.onPress,r=t.keys;a&&a(e,r)},n.handleRelease=function(e){var t=n.props,a=t.onRelease,r=t.keys;a&&a(e,r)},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.keys;console.log(this.props),xe.bind(e,this.handlePress,this.handleRelease)}},{key:"componentDidUpdate",value:function(e){e.keys!==this.props.keys&&(xe.unbind(e.keys,this.handlePress,this.handleRelease),xe.bind(this.props.keys,this.handlePress,this.handleRelease))}},{key:"componentWillUnmount",value:function(){xe.unbind(this.props.keys,this.handlePress,this.handleRelease)}},{key:"render",value:function(){return console.log("keys render",this.props.keys),a.createElement(a.Fragment,null)}}]),t}(a.PureComponent);function Le(e){var t=function(e){var t=0,n=0;if(!e)e=window.event;return e.pageX||e.pageY?(t=e.pageX,n=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:t,y:n}}(e),n=function(e){var t=Ve=0;if(e.offsetParent)do{t+=e.offsetLeft,Ve+=e.offsetTop}while(e=e.offsetParent);return{left:t,top:Ve}}(function(e){var t;if(!e)e=window.event;return e.target?t=e.target:e.srcElement&&(t=e.srcElement),3==t.nodeType&&(t=t.parentNode),t}(e));return{x:t.x-n.left,y:t.y-n.top}}function Fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Ue,Xe=70,Ye=function(e){return e.toFixed(1)},He={VerticalLinear:function(e){return function(t,n,a){return t-a/e}}},Be=function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).handleDown=function(e){if(console.log("down"),!n.state.startValue){var t=e.e;t.persist();var a=n.props,r=a.onMouseDown,o=a.name,c=a.selected,i=n.state.value;r&&r({e:t,value:i,name:o,selected:c}),n.setState((function(e){return{startValue:e.value,startPoint:[t.clientX,t.clientY]}}),(function(){document.addEventListener("mousemove",n.handleMove),document.addEventListener("mouseup",n.handleUp)}))}},n.handleMove=function(e){var t=n.props,a=t.onChange,r=t.name,o=t.selected,c=n.calcValue(e);console.log("move",c),a&&a({e:e,value:c,name:r,selected:o}),n.setState({value:c})},n.handleUp=function(e){var t=n.props,a=(t.changingStartValue,t.onClick),r=t.onMouseUp,o=t.onChange,c=t.name,i=t.selected,s=t.width,u=void 0===s?Xe:s,l=t.precision,p=void 0===l?100:l,h=t.range,f=n.calcValue(e),m=(h[1]-h[0])/p;if(Math.abs(f-n.state.startValue)<m){var g=Le(e).x;console.log("11111",g,u/2,n.state.startValue),f=Math.min(Math.max(n.state.startValue+(g>u/2?m:-m),h[0]),h[1]),console.log(f,"=",n.state.startValue,"+",g>u/2?1:-1),o&&o({e:e,value:f,name:c,selected:i})}else r&&r({e:e,value:f,name:c,selected:i}),a&&a({value:f,name:c,e:e,selected:i});n.setState({value:f,startValue:null,startPoint:null},(function(){document.removeEventListener("mousemove",n.handleMove),document.removeEventListener("mouseup",n.handleUp)}))},n.handlePress=function(e){if(!n.state.startValue){var t=n.props,a=t.onPress,r=t.name,o=t.selected,c=n.state.value;a&&a({e:e,value:c,name:r,selected:o}),n.setState((function(e){return{startValue:e.value,startPoint:null}}),(function(){document.addEventListener("mousemove",n.handlePressed)}))}},n.handlePressed=function(e){if(n.state.startPoint){var t=n.props,a=t.onChange,r=t.name,o=t.selected,c=n.calcValue(e);a&&a({e:e,value:c,name:r,selected:o}),n.setState({value:c})}else n.setState({startPoint:[e.clientX,e.clientY]})},n.handleRelease=function(e){var t=n.props,a=t.onRelease,r=t.name,o=t.selected,c=n.state.value;a&&a({value:c,name:r,e:e,selected:o}),n.setState({value:c,startValue:null,startPoint:null},(function(){document.removeEventListener("mousemove",n.handlePressed)}))},n.calcValue=function(e){console.log(n.state.startValue);var t=n.props,a=t.range,r=t.valueD,o=(void 0===r?He.VerticalLinear(5):r)(n.state.startValue,e.clientX-n.state.startPoint[0],e.clientY-n.state.startPoint[1]);return o=Math.min(Math.max(o,a[0]),a[1])};var a=e.range;return n.state={value:e.value||a[0],startPoint:null,startValue:null,changing:!1},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return t.value!==this.state.value||e.changingStartValue!==this.props.changingStartValue||e.amplitude!==this.props.amplitude||e.changeFunctionId!==this.props.changeFunctionId||e.shortcut!==this.props.shortcut||e.className!==this.props.className}},{key:"render",value:function(){var e=this.props,t=e.changingStartValue,n=e.changeFunctionId,r=e.amplitude,o=e.range,c=e.width,i=void 0===c?Xe:c,s=e.className,u=e.getText,l=void 0===u?Ye:u,p=e.text,h=e.shortcut,f=Object(Re.a)(e,["changingStartValue","changeFunctionId","amplitude","range","width","className","getText","text","shortcut"]),g=this.state,v=g.value,d=void 0===v?0:v,O=g.startValue;console.log("number button render",l(d));var b=t/(o[1]-o[0]),y=Math.min(b,r)+Math.min(1-b,r);return console.log(b,r,Math.min(b,r),Math.min(-1*b+100,r)),a.createElement(Ie,Object.assign({},f,{className:m("button-number",s,Object(k.a)({},"button-number-active",!!O)),width:i,onMouseDown:this.handleDown}),a.createElement("div",{className:"button-number-value",style:{width:(d-o[0])/(o[1]-o[0])*100+"%"}},l?l(d):p),t&&r&&a.createElement("div",{className:"button-number-amplitude",style:{width:100*y+"%",left:"calc(".concat(100*Math.max(b-r,0),"%)")}},a.createElement("span",null,n)),h&&a.createElement(_e,{keys:h,onPress:this.handlePress,onRelease:this.handleRelease}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fe(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t.startPoint||e.value===t.value?{}:{value:e.value})}}]),t}(a.Component),Ge=function(e){return e.value},ze=function(e){return e.text},We=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleClick=function(e){var t=e.value,a=(e.selected,e.e),r=n.props,o=r.name,c=r.items,i=r.onChange,s=r.getValue,u=void 0===s?Ge:s,l=r.nullAble,p=r.value,h=u(t);l&&p===h&&(h=null),i&&i({value:h,e:a,item:t,items:c,name:o})},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.className,r=t.items,o=t.value,c=t.name,i=t.getValue,s=void 0===i?Ge:i,u=t.getText,l=void 0===u?ze:u,p=t.br;return console.log("select buttons render",c),a.createElement("span",{className:m(n,"select-buttons")},r.map((function(t,n){return a.createElement(a.Fragment,null,!!p&&!!n&&!(n%p)&&a.createElement("br",null),a.createElement(Ie,{value:t,key:s(t),selected:s(t)===o,onMouseUp:function(e){console.log(e)},onClick:e.handleClick},l(t)))})))}}]),t}(a.PureComponent),Ze=(n(189),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.className,n=Object(Re.a)(e,["className"]),r=n.value;n.getText;return console.log("select drop render",n.name,r),a.createElement("div",{className:m(t,"select-drop")},a.createElement(v,{className:"select-drop-value"},r||"null"),a.createElement(We,Object.assign({},n,{className:"select-drop-items"})))}}]),t}(a.PureComponent));!function(e){e.SET_VALUE_IN_CHANGING_LIST="changing-values/set-value",e.SET_START_VALUE="changing-values/set-start-value",e.ACTIVATE_VALUE_CHANGING="changing-values/activate",e.DEACTIVATE_VALUE_CHANGING="changing-values/deactivate"}(Ue||(Ue={}));n(190),n(191);var qe,Ke=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.button,r=e.className;return a.createElement("div",{className:m("hover-hideable",r)},n,a.createElement("div",{className:"hover-hideable-hidden-part"},t))}}]),t}(a.PureComponent),Je=(n(192),function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleChange=function(e){n.props.onChange("Backspace"===e.key?null:e.key)},n.handleFocus=function(){xe.bind("",n.handleChange)},n.handleBlur=function(){xe.unbind("",n.handleChange)},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.value;return a.createElement(Te,{className:"shortcut-input",value:e,onFocus:this.handleFocus,onBlur:this.handleBlur,onChange:function(){}})}}]),t}(a.PureComponent)),$e=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={changeFunctionsItems:[],changeFunctions:null,active:!1,shortcut:null},n.handleCFChange=function(e){var t=e.value,a=n.props;(0,a.setValueInChangingList)(a.path,t,a.range,a.value)},n.handleChange=function(e){n.props.onChange(e);var t=n.props;(0,t.setStartValue)(t.path,t.value)},n.handleStartManualChanging=function(){var e=n.props;(0,e.deactivateValueChanging)(e.path),n.setState({active:!0})},n.handleStopManualChanging=function(){var e=n.props;(0,e.activateValueChanging)(e.path),n.setState({active:!1})},n.handleShortcutChange=function(e){return n.setState({shortcut:e})},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.changeFunctions,n=e.changingValues,r=e.path,o=Object(Re.a)(e,["changeFunctions","changingValues","path"]),c=(o.onChange,o.onMouseDown,o.onMouseUp,o.onPress,o.onRelease,Object(Re.a)(o,["onChange","onMouseDown","onMouseUp","onPress","onRelease"]));console.log("render b cf");var i=n[r],s=i&&i.startValue,u=i&&n[r].changeFunctionId,l=i&&t[u].params.a;return a.createElement(Ke,{className:"button-number-cf",button:a.createElement(Be,Object.assign({},c,{shortcut:this.state.shortcut,className:m("button-number-cf-value",Object(k.a)({},"button-number-cf-value-active",this.state.active)),changeFunctionId:u,changingStartValue:s,amplitude:l,onChange:this.handleChange,onMouseDown:this.handleStartManualChanging,onPress:this.handleStartManualChanging,onMouseUp:this.handleStopManualChanging,onRelease:this.handleStopManualChanging}))},!this.state.active&&a.createElement(Ke,{className:"button-number-cf-settings",button:a.createElement("div",{className:"button-number-cf-settings-handler"},a.createElement("div",null))},a.createElement(Je,{value:this.state.shortcut,onChange:this.handleShortcutChange}),a.createElement(Ze,{nullAble:!0,className:"button-number-cf-select",value:n[this.props.path]&&n[this.props.path].changeFunctionId,onChange:this.handleCFChange,items:this.state.changeFunctionsItems})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.changeFunctions!==t.changeFunctions?{changeFunctions:e.changeFunctions,changeFunctionsItems:z(e.changeFunctions,(function(e){return e.id}),(function(e){return e.id}))}:null}}]),t}(a.PureComponent),Qe={setValueInChangingList:function(e,t,n,a){return function(r){r(fe(e)),r({type:Ue.SET_VALUE_IN_CHANGING_LIST,path:e,changeFunctionId:t,range:n,startValue:a})}},deactivateValueChanging:function(e){return function(t,n){n().changingValues[e]&&(t(fe(e)),t({type:Ue.DEACTIVATE_VALUE_CHANGING,path:e}))}},activateValueChanging:function(e){return function(t,n){n().changingValues[e]&&t({type:Ue.ACTIVATE_VALUE_CHANGING,path:e})}},toStartValue:fe,setStartValue:function(e,t){return function(n){n({type:Ue.SET_START_VALUE,path:e,startValue:t})}}},et=Object(f.b)((function(e){return{changeFunctions:e.changeFunctions,changingValues:e.changingValues}}),Qe)($e),tt=[0,1];var nt,at="black";!function(e){e.sourceOver="source-over",e.destinationOver="destination-over",e.destinationOut="destination-out"}(nt||(nt={}));var rt=function(e){function t(){var e,n,a,r,o;Object(s.a)(this,t);for(var c=arguments.length,i=new Array(c),u=0;u<c;u++)i[u]=arguments[u];return(o=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).handlers=(r={},Object(k.a)(r,S.Brush,(n={},Object(k.a)(n,J.Square,{draw:function(e){var t=e.ctx,n=e.e,a=o.props.params,r=a.black,c=a.opacity,i=o.props.brush.params.size;t.fillStyle=at,t.globalAlpha=c,t.globalCompositeOperation=r?nt.destinationOver:nt.destinationOut,t.fillRect(n.offsetX-i/2,n.offsetY-i/2,i,i),t.globalCompositeOperation=nt.sourceOver,t.globalAlpha=1},click:function(e){var t=e.ctx,n=e.e,a=o.props.params,r=a.black,c=a.opacity,i=o.props.brush.params.size;t.fillStyle=at,t.globalAlpha=c,t.globalCompositeOperation=r?nt.destinationOver:nt.destinationOut,t.fillRect(n.offsetX-i/2,n.offsetY-i/2,i,i),t.globalCompositeOperation=nt.sourceOver,t.globalAlpha=1}}),Object(k.a)(n,J.Circle,{draw:function(e){var t=e.ctx,n=e.e,a=o.props.params,r=a.black,c=a.opacity,i=o.props.brush.params.size;t.fillStyle=at,t.globalAlpha=c,t.globalCompositeOperation=r?nt.destinationOver:nt.destinationOut,t.beginPath(),t.arc(n.offsetX,n.offsetY,i/2,0,2*Math.PI),t.fill(),t.globalCompositeOperation=nt.sourceOver,t.globalAlpha=1},click:function(e){var t=e.ctx,n=e.e,a=o.props.brush.params.size,r=o.props.params,c=r.black,i=r.opacity;t.fillStyle=at,t.globalAlpha=i,t.globalCompositeOperation=c?nt.destinationOver:nt.destinationOut,t.beginPath(),t.arc(n.offsetX,n.offsetY,a/2,0,2*Math.PI),t.fill(),t.globalCompositeOperation=nt.sourceOver,t.globalAlpha=1}}),n)),Object(k.a)(r,S.Line,(a={},Object(k.a)(a,ce.Default,{click:function(e){var t=e.ctx,n=e.e,a=o.props.line.params.size,r=o.props.params,c=r.black,i=r.opacity;t.globalAlpha=i,t.globalCompositeOperation=c?nt.destinationOver:nt.destinationOut,t.strokeStyle=at,t.beginPath(),t.lineWidth=a,t.moveTo(n.offsetX,n.offsetY)},draw:function(e){var t=e.ctx,n=e.e,a=o.props.line.params;a.size,a.opacity;t.lineTo(n.offsetX,n.offsetY),t.stroke()},release:function(e){e.ctx.globalCompositeOperation=ie.SourceOver,e.ctx.globalAlpha=1,e.ctx.closePath()}}),Object(k.a)(a,ce.Interrupted,{click:function(e){var t=e.ctx,n=(e.e,o.props.line.params.size),a=o.props.params,r=a.black,c=a.opacity;t.strokeStyle=at,t.globalAlpha=c,t.globalCompositeOperation=r?nt.destinationOver:nt.destinationOut,t.lineWidth=n,t.beginPath()},draw:function(e){var t=e.ctx,n=e.e,a=e.pre,r=o.props.line.params;r.size,r.opacity;a&&(t.moveTo(a.offsetX,a.offsetY),t.lineTo(n.offsetX,n.offsetY),t.stroke())},release:function(e){e.ctx.globalCompositeOperation=ie.SourceOver,e.ctx.globalAlpha=1,e.ctx.closePath()}}),Object(k.a)(a,ce.InterruptedOneStroke,{click:function(e){var t=e.ctx,n=(e.e,o.props.line.params.size),a=o.props.params,r=a.black,c=a.opacity;t.strokeStyle=at,t.globalAlpha=c,t.globalCompositeOperation=r?nt.destinationOver:nt.destinationOut,t.lineWidth=n},draw:function(e){var t=e.ctx,n=e.e,a=e.pre,r=o.props.line.params;r.size,r.opacity;a&&(t.beginPath(),t.moveTo(a.offsetX,a.offsetY),t.lineTo(n.offsetX,n.offsetY),t.stroke(),t.closePath())},release:function(e){e.ctx.globalCompositeOperation=ie.SourceOver,e.ctx.globalAlpha=1}}),a)),r),o.handleOpacityChange=function(e){var t=e.value;return o.props.onParamsChange(Object(k.a)({},"opacity",t))},o.handleBlackChange=function(e){return o.props.onParamsChange(Object(k.a)({},"black",!e.selected))},o}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.tool,n=e.startChanging,r=e.stopChanging,o=e.params,c=e.name,i=ot[t],s=i?i(this.props):0,u=this.handlers[t],l=u&&u[s];return a.createElement(a.Fragment,null,a.createElement("div",null,a.createElement(et,{path:"patterns.".concat(c,".mask.params.opacity"),name:"opacity",range:tt,value:o.opacity,onChange:this.handleOpacityChange}),a.createElement("div",null,a.createElement(Ie,{name:"black",selected:o.black,onClick:this.handleBlackChange}))),a.createElement(oe,Object.assign({className:"maskCanvas",onDown:n,onUp:r,drawProcess:l&&l.draw,clickProcess:l&&l.click,releaseProcess:l&&l.release},this.props)))}}]),t}(a.PureComponent),ot=(qe={},Object(k.a)(qe,S.Line,(function(e){return le()(e,"line.params.type")})),Object(k.a)(qe,S.Brush,(function(e){return le()(e,"brush.params.type")})),qe),ct={startChanging:be,stopChanging:ye},it=Object(f.b)((function(e){return{brush:e.brush,line:e.line,tool:e.tool.current}}),ct)(rt);function st(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var ut,lt={min:0,max:500,step:1,delay:1e3,notZero:!0},pt=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={roomName:"222"},n.handleImageChange=function(e){return n.props.onImageChange(n.props.id,e)},n.handleMaskChange=function(e){return n.props.onMaskChange(n.props.id,e)},n.handleSelectionChange=function(e){return n.props.onSelectionChange(n.props.id,e)},n.handleClearSelection=function(){return n.props.onSelectionChange(n.props.id,[])},n.handleRemove=function(){return n.props.onRemove(n.props.id)},n.handleUndo=function(){return n.props.onUndo(n.props.id)},n.handleRedo=function(){return n.props.onRedo(n.props.id)},n.handleSetWidth=function(e){return n.props.onSetWidth(n.props.id,e)},n.handleSetHeight=function(e){return n.props.onSetHeight(n.props.id,e)},n.handleMaskParamsChange=function(e){return n.props.onMaskParamsChange(n.props.id,e)},n.handleCreateRoom=function(){n.props.onCreateRoom(n.props.id,n.state.roomName)},n.handleConfigToggle=function(e){n.props.onConfigChange(n.props.id,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?st(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):st(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.props.config,Object(k.a)({},e.name,!e.selected)))},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.resultImage,r=t.connected,o=t.imageValue,c=t.maskValue,i=t.maskParams,s=t.height,u=t.width,l=t.id,p=t.config,h=t.history,f=(t.store,t.selection);return console.log("pattern render ",l,n),a.createElement("div",{className:"pattern"},a.createElement("div",{className:"areas"},a.createElement(De,{name:l,width:u,height:s,imageValue:o,selectionValue:f.value,selectionParams:f.params,onImageChange:this.handleImageChange,onSelectionChange:this.handleSelectionChange}),p.mask&&a.createElement(it,{params:i,value:c,name:l,width:u,height:s,onParamsChange:this.handleMaskParamsChange,onChange:this.handleMaskChange})),a.createElement("div",{className:"pattern-controls"},a.createElement(v,{onClick:this.handleRemove},"del")," ",l,r,a.createElement(Te,{value:this.state.roomName,onChange:function(t){return e.setState({roomName:t})}}),a.createElement(v,{onClick:this.handleCreateRoom}),a.createElement(Ae,Object.assign({onChange:this.handleSetWidth,value:u},lt)),a.createElement(Ae,Object.assign({onChange:this.handleSetHeight,value:s},lt)),p.history&&a.createElement(D,{history:h.value,onUndo:this.handleUndo,onRedo:this.handleRedo}),f.value&&f.value.length&&a.createElement(v,{onClick:this.handleClearSelection},"clear"),a.createElement("div",null,a.createElement(Ie,{name:"mask",selected:p.mask,onClick:this.handleConfigToggle},"mask"))))}}]),t}(a.PureComponent),ht=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleAddClick=function(){return n.props.addPattern({history:!0,selection:!0})},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.createRoom,n=e.removePattern,r=e.patterns,o=e.updateImage,c=e.updateMask,i=e.setMaskParams,s=e.updateSelection,u=e.undo,l=e.redo,p=e.setWidth,h=e.setHeight,f=e.editConfig;return a.createElement(a.Fragment,null,r.map((function(e){var r=e.id,m=e.current,g=e.mask,v=e.config,d=e.history,O=e.store,b=e.selection,y=e.connected,j=e.resultImage;return a.createElement(pt,{key:r,id:r,config:v,connected:y,history:d,store:O,selection:b,imageValue:m?m.imageData:null,maskValue:g?g.value.imageData:null,resultImage:j,maskParams:g?g.params:null,width:m?m.width:null,height:m?m.height:null,onUndo:u,onRedo:l,onImageChange:o,onMaskChange:c,onMaskParamsChange:i,onSelectionChange:s,onRemove:n,onSetWidth:p,onSetHeight:h,onCreateRoom:t,onConfigChange:f})})),a.createElement(v,{onClick:this.handleAddClick},"add"))}}]),t}(a.PureComponent),ft={setMaskParams:function(e,t){return{type:j.SET_MASK_PARAMS,id:e,params:t}},createRoom:function(e,t){return function(n){var a=d("http://localhost:3002",{path:"/room",query:{name:t}});return a.on("image",(function(t){(function(e){return new Promise((function(t){var n=new Image;n.src=e,n.onload=function(){var e=document.createElement("canvas"),a=e.getContext("2d");if(!a)return null;e.width=n.width,e.height=n.height,a.drawImage(n,0,0),t(a.getImageData(0,0,e.width,e.height))}}))})(t).then((function(t){n(w(e,t,!1))}))})),n({type:j.CREATE_ROOM,id:e,roomName:t,socket:a})}},addPattern:function(e){return{type:y.ADD_PATTERN,config:e}},removePattern:function(e){return{type:y.REMOVE_PATTERN,id:e}},updateImage:w,updateSelection:function(e,t){return{type:j.UPDATE_SELECTION,value:t,id:e}},redo:function(e){return{type:j.REDO,id:e}},undo:function(e){return{type:j.UNDO,id:e}},setWidth:function(e,t){return{type:j.SET_WIDTH,id:e,width:t}},setHeight:function(e,t){return{type:j.SET_HEIGHT,id:e,height:t}},editConfig:function(e,t){return{type:j.EDIT_CONFIG,id:e,config:t}},updateMask:function(e,t){return{type:j.UPDATE_MASK,imageData:t,id:e}}},mt=Object(f.b)((function(e){return{patterns:Object.values(e.patterns)}}),ft)(ht);!function(e){e.SET_CURRENT="tools/set-current"}(ut||(ut={}));var gt;!function(e){e.SET_PARAMS="brush/set-params"}(gt||(gt={}));var vt=n(15),dt=Object(vt.a)([function(e){return e.patterns}],(function(e){return z(e,(function(e,t){return+t}))}));function Ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function bt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ot(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ot(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var yt,jt=[1,200],Ct=He.VerticalLinear(.2),Pt=[0,1],Et=He.VerticalLinear(100),St=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleSizeChange=function(e){var t=e.value;console.log(t),n.props.setBrushParams(bt({},n.props.paramsValue,{size:t}))},n.handlePatternChange=function(e){var t=e.value;n.props.setBrushParams(bt({},n.props.paramsValue,{pattern:+t}))},n.handleCompositeChange=function(e){var t=e.value;n.props.setBrushParams(bt({},n.props.paramsValue,{compositeOperation:t}))},n.handleOpacityChange=function(e){var t=e.value;n.props.setBrushParams(bt({},n.props.paramsValue,{opacity:t}))},n.handleTypeChange=function(e){var t=e.value;n.props.setBrushParams(bt({},n.props.paramsValue,{type:t}))},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=(e.paramsConfig,e.paramsConfigMap),n=e.paramsValue,r=(e.setBrushParams,e.patternsSelectItems);return a.createElement(a.Fragment,null,a.createElement(We,{value:n.type,items:t.type.props.items,onChange:this.handleTypeChange}),a.createElement("br",null),a.createElement(et,{path:"brush.params.size",value:n.size,name:"size",onChange:this.handleSizeChange,range:jt,valueD:Ct}),a.createElement(et,{path:"brush.params.opacity",value:n.opacity,name:"opacity",onChange:this.handleOpacityChange,range:Pt,valueD:Et}),a.createElement(Ze,{value:n.compositeOperation,items:t.compositeOperation.props.items,onChange:this.handleCompositeChange}),a.createElement("br",null),n.type===J.Pattern&&a.createElement(We,{value:n.pattern,onChange:this.handlePatternChange,items:r}))}}]),t}(a.PureComponent),wt=Object(vt.a)([function(e){return e.brush.paramsConfig}],(function(e){return e.reduce((function(e,t){return e[t.name]=t,e}),{})})),kt={setBrushParams:function(e){return{type:gt.SET_PARAMS,params:e}}},Dt=Object(f.b)((function(e){return{paramsConfig:e.brush.paramsConfig,paramsConfigMap:wt(e),paramsValue:e.brush.params,patternsSelectItems:dt(e)}}),kt)(St);!function(e){e.SET_PARAMS="line/set-params"}(yt||(yt={}));function At(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Tt,Rt=[1,200],Mt=He.VerticalLinear(.2),Nt=[0,1],Vt=He.VerticalLinear(100),It=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleParamChange=function(e){var t=e.value,a=e.name,r=n.props;(0,r.setLineParams)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r.paramsValue,Object(k.a)({},a,t)))},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.paramsConfigMap,n=(e.paramsConfig,e.paramsValue),r=e.patternsSelectItems;return a.createElement(a.Fragment,null,a.createElement(We,{br:3,value:n.type,name:"type",items:t.type.props.items,onChange:this.handleParamChange}),a.createElement("br",null),a.createElement(et,{path:"line.params.size",value:n.size,name:"size",onChange:this.handleParamChange,range:Rt,valueD:Mt}),a.createElement(et,{path:"line.params.opacity",value:n.opacity,name:"opacity",onChange:this.handleParamChange,range:Nt,valueD:Vt}),a.createElement(Ze,{name:"compositeOperation",value:n.compositeOperation,items:t.compositeOperation.props.items,onChange:this.handleParamChange}),a.createElement("br",null),n.type===ce.Pattren&&a.createElement(We,{name:"pattern",value:n.pattern,onChange:this.handleParamChange,items:r}))}}]),t}(a.PureComponent),xt=Object(vt.a)([function(e){return e.line.paramsConfig}],(function(e){return e.reduce((function(e,t){return e[t.name]=t,e}),{})})),_t={setLineParams:function(e){return{type:yt.SET_PARAMS,params:e}}},Lt=Object(f.b)((function(e){return{paramsConfig:e.line.paramsConfig,paramsConfigMap:xt(e),paramsValue:e.line.params,patternsSelectItems:dt(e)}}),_t)(It);!function(e){e.SET_PARAMS="select/set-params"}(Tt||(Tt={}));function Ft(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Ut,Xt,Yt=He.VerticalLinear(100),Ht=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleParamChange=function(e){var t=e.value,a=e.name,r=n.props;(0,r.setSelectToolParams)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ft(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ft(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r.paramsValue,Object(k.a)({},a,t)))},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.paramsValue,r=t.paramsConfigMap,o=(t.paramsConfig,t.setSelectToolParams,r.mode),c=r.curveType,i=Object(Re.a)(r,["mode","curveType"]);return a.createElement(a.Fragment,null,a.createElement(Ze,{name:"mode",value:n.mode,items:o.props.items,onChange:this.handleParamChange}),n.mode===q.Points&&a.createElement(Ze,{name:"curveType",value:n.curveType,items:c.props.items,onChange:this.handleParamChange}),Object.values(i).map((function(t){var r=t.name,o=t.props;return a.createElement(et,{value:n[r],name:r,path:"selectTool.params.".concat(r),range:o.range,onChange:e.handleParamChange,valueD:Yt})})))}}]),t}(a.PureComponent),Bt=Object(vt.a)([function(e){return e.selectTool.paramsConfig}],(function(e){return e.reduce((function(e,t){return e[t.name]=t,e}),{})})),Gt={setSelectToolParams:function(e){return{type:Tt.SET_PARAMS,params:e}}},zt=Object(f.b)((function(e){return{paramsConfig:e.selectTool.paramsConfig,paramsValue:e.selectTool.params,paramsConfigMap:Bt(e)}}),Gt)(Ht),Wt=n(257);!function(e){e.ON="fullscreen/on",e.OFF="fullscreen/off",e.SET="fullscreen/set",e.REVERSE="fullscreen/reverse"}(Xt||(Xt={}));var Zt,qt,Kt=Object(Wt.a)((Ut={},Object(k.a)(Ut,Xt.ON,(function(){return!0})),Object(k.a)(Ut,Xt.OFF,(function(){return!1})),Object(k.a)(Ut,Xt.SET,(function(e,t){return t.value})),Object(k.a)(Ut,Xt.REVERSE,(function(e){return!e})),Ut),!1),Jt=(Zt={},Object(k.a)(Zt,S.Brush,{component:Dt,type:S.Brush}),Object(k.a)(Zt,S.Line,{component:Lt,type:S.Line}),Object(k.a)(Zt,S.Select,{component:zt,type:S.Select}),Zt),$t={setCurrentTool:function(e){return{type:ut.SET_CURRENT,tool:e}},reverseFullScreen:function(){return{type:Xt.REVERSE}}},Qt=Object(f.b)((function(e){return{currentTool:e.tool.current}}),$t)((function(e){var t=e.currentTool,n=e.setCurrentTool,r=e.reverseFullScreen,o=Jt[t].component;return a.createElement("div",{className:"tools"},a.createElement(v,{onClick:r},"full"),a.createElement("div",null,Object.keys(Jt).map((function(e){return a.createElement(Ie,{key:e,selected:e===t,onClick:function(){return n(Jt[e].type)}},e)}))),a.createElement(o,null))}));!function(e){e.UPDATE_ROOMS="rooms/update",e.CONNECT_ROOMS="rooms/connect"}(qt||(qt={}));var en,tn=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleRoomConnect=function(e){console.log(e)},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.roomsConnect()}},{key:"render",value:function(){var e=this,t=this.props.rooms;return a.createElement(a.Fragment,null,t.map((function(t){return a.createElement(v,{onClick:e.handleRoomConnect,value:t},t.name)})))}}]),t}(a.PureComponent),nn={roomsConnect:function(){return function(e){return d("http://localhost:3002",{path:"/rooms"}).on("updateRooms",(function(t){e(function(e){return{type:qt.UPDATE_ROOMS,rooms:e}}(Object.values(t)))})),e({type:qt.CONNECT_ROOMS})}}},an=Object(f.b)((function(e){return{rooms:e.rooms.rooms}}),nn)(tn);!function(e){e.ADD_CF="change-functions/add",e.CHANGE_PARAMS="change-functions/change-params"}(en||(en={}));var rn,on;function cn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}!function(e){e.Boolean="boolean",e.Number="number",e.Select="select"}(on||(on={}));var sn=(rn={},Object(k.a)(rn,on.Boolean,Ie),Object(k.a)(rn,on.Select,We),Object(k.a)(rn,on.Number,Be),rn),un=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleChange=function(e){var t=n.props,a=t.value,r=t.onChange,o=t.name;console.log(e),r&&r(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cn(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},a,Object(k.a)({},e.name,e.value)),o)},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.data,r=t.value;return a.createElement("div",{className:"params"},n.map((function(t){var n=t.type,o=t.name,c=t.props,i=sn[n]||Ie;return a.createElement(i,Object.assign({},c,{value:r[o],name:o,onChange:e.handleChange,key:o}))})))}}]),t}(a.PureComponent);n(193);function ln(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var pn,hn=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleAChange=function(e){var t=e.value;n.props.onChange(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ln(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ln(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.props.params,{a:t}),n.props.name)},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.params,n=e.paramsConfig,r=e.onChange,o=e.name;return a.createElement("div",{className:"sin-change-function"},a.createElement(et,{path:"changeFunctions.".concat(o,".params.a"),value:t.a,range:[0,1],onChange:this.handleAChange}),a.createElement(un,{name:o,data:n,value:t,onChange:r}))}}]),t}(a.PureComponent);!function(e){e.SIN="sin"}(pn||(pn={}));var fn=Object(k.a)({},pn.SIN,hn),mn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e};return Object.keys(e).map((function(a){return{value:t(e[a],a),text:n(e[a],a)}}))}(pe);console.log(mn);var gn=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleChange=function(e,t){n.props.changeCFParams(t,e)},n.handleAddSin=function(){n.props.addCF(pn.SIN)},n.handleModeChange=function(e){var t=e.value;n.props.setChangingMode(t)},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.cfs,r=t.changingMode;return a.createElement("div",null,Object.values(n).map((function(t){var n=t.type,r=t.id,o=t.params,c=t.paramsConfig,i=fn[n];return a.createElement(i,{key:r,name:r,params:o,paramsConfig:c,onChange:e.handleChange})})),a.createElement(v,{onClick:this.handleAddSin},"sin"),a.createElement(We,{items:mn,value:r,onChange:this.handleModeChange}))}}]),t}(a.PureComponent),vn={changeCFParams:function(e,t){return{type:en.CHANGE_PARAMS,params:t,id:e}},addCF:function(e){return{type:en.ADD_CF,cfType:e}},startChanging:de,stopChanging:Oe,setChangingMode:function(e){return function(t,n){var a=n().changing.mode;if(a!==e)return e===pe.OnDraw?a===pe.On&&(t(me()),t(Oe())):e===pe.On?t(de()):e===pe.Off&&a===pe.On&&(t(me()),t(Oe())),t({type:he.SET_MODE,mode:e})}}},dn=Object(f.b)((function(e){return{cfs:e.changeFunctions,changingMode:e.changing.mode}}),vn)(gn),On=n(102),bn=n.n(On),yn=Object(f.b)((function(e){return{full:e.fullScreen}}),{setFullScreen:function(e){return{type:Xt.SET,value:e}}})((function(e){var t=e.full,n=e.setFullScreen;return a.createElement(bn.a,{enabled:t,onChange:n},a.createElement("div",{className:"layout-container"},a.createElement("div",{className:"layout"},a.createElement("div",{className:"tools-panel"},a.createElement(Qt,null)),a.createElement("div",{className:"windows"},a.createElement(mt,null),a.createElement(an,null),a.createElement(dn,null)))))})),jn=function(e){return Object(i.a)(e),a.createElement(yn,null)},Cn=n(24),Pn=n(103),En=n.n(Pn),Sn=n(104),wn=n(105);function kn(e,t){return{imageData:document.createElement("canvas").getContext("2d").createImageData(e,t),width:e,height:t}}var Dn=n(106);function An(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Tn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?An(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):An(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Rn,Mn=function(e,t){return function(n,a,r){if(n)return{value:a?a.value:e,params:r?Tn({},a?a.params:t,{},r):a?a.params:t}}},Nn=Mn({before:[],after:[]},{length:4}),Vn=Mn(null,{}),In=Mn(null,{}),xn=function(e,t){return Mn(kn(e,t),{opacity:1,black:!0})},_n=function(e){return function(t,n){return Tn({},t,Object(k.a)({},n.id,e(t[n.id],n,t)))}},Ln=function(e,t){var n=e.value.before,a=e.params.length,r=[].concat(Object(x.a)(n),[t]);return r.length>a&&r.shift(),Tn({},e,{value:{before:r,after:[]}})};function Fn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Un(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fn(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Xn=Object(Wt.a)((Rn={},Object(k.a)(Rn,y.ADD_PATTERN,(function(e,t){var n=function(e){return Object.keys(e).length?Math.max.apply(Math,Object(x.a)(Object.keys(e).map((function(e){return+e}))))+1:1}(e);return Un({},e,Object(k.a)({},n,function(e,t,n){var a=t||{},r=a.width,o=void 0===r?300:r,c=a.height,i=void 0===c?300:c,s=a.history,u=a.store,l=a.selection,p=a.mask;return{id:e,config:t,resultImage:null,current:kn(o,i),history:Nn(s,void 0,(n||{}).history),store:Vn(u,void 0,(n||{}).store),selection:In(l,void 0,(n||{}).selection),mask:xn(o,i)(p,void 0,(n||{}).mask)}}(n,t.config)))})),Object(k.a)(Rn,y.REMOVE_PATTERN,(function(e,t){return function(e,t){return Object(Dn.omit)(e,t)}(e,t.id)})),Object(k.a)(Rn,j.EDIT_CONFIG,_n((function(e,t){return function(e,t,n){var a=t||{},r=a.history,o=a.store,c=a.selection,i=a.mask;return n=n||{},{config:t,id:e.id,current:e.current,resultImage:e.resultImage,history:Nn(r,e.history,n.history),store:Vn(o,e.store,n.store),selection:In(c,e.selection,n.selection),mask:xn(e.current.width,e.current.height)(i,e.mask,n.mask)}}(e,t.config)}))),Object(k.a)(Rn,j.SET_WIDTH,_n((function(e,t){return Un({},e,{current:Un({},e.current,{width:t.width,imageData:C(e.current.imageData,t.width,e.current.height)}),mask:e.mask&&Un({},e.mask,{value:Un({},e.mask.value,{width:t.width,imageData:C(e.mask.value.imageData,t.width,e.mask.value.height)})}),history:e.history&&Ln(e.history,{current:e.current,maskValue:e.mask&&e.mask.value})})}))),Object(k.a)(Rn,j.SET_HEIGHT,_n((function(e,t){return Un({},e,{current:Un({},e.current,{height:t.height,imageData:C(e.current.imageData,e.current.width,t.height)}),mask:e.mask&&Un({},e.mask,{value:Un({},e.mask.value,{height:t.height,imageData:C(e.mask.value.imageData,e.mask.value.width,t.height)})}),history:e.history&&Ln(e.history,{current:e.current,maskValue:e.mask&&e.mask.value})})}))),Object(k.a)(Rn,j.SET_MASK_PARAMS,_n((function(e,t){return Un({},e,{mask:e.mask&&Un({},e.mask,{params:Un({},e.mask.params,{},t.params)})})}))),Object(k.a)(Rn,j.UPDATE_IMAGE,_n((function(e,t){return Un({},e,{current:Un({},e.current,{imageData:t.imageData}),resultImage:E(t.imageData,e.mask&&e.mask.value.imageData),history:e.history&&Ln(e.history,{current:e.current})})}))),Object(k.a)(Rn,j.UPDATE_SELECTION,_n((function(e,t){return Un({},e,{selection:Un({},e.selection,{value:t.value})})}))),Object(k.a)(Rn,j.UPDATE_MASK,_n((function(e,t){return Un({},e,{mask:Un({},e.mask,{value:Un({},e.mask.value,{imageData:t.imageData})}),resultImage:E(e.current.imageData,t.imageData),history:e.history&&Ln(e.history,{maskValue:e.mask.value})})}))),Object(k.a)(Rn,j.UNDO,_n((function(e){var t=function(e,t){var n=e.value,a=n.before,r=n.after;if(0===a.length)return null;var o=a[a.length-1];return{history:Tn({},e,{value:{before:a.slice(0,a.length-1),after:[t].concat(Object(x.a)(r))}}),prev:o}}(e.history,{current:e.current,maskValue:e.mask&&e.mask.value});return t?Un({},e,{history:t.history,current:t.prev.current||e.current,mask:e.mask&&Un({},e.mask,{value:t.prev.maskValue||e.mask.value})}):e}))),Object(k.a)(Rn,j.REDO,_n((function(e){var t=function(e,t){var n=e.value,a=n.before,r=n.after;if(0===r.length)return null;var o=r[0];return{history:Tn({},e,{value:{before:[].concat(Object(x.a)(a),[t]),after:r.slice(1,r.length)}}),next:o}}(e.history,{current:e.current,maskValue:e.mask&&e.mask.value});return t?Un({},e,{history:t.history,current:t.next.current||e.current,mask:e.mask&&Un({},e.mask,{value:t.next.maskValue||e.mask.value})}):e}))),Object(k.a)(Rn,j.CREATE_ROOM,_n((function(e,t){return Un({},e,{connected:t.roomName,socket:t.socket})}))),Rn),{});function Yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Hn=Object(Wt.a)(Object(k.a)({},ut.SET_CURRENT,(function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yn(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{current:t.tool})})),{current:S.Brush}),Bn=Z(Object.values(J)),Gn=Z(Object.values($)),zn=[1,200],Wn=He.VerticalLinear(.5),Zn=[0,1],qn=function(e){return[{name:"size",type:on.Number,props:{range:zn,valueD:Wn}},{name:"opacity",type:on.Number,props:{range:Zn}},{name:"type",type:on.Select,props:{items:Bn}},{name:"compositeOperation",type:on.Select,props:{items:Gn}}]};function Kn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Jn=Object(Wt.a)(Object(k.a)({},gt.SET_PARAMS,(function(e,t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kn(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.params,{},t.params);return{paramsConfig:qn(),params:n}})),{params:{size:5,opacity:1,type:J.Square},paramsConfig:qn()}),$n=Z(Object.values(ce)),Qn=Z(Object.values(ie)),ea=[1,200],ta=He.VerticalLinear(.5),na=[0,1],aa=function(e){return[{name:"size",type:on.Number,props:{range:ea,valueD:ta}},{name:"opacity",type:on.Number,props:{range:na}},{name:"type",type:on.Select,props:{items:$n}},{name:"compositeOperation",type:on.Select,props:{items:Qn}}]};function ra(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var oa,ca=Object(Wt.a)(Object(k.a)({},yt.SET_PARAMS,(function(e,t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ra(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ra(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.params,{},t.params);return{paramsConfig:aa(),params:n}})),{params:{size:5,opacity:1,type:ce.Default},paramsConfig:aa()}),ia=function(e){var t=[{name:"mode",type:on.Select,props:{items:te}}];return e&&e.mode===q.Points&&(t.push({name:"curveType",type:on.Select,props:{items:ne}}),-1!==Object.keys(K).indexOf(e.curveType)&&(t=[].concat(Object(x.a)(t),[{name:K[e.curveType],type:on.Number,props:{range:[0,1],text:1}}]))),t};function sa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var ua,la=Object(Wt.a)(Object(k.a)({},Tt.SET_PARAMS,(function(e,t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sa(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sa(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.params,{},t.params);return{paramsConfig:ia(n),params:n}})),{params:(oa={mode:q.Rect,curveType:B.CurveLinear},Object(k.a)(oa,K[B.CurveBundle],0),Object(k.a)(oa,K[B.CurveCardinal],1),Object(k.a)(oa,K[B.CurveCatmullRom],1),oa),paramsConfig:ia()}),pa=Object(Wt.a)(Object(k.a)({},qt.UPDATE_ROOMS,(function(e,t){return{rooms:t.rooms}})),{rooms:[]}),ha=Object(k.a)({},pn.SIN,{a:.3,t:300,p:0}),fa=Object(k.a)({},pn.SIN,[{name:"a",type:on.Number,props:{range:[0,1]}},{name:"t",type:on.Number,props:{valueD:He.VerticalLinear(.1),range:[1,1e3]}},{name:"p",type:on.Number,props:{valueD:He.VerticalLinear(.5),range:[1,1500]}}]),ma=Object(k.a)({},pn.SIN,(function(e,t){return function(n,a){return n+e.a*(t[1]-t[0])*Math.sin(a/e.t)}}));function ga(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function va(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ga(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ga(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var da,Oa=Object(Wt.a)((ua={},Object(k.a)(ua,en.ADD_CF,(function(e,t){var n=function(e,t){return e.toString()+(Object.keys(t).length?Math.max.apply(Math,Object(x.a)(Object.keys(t).filter((function(n){return t[n].type===e})).map((function(e){return function(e,t){return+e.slice(t.toString().length)}(e,t[e].type)}))))+1:1)}(t.cfType,e);return console.log(n,t.cfType,e),va({},e,Object(k.a)({},n,function(e,t){return{id:e,type:t,params:ha[t],paramsConfig:fa[t]}}(n,t.cfType)))})),Object(k.a)(ua,en.CHANGE_PARAMS,(function(e,t){return va({},e,Object(k.a)({},t.id,va({},e[t.id],{params:t.params})))})),ua),{}),ba=n(107),ya=n.n(ba);function ja(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ca(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ja(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ja(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pa,Ea=Object(Wt.a)((da={},Object(k.a)(da,Ue.SET_VALUE_IN_CHANGING_LIST,(function(e,t){return e[t.path]?t.changeFunctionId?Ca({},e,Object(k.a)({},t.path,Ca({},e[t.path],{path:t.path,changeFunctionId:t.changeFunctionId,range:t.range}))):ya()(e,t.path):t.changeFunctionId?Ca({},e,Object(k.a)({},t.path,{active:!0,path:t.path,changeFunctionId:t.changeFunctionId,range:t.range,startValue:t.startValue})):e})),Object(k.a)(da,Ue.SET_START_VALUE,(function(e,t){return e[t.path]?Ca({},e,Object(k.a)({},t.path,Ca({},e[t.path],{startValue:t.startValue}))):e})),Object(k.a)(da,Ue.ACTIVATE_VALUE_CHANGING,(function(e,t){return Ca({},e,Object(k.a)({},t.path,Ca({},e[t.path],{active:!0})))})),Object(k.a)(da,Ue.DEACTIVATE_VALUE_CHANGING,(function(e,t){return Ca({},e,Object(k.a)({},t.path,Ca({},e[t.path],{active:!1})))})),da),{});function Sa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function wa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sa(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sa(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ka,Da=Object(Wt.a)((Pa={},Object(k.a)(Pa,he.START,(function(e){return wa({},e,{isChanging:!0})})),Object(k.a)(Pa,he.STOP,(function(e){return wa({},e,{isChanging:!1})})),Object(k.a)(Pa,he.SET_MODE,(function(e,t){return wa({},e,{mode:t.mode})})),Pa),{isChanging:!1,mode:pe.OnDraw});!function(e){e.CHANGE="color/change"}(ka||(ka={}));function Aa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Ta,Ra=Object(Wt.a)(Object(k.a)({},ka.CHANGE,(function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Aa(n,!0).forEach((function(t){Object(k.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Aa(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{value:t.color})})),{value:"#000000"}),Ma=n(39),Na=Object(Wt.a)((Ta={},Object(k.a)(Ta,se.CHANGE,(function(e,t){console.log(e,t.time);var n=e.changeFunctions,a=e.changingValues;return Object.values(a).reduce((function(e,a){var r=a.active,o=a.path,c=a.range,i=a.changeFunctionId,s=a.startValue;if(console.log(o,r),!r)return e;var u=n[i],l=(0,ma[u.type])(u.params,c)(s,t.time);return l=Math.min(Math.max(l,c[0]),c[1]),e.set(o,l)}),Ma.a(e)).value()})),Object(k.a)(Ta,se.TO_START_VALUE,(function(e,t){var n=t.path,a=e.changingValues;return a[n]?Ma.a(e).set(n,a[n].startValue).value():e})),Object(k.a)(Ta,se.ALL_TO_START_VALUE,(function(e){var t=e.changingValues;return Object.values(t).reduce((function(e,t){t.active;var n=t.path,a=(t.range,t.changeFunctionId,t.startValue);return e.set(n,a)}),Ma.a(e)).value()})),Ta),{}),Va=Object(wn.a)(Object(Cn.c)({fullScreen:Kt,patterns:Xn,color:Ra,tool:Hn,brush:Jn,line:ca,selectTool:la,rooms:pa,changeFunctions:Oa,changingValues:Ea,changing:Da}),Na),Ia=Object(Cn.d)(Va,Object(Cn.a)(Sn.a,En.a)),xa=function(){return r.a.createElement(f.a,{store:Ia},r.a.createElement(jn,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(255);c.a.render(r.a.createElement(xa,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[108,1,2]]]);
//# sourceMappingURL=main.140844a7.chunk.js.map